<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to Data Science</title>
  <meta name="description" content="This book introduces concepts and skills that can help you tackle real-world data analysis challenges. It covers concepts from probability, statistical inference, linear regression and machine learning and helps you develop skills such as R programming, data wrangling with dplyr, data visualization with ggplot2, file organization with UNIX/Linux shell, version control with GitHub, and reproducible document preparation with R markdown.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces concepts and skills that can help you tackle real-world data analysis challenges. It covers concepts from probability, statistical inference, linear regression and machine learning and helps you develop skills such as R programming, data wrangling with dplyr, data visualization with ggplot2, file organization with UNIX/Linux shell, version control with GitHub, and reproducible document preparation with R markdown." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to Data Science" />
  
  <meta name="twitter:description" content="This book introduces concepts and skills that can help you tackle real-world data analysis challenges. It covers concepts from probability, statistical inference, linear regression and machine learning and helps you develop skills such as R programming, data wrangling with dplyr, data visualization with ggplot2, file organization with UNIX/Linux shell, version control with GitHub, and reproducible document preparation with R markdown." />
  

<meta name="author" content="Rafael A. Irizarry">


<meta name="date" content="2019-02-13">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="probability.html">
<link rel="next" href="regression.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.3.1/str_view.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#case-studies"><i class="fa fa-check"></i><b>1.1</b> Case studies</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#who-will-find-this-book-useful"><i class="fa fa-check"></i><b>1.2</b> Who will find this book useful?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-does-this-book-cover"><i class="fa fa-check"></i><b>1.3</b> What does this book cover?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-is-not-covered-by-this-book"><i class="fa fa-check"></i><b>1.4</b> What is not covered by this book?</a></li>
</ul></li>
<li class="part"><span><b>I R</b></span></li>
<li class="chapter" data-level="2" data-path="installing-r-rstudio.html"><a href="installing-r-rstudio.html"><i class="fa fa-check"></i><b>2</b> Installing R and RStudio</a><ul>
<li class="chapter" data-level="2.1" data-path="installing-r-rstudio.html"><a href="installing-r-rstudio.html#installing-r"><i class="fa fa-check"></i><b>2.1</b> Installing R</a></li>
<li class="chapter" data-level="2.2" data-path="installing-r-rstudio.html"><a href="installing-r-rstudio.html#installing-rstudio"><i class="fa fa-check"></i><b>2.2</b> Installing RStudio</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>3</b> Getting Started with R and RStudio</a><ul>
<li class="chapter" data-level="3.1" data-path="getting-started.html"><a href="getting-started.html#why-r"><i class="fa fa-check"></i><b>3.1</b> Why R?</a></li>
<li class="chapter" data-level="3.2" data-path="getting-started.html"><a href="getting-started.html#the-r-console"><i class="fa fa-check"></i><b>3.2</b> The R console</a></li>
<li class="chapter" data-level="3.3" data-path="getting-started.html"><a href="getting-started.html#scripts"><i class="fa fa-check"></i><b>3.3</b> Scripts</a></li>
<li class="chapter" data-level="3.4" data-path="getting-started.html"><a href="getting-started.html#rstudio"><i class="fa fa-check"></i><b>3.4</b> RStudio</a><ul>
<li class="chapter" data-level="3.4.1" data-path="getting-started.html"><a href="getting-started.html#the-panes"><i class="fa fa-check"></i><b>3.4.1</b> The panes</a></li>
<li class="chapter" data-level="3.4.2" data-path="getting-started.html"><a href="getting-started.html#key-bindings"><i class="fa fa-check"></i><b>3.4.2</b> Key bindings</a></li>
<li class="chapter" data-level="3.4.3" data-path="getting-started.html"><a href="getting-started.html#running-commands-while-editing-scripts"><i class="fa fa-check"></i><b>3.4.3</b> Running commands while editing scripts</a></li>
<li class="chapter" data-level="3.4.4" data-path="getting-started.html"><a href="getting-started.html#changing-global-options"><i class="fa fa-check"></i><b>3.4.4</b> Changing global options</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="getting-started.html"><a href="getting-started.html#installing-r-packages"><i class="fa fa-check"></i><b>3.5</b> Installing R packages</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>4</b> R Basics</a><ul>
<li class="chapter" data-level="4.1" data-path="r-basics.html"><a href="r-basics.html#case-study-us-gun-murders"><i class="fa fa-check"></i><b>4.1</b> Case study: US Gun Murders</a></li>
<li class="chapter" data-level="4.2" data-path="r-basics.html"><a href="r-basics.html#the-very-basics"><i class="fa fa-check"></i><b>4.2</b> The very basics</a><ul>
<li class="chapter" data-level="4.2.1" data-path="r-basics.html"><a href="r-basics.html#objects"><i class="fa fa-check"></i><b>4.2.1</b> Objects</a></li>
<li class="chapter" data-level="4.2.2" data-path="r-basics.html"><a href="r-basics.html#the-workspace"><i class="fa fa-check"></i><b>4.2.2</b> The workspace</a></li>
<li class="chapter" data-level="4.2.3" data-path="r-basics.html"><a href="r-basics.html#functions"><i class="fa fa-check"></i><b>4.2.3</b> Functions</a></li>
<li class="chapter" data-level="4.2.4" data-path="r-basics.html"><a href="r-basics.html#other-prebuilt-objects"><i class="fa fa-check"></i><b>4.2.4</b> Other prebuilt objects</a></li>
<li class="chapter" data-level="4.2.5" data-path="r-basics.html"><a href="r-basics.html#variable-names"><i class="fa fa-check"></i><b>4.2.5</b> Variable names</a></li>
<li class="chapter" data-level="4.2.6" data-path="r-basics.html"><a href="r-basics.html#saving-your-workspace"><i class="fa fa-check"></i><b>4.2.6</b> Saving your workspace</a></li>
<li class="chapter" data-level="4.2.7" data-path="r-basics.html"><a href="r-basics.html#motivating-scripts"><i class="fa fa-check"></i><b>4.2.7</b> Motivating scripts</a></li>
<li class="chapter" data-level="4.2.8" data-path="r-basics.html"><a href="r-basics.html#commenting-your-code"><i class="fa fa-check"></i><b>4.2.8</b> Commenting your code</a></li>
<li class="chapter" data-level="4.2.9" data-path="r-basics.html"><a href="r-basics.html#exercises"><i class="fa fa-check"></i><b>4.2.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="r-basics.html"><a href="r-basics.html#data-types"><i class="fa fa-check"></i><b>4.3</b> Data types</a></li>
<li class="chapter" data-level="4.4" data-path="r-basics.html"><a href="r-basics.html#data-frames"><i class="fa fa-check"></i><b>4.4</b> Data frames</a><ul>
<li class="chapter" data-level="4.4.1" data-path="r-basics.html"><a href="r-basics.html#examining-an-object"><i class="fa fa-check"></i><b>4.4.1</b> Examining an object</a></li>
<li class="chapter" data-level="4.4.2" data-path="r-basics.html"><a href="r-basics.html#the-accessor"><i class="fa fa-check"></i><b>4.4.2</b> The accessor: <code>$</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="r-basics.html"><a href="r-basics.html#vectors-numerics-characters-and-logical"><i class="fa fa-check"></i><b>4.4.3</b> Vectors: numerics, characters, and logical</a></li>
<li class="chapter" data-level="4.4.4" data-path="r-basics.html"><a href="r-basics.html#factors"><i class="fa fa-check"></i><b>4.4.4</b> Factors</a></li>
<li class="chapter" data-level="4.4.5" data-path="r-basics.html"><a href="r-basics.html#lists"><i class="fa fa-check"></i><b>4.4.5</b> Lists</a></li>
<li class="chapter" data-level="4.4.6" data-path="r-basics.html"><a href="r-basics.html#matrices"><i class="fa fa-check"></i><b>4.4.6</b> Matrices</a></li>
<li class="chapter" data-level="4.4.7" data-path="r-basics.html"><a href="r-basics.html#exercises-1"><i class="fa fa-check"></i><b>4.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="r-basics.html"><a href="r-basics.html#vectors"><i class="fa fa-check"></i><b>4.5</b> Vectors</a><ul>
<li class="chapter" data-level="4.5.1" data-path="r-basics.html"><a href="r-basics.html#creating-vectors"><i class="fa fa-check"></i><b>4.5.1</b> Creating vectors</a></li>
<li class="chapter" data-level="4.5.2" data-path="r-basics.html"><a href="r-basics.html#names"><i class="fa fa-check"></i><b>4.5.2</b> Names</a></li>
<li class="chapter" data-level="4.5.3" data-path="r-basics.html"><a href="r-basics.html#sequences"><i class="fa fa-check"></i><b>4.5.3</b> Sequences</a></li>
<li class="chapter" data-level="4.5.4" data-path="r-basics.html"><a href="r-basics.html#subsetting"><i class="fa fa-check"></i><b>4.5.4</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="r-basics.html"><a href="r-basics.html#coercion"><i class="fa fa-check"></i><b>4.6</b> Coercion</a><ul>
<li class="chapter" data-level="4.6.1" data-path="r-basics.html"><a href="r-basics.html#not-availables-na"><i class="fa fa-check"></i><b>4.6.1</b> Not availables (NA)</a></li>
<li class="chapter" data-level="4.6.2" data-path="r-basics.html"><a href="r-basics.html#exercises-2"><i class="fa fa-check"></i><b>4.6.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="r-basics.html"><a href="r-basics.html#sorting"><i class="fa fa-check"></i><b>4.7</b> Sorting</a><ul>
<li class="chapter" data-level="4.7.1" data-path="r-basics.html"><a href="r-basics.html#sort"><i class="fa fa-check"></i><b>4.7.1</b> <code>sort</code></a></li>
<li class="chapter" data-level="4.7.2" data-path="r-basics.html"><a href="r-basics.html#order"><i class="fa fa-check"></i><b>4.7.2</b> <code>order</code></a></li>
<li class="chapter" data-level="4.7.3" data-path="r-basics.html"><a href="r-basics.html#max-and-which.max"><i class="fa fa-check"></i><b>4.7.3</b> <code>max</code> and <code>which.max</code></a></li>
<li class="chapter" data-level="4.7.4" data-path="r-basics.html"><a href="r-basics.html#rank"><i class="fa fa-check"></i><b>4.7.4</b> <code>rank</code></a></li>
<li class="chapter" data-level="4.7.5" data-path="r-basics.html"><a href="r-basics.html#beware-of-recycling"><i class="fa fa-check"></i><b>4.7.5</b> Beware of recycling</a></li>
<li class="chapter" data-level="4.7.6" data-path="r-basics.html"><a href="r-basics.html#exercise"><i class="fa fa-check"></i><b>4.7.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="r-basics.html"><a href="r-basics.html#vector-arithmetics"><i class="fa fa-check"></i><b>4.8</b> Vector arithmetics</a><ul>
<li class="chapter" data-level="4.8.1" data-path="r-basics.html"><a href="r-basics.html#rescaling-a-vector"><i class="fa fa-check"></i><b>4.8.1</b> Rescaling a vector</a></li>
<li class="chapter" data-level="4.8.2" data-path="r-basics.html"><a href="r-basics.html#two-vectors"><i class="fa fa-check"></i><b>4.8.2</b> Two vectors</a></li>
<li class="chapter" data-level="4.8.3" data-path="r-basics.html"><a href="r-basics.html#exercises-3"><i class="fa fa-check"></i><b>4.8.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="r-basics.html"><a href="r-basics.html#indexing"><i class="fa fa-check"></i><b>4.9</b> Indexing</a><ul>
<li class="chapter" data-level="4.9.1" data-path="r-basics.html"><a href="r-basics.html#subsetting-with-logicals"><i class="fa fa-check"></i><b>4.9.1</b> Subsetting with logicals</a></li>
<li class="chapter" data-level="4.9.2" data-path="r-basics.html"><a href="r-basics.html#logical-operators"><i class="fa fa-check"></i><b>4.9.2</b> Logical operators</a></li>
<li class="chapter" data-level="4.9.3" data-path="r-basics.html"><a href="r-basics.html#which"><i class="fa fa-check"></i><b>4.9.3</b> <code>which</code></a></li>
<li class="chapter" data-level="4.9.4" data-path="r-basics.html"><a href="r-basics.html#match"><i class="fa fa-check"></i><b>4.9.4</b> <code>match</code></a></li>
<li class="chapter" data-level="4.9.5" data-path="r-basics.html"><a href="r-basics.html#in"><i class="fa fa-check"></i><b>4.9.5</b> <code>%in%</code></a></li>
<li class="chapter" data-level="4.9.6" data-path="r-basics.html"><a href="r-basics.html#exercises-4"><i class="fa fa-check"></i><b>4.9.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="r-basics.html"><a href="r-basics.html#basic-plots"><i class="fa fa-check"></i><b>4.10</b> Basic plots</a><ul>
<li class="chapter" data-level="4.10.1" data-path="r-basics.html"><a href="r-basics.html#plot"><i class="fa fa-check"></i><b>4.10.1</b> <code>plot</code></a></li>
<li class="chapter" data-level="4.10.2" data-path="r-basics.html"><a href="r-basics.html#hist"><i class="fa fa-check"></i><b>4.10.2</b> <code>hist</code></a></li>
<li class="chapter" data-level="4.10.3" data-path="r-basics.html"><a href="r-basics.html#boxplot"><i class="fa fa-check"></i><b>4.10.3</b> <code>boxplot</code></a></li>
<li class="chapter" data-level="4.10.4" data-path="r-basics.html"><a href="r-basics.html#image"><i class="fa fa-check"></i><b>4.10.4</b> <code>image</code></a></li>
<li class="chapter" data-level="4.10.5" data-path="r-basics.html"><a href="r-basics.html#exercises-5"><i class="fa fa-check"></i><b>4.10.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="programming-basics.html"><a href="programming-basics.html"><i class="fa fa-check"></i><b>5</b> Programming basics</a><ul>
<li class="chapter" data-level="5.1" data-path="programming-basics.html"><a href="programming-basics.html#conditionals"><i class="fa fa-check"></i><b>5.1</b> Conditional expressions</a></li>
<li class="chapter" data-level="5.2" data-path="programming-basics.html"><a href="programming-basics.html#defining-functions"><i class="fa fa-check"></i><b>5.2</b> Defining functions</a></li>
<li class="chapter" data-level="5.3" data-path="programming-basics.html"><a href="programming-basics.html#namespaces"><i class="fa fa-check"></i><b>5.3</b> Namespaces</a></li>
<li class="chapter" data-level="5.4" data-path="programming-basics.html"><a href="programming-basics.html#for-loops"><i class="fa fa-check"></i><b>5.4</b> For-loops</a></li>
<li class="chapter" data-level="5.5" data-path="programming-basics.html"><a href="programming-basics.html#vectorization"><i class="fa fa-check"></i><b>5.5</b> Vectorization and functionals</a></li>
<li class="chapter" data-level="5.6" data-path="programming-basics.html"><a href="programming-basics.html#exercises-6"><i class="fa fa-check"></i><b>5.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html"><i class="fa fa-check"></i><b>6</b> Basic data wrangling with dplyr</a><ul>
<li class="chapter" data-level="6.1" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#manipulating-data-frames"><i class="fa fa-check"></i><b>6.1</b> Manipulating data frames</a><ul>
<li class="chapter" data-level="6.1.1" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#adding-a-column-with-mutate"><i class="fa fa-check"></i><b>6.1.1</b> Adding a column with <code>mutate</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#subsetting-with-filter"><i class="fa fa-check"></i><b>6.1.2</b> Subsetting with <code>filter</code></a></li>
<li class="chapter" data-level="6.1.3" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#selecting-columns-with-select"><i class="fa fa-check"></i><b>6.1.3</b> Selecting columns with <code>select</code></a></li>
<li class="chapter" data-level="6.1.4" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#exercises-7"><i class="fa fa-check"></i><b>6.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#the-pipe"><i class="fa fa-check"></i><b>6.2</b> The pipe: <code>%&gt;%</code></a><ul>
<li class="chapter" data-level="6.2.1" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#exercises-8"><i class="fa fa-check"></i><b>6.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#summarizing-data"><i class="fa fa-check"></i><b>6.3</b> Summarizing data</a><ul>
<li class="chapter" data-level="6.3.1" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#summarize"><i class="fa fa-check"></i><b>6.3.1</b> <code>summarize</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#pull"><i class="fa fa-check"></i><b>6.3.2</b> <code>pull</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#group-by"><i class="fa fa-check"></i><b>6.3.3</b> Group then summarize</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#sorting-data-frames"><i class="fa fa-check"></i><b>6.4</b> Sorting data frames</a><ul>
<li class="chapter" data-level="6.4.1" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#nested-sorting"><i class="fa fa-check"></i><b>6.4.1</b> Nested sorting</a></li>
<li class="chapter" data-level="6.4.2" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#the-top-n"><i class="fa fa-check"></i><b>6.4.2</b> The top <span class="math inline">\(n\)</span></a></li>
<li class="chapter" data-level="6.4.3" data-path="basic-data-wrangling-with-dplyr.html"><a href="basic-data-wrangling-with-dplyr.html#exercises-9"><i class="fa fa-check"></i><b>6.4.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>7</b> Importing data</a><ul>
<li class="chapter" data-level="7.1" data-path="importing-data.html"><a href="importing-data.html#paths-and-the-working-directory"><i class="fa fa-check"></i><b>7.1</b> Paths and the working directory</a><ul>
<li class="chapter" data-level="7.1.1" data-path="importing-data.html"><a href="importing-data.html#the-filesystem"><i class="fa fa-check"></i><b>7.1.1</b> The filesystem</a></li>
<li class="chapter" data-level="7.1.2" data-path="importing-data.html"><a href="importing-data.html#relative-and-full-paths"><i class="fa fa-check"></i><b>7.1.2</b> Relative and full paths</a></li>
<li class="chapter" data-level="7.1.3" data-path="importing-data.html"><a href="importing-data.html#the-working-directory"><i class="fa fa-check"></i><b>7.1.3</b> The working directory</a></li>
<li class="chapter" data-level="7.1.4" data-path="importing-data.html"><a href="importing-data.html#generating-path-names"><i class="fa fa-check"></i><b>7.1.4</b> Generating path names</a></li>
<li class="chapter" data-level="7.1.5" data-path="importing-data.html"><a href="importing-data.html#copying-files-using-paths"><i class="fa fa-check"></i><b>7.1.5</b> Copying files using paths</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="importing-data.html"><a href="importing-data.html#the-readr-and-readxl-packages"><i class="fa fa-check"></i><b>7.2</b> The readr and readxl packages</a><ul>
<li class="chapter" data-level="7.2.1" data-path="importing-data.html"><a href="importing-data.html#readr"><i class="fa fa-check"></i><b>7.2.1</b> readr</a></li>
<li class="chapter" data-level="7.2.2" data-path="importing-data.html"><a href="importing-data.html#readxl"><i class="fa fa-check"></i><b>7.2.2</b> readxl</a></li>
<li class="chapter" data-level="7.2.3" data-path="importing-data.html"><a href="importing-data.html#exercises-10"><i class="fa fa-check"></i><b>7.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="importing-data.html"><a href="importing-data.html#downloading-files"><i class="fa fa-check"></i><b>7.3</b> Downloading files</a></li>
<li class="chapter" data-level="7.4" data-path="importing-data.html"><a href="importing-data.html#r-base-importing-functions"><i class="fa fa-check"></i><b>7.4</b> R-base importing functions</a></li>
<li class="chapter" data-level="7.5" data-path="importing-data.html"><a href="importing-data.html#nuances"><i class="fa fa-check"></i><b>7.5</b> Nuances</a></li>
<li class="chapter" data-level="7.6" data-path="importing-data.html"><a href="importing-data.html#text-versus-binary-files"><i class="fa fa-check"></i><b>7.6</b> Text versus binary files</a></li>
<li class="chapter" data-level="7.7" data-path="importing-data.html"><a href="importing-data.html#unicode-versus-ascii"><i class="fa fa-check"></i><b>7.7</b> Unicode versus ASCII</a></li>
<li class="chapter" data-level="7.8" data-path="importing-data.html"><a href="importing-data.html#organizing-data-with-spreadsheets"><i class="fa fa-check"></i><b>7.8</b> Organizing Data with Spreadsheets</a><ul>
<li class="chapter" data-level="7.8.1" data-path="importing-data.html"><a href="importing-data.html#exercises-11"><i class="fa fa-check"></i><b>7.8.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>8</b> ggplot2</a><ul>
<li class="chapter" data-level="8.1" data-path="ggplot2.html"><a href="ggplot2.html#the-components-of-a-graph"><i class="fa fa-check"></i><b>8.1</b> The components of a graph</a></li>
<li class="chapter" data-level="8.2" data-path="ggplot2.html"><a href="ggplot2.html#ggplot-objects-a-blank-slate"><i class="fa fa-check"></i><b>8.2</b> <code>ggplot</code> objects: a blank slate</a></li>
<li class="chapter" data-level="8.3" data-path="ggplot2.html"><a href="ggplot2.html#geometries"><i class="fa fa-check"></i><b>8.3</b> Geometries</a></li>
<li class="chapter" data-level="8.4" data-path="ggplot2.html"><a href="ggplot2.html#aesthetic-mappings"><i class="fa fa-check"></i><b>8.4</b> Aesthetic mappings</a></li>
<li class="chapter" data-level="8.5" data-path="ggplot2.html"><a href="ggplot2.html#layers"><i class="fa fa-check"></i><b>8.5</b> Layers</a></li>
<li class="chapter" data-level="8.6" data-path="ggplot2.html"><a href="ggplot2.html#tinkering-with-arguments"><i class="fa fa-check"></i><b>8.6</b> Tinkering with arguments</a></li>
<li class="chapter" data-level="8.7" data-path="ggplot2.html"><a href="ggplot2.html#global-versus-local-aesthetic-mappings"><i class="fa fa-check"></i><b>8.7</b> Global versus local aesthetic mappings</a></li>
<li class="chapter" data-level="8.8" data-path="ggplot2.html"><a href="ggplot2.html#scales"><i class="fa fa-check"></i><b>8.8</b> Scales</a></li>
<li class="chapter" data-level="8.9" data-path="ggplot2.html"><a href="ggplot2.html#labels-and-titles"><i class="fa fa-check"></i><b>8.9</b> Labels and titles</a></li>
<li class="chapter" data-level="8.10" data-path="ggplot2.html"><a href="ggplot2.html#categories-as-colors"><i class="fa fa-check"></i><b>8.10</b> Categories as colors</a></li>
<li class="chapter" data-level="8.11" data-path="ggplot2.html"><a href="ggplot2.html#annotation-shapes-and-adjustments"><i class="fa fa-check"></i><b>8.11</b> Annotation, shapes, and adjustments</a></li>
<li class="chapter" data-level="8.12" data-path="ggplot2.html"><a href="ggplot2.html#add-on-packages"><i class="fa fa-check"></i><b>8.12</b> Add-on packages</a></li>
<li class="chapter" data-level="8.13" data-path="ggplot2.html"><a href="ggplot2.html#putting-it-all-together"><i class="fa fa-check"></i><b>8.13</b> Putting it all together</a></li>
<li class="chapter" data-level="8.14" data-path="ggplot2.html"><a href="ggplot2.html#qplot"><i class="fa fa-check"></i><b>8.14</b> Quick plots with <code>qplot</code></a></li>
<li class="chapter" data-level="8.15" data-path="ggplot2.html"><a href="ggplot2.html#grids-of-plots"><i class="fa fa-check"></i><b>8.15</b> Grids of plots</a></li>
<li class="chapter" data-level="8.16" data-path="ggplot2.html"><a href="ggplot2.html#exercises-12"><i class="fa fa-check"></i><b>8.16</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>9</b> The tidyverse</a><ul>
<li class="chapter" data-level="9.1" data-path="tidyverse.html"><a href="tidyverse.html#tidy-data"><i class="fa fa-check"></i><b>9.1</b> Tidy data</a><ul>
<li class="chapter" data-level="9.1.1" data-path="tidyverse.html"><a href="tidyverse.html#exercises-13"><i class="fa fa-check"></i><b>9.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="tidyverse.html"><a href="tidyverse.html#tibbles"><i class="fa fa-check"></i><b>9.2</b> Tibbles</a><ul>
<li class="chapter" data-level="9.2.1" data-path="tidyverse.html"><a href="tidyverse.html#tibbles-display-better"><i class="fa fa-check"></i><b>9.2.1</b> Tibbles display better</a></li>
<li class="chapter" data-level="9.2.2" data-path="tidyverse.html"><a href="tidyverse.html#subsets-of-tibbles-are-tibbles"><i class="fa fa-check"></i><b>9.2.2</b> Subsets of tibbles are tibbles</a></li>
<li class="chapter" data-level="9.2.3" data-path="tidyverse.html"><a href="tidyverse.html#tibbles-can-have-complex-entries"><i class="fa fa-check"></i><b>9.2.3</b> Tibbles can have complex entries</a></li>
<li class="chapter" data-level="9.2.4" data-path="tidyverse.html"><a href="tidyverse.html#tibbles-can-be-grouped"><i class="fa fa-check"></i><b>9.2.4</b> Tibbles can be grouped</a></li>
<li class="chapter" data-level="9.2.5" data-path="tidyverse.html"><a href="tidyverse.html#creating-a-tibble"><i class="fa fa-check"></i><b>9.2.5</b> Creating a tibble</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="tidyverse.html"><a href="tidyverse.html#the-dot-operator"><i class="fa fa-check"></i><b>9.3</b> The dot operator</a></li>
<li class="chapter" data-level="9.4" data-path="tidyverse.html"><a href="tidyverse.html#do"><i class="fa fa-check"></i><b>9.4</b> <code>do</code></a></li>
<li class="chapter" data-level="9.5" data-path="tidyverse.html"><a href="tidyverse.html#the-purrr-package"><i class="fa fa-check"></i><b>9.5</b> The purrr package</a></li>
<li class="chapter" data-level="9.6" data-path="programming-basics.html"><a href="programming-basics.html#conditionals"><i class="fa fa-check"></i><b>9.6</b> Conditionals</a><ul>
<li class="chapter" data-level="9.6.1" data-path="tidyverse.html"><a href="tidyverse.html#case_when"><i class="fa fa-check"></i><b>9.6.1</b> <code>case_when</code></a></li>
<li class="chapter" data-level="9.6.2" data-path="tidyverse.html"><a href="tidyverse.html#between"><i class="fa fa-check"></i><b>9.6.2</b> <code>between</code></a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Data Visualization</b></span></li>
<li class="chapter" data-level="10" data-path="introduction-to-data-visualization.html"><a href="introduction-to-data-visualization.html"><i class="fa fa-check"></i><b>10</b> Introduction to data visualization</a></li>
<li class="chapter" data-level="11" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>11</b> Distributions</a><ul>
<li class="chapter" data-level="11.1" data-path="distributions.html"><a href="distributions.html#variable-types"><i class="fa fa-check"></i><b>11.1</b> Variable types</a></li>
<li class="chapter" data-level="11.2" data-path="distributions.html"><a href="distributions.html#case-study-student-heights"><i class="fa fa-check"></i><b>11.2</b> Case study: Student heights</a></li>
<li class="chapter" data-level="11.3" data-path="distributions.html"><a href="distributions.html#distribution-function"><i class="fa fa-check"></i><b>11.3</b> Distribution function</a></li>
<li class="chapter" data-level="11.4" data-path="distributions.html"><a href="distributions.html#cumulative-distribution-functions"><i class="fa fa-check"></i><b>11.4</b> Cumulative distribution functions</a></li>
<li class="chapter" data-level="11.5" data-path="distributions.html"><a href="distributions.html#histograms"><i class="fa fa-check"></i><b>11.5</b> Histograms</a></li>
<li class="chapter" data-level="11.6" data-path="distributions.html"><a href="distributions.html#smoothed-density"><i class="fa fa-check"></i><b>11.6</b> Smoothed density</a><ul>
<li class="chapter" data-level="11.6.1" data-path="distributions.html"><a href="distributions.html#interpreting-the-y-axis"><i class="fa fa-check"></i><b>11.6.1</b> Interpreting the y-axis</a></li>
<li class="chapter" data-level="11.6.2" data-path="distributions.html"><a href="distributions.html#densities-permit-stratification"><i class="fa fa-check"></i><b>11.6.2</b> Densities permit stratification</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="distributions.html"><a href="distributions.html#exercises-14"><i class="fa fa-check"></i><b>11.7</b> Exercises</a></li>
<li class="chapter" data-level="11.8" data-path="distributions.html"><a href="distributions.html#the-normal-distribution"><i class="fa fa-check"></i><b>11.8</b> The normal distribution</a></li>
<li class="chapter" data-level="11.9" data-path="distributions.html"><a href="distributions.html#standardized-units"><i class="fa fa-check"></i><b>11.9</b> Standardized units</a></li>
<li class="chapter" data-level="11.10" data-path="distributions.html"><a href="distributions.html#quantile-quantile-plots"><i class="fa fa-check"></i><b>11.10</b> Quantile-quantile plots</a></li>
<li class="chapter" data-level="11.11" data-path="distributions.html"><a href="distributions.html#percentiles"><i class="fa fa-check"></i><b>11.11</b> Percentiles</a></li>
<li class="chapter" data-level="11.12" data-path="distributions.html"><a href="distributions.html#case-study-student-heights-continued"><i class="fa fa-check"></i><b>11.12</b> Case study: Student heights (continued)</a></li>
<li class="chapter" data-level="11.13" data-path="distributions.html"><a href="distributions.html#boxplots"><i class="fa fa-check"></i><b>11.13</b> Boxplots</a></li>
<li class="chapter" data-level="11.14" data-path="distributions.html"><a href="distributions.html#student-height-cont"><i class="fa fa-check"></i><b>11.14</b> Case study: Student heights (continued)</a></li>
<li class="chapter" data-level="11.15" data-path="distributions.html"><a href="distributions.html#exercises-15"><i class="fa fa-check"></i><b>11.15</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="other-geometries.html"><a href="other-geometries.html"><i class="fa fa-check"></i><b>12</b> ggplot2 geometries</a><ul>
<li class="chapter" data-level="12.1" data-path="other-geometries.html"><a href="other-geometries.html#barplots"><i class="fa fa-check"></i><b>12.1</b> Barplots</a></li>
<li class="chapter" data-level="12.2" data-path="other-geometries.html"><a href="other-geometries.html#histograms-1"><i class="fa fa-check"></i><b>12.2</b> Histograms</a></li>
<li class="chapter" data-level="12.3" data-path="other-geometries.html"><a href="other-geometries.html#density-plots"><i class="fa fa-check"></i><b>12.3</b> Density plots</a></li>
<li class="chapter" data-level="12.4" data-path="other-geometries.html"><a href="other-geometries.html#boxplot-1"><i class="fa fa-check"></i><b>12.4</b> Boxplot</a></li>
<li class="chapter" data-level="12.5" data-path="other-geometries.html"><a href="other-geometries.html#qq-plots"><i class="fa fa-check"></i><b>12.5</b> QQ-plots</a></li>
<li class="chapter" data-level="12.6" data-path="other-geometries.html"><a href="other-geometries.html#images"><i class="fa fa-check"></i><b>12.6</b> Images</a></li>
<li class="chapter" data-level="12.7" data-path="other-geometries.html"><a href="other-geometries.html#quick-plots"><i class="fa fa-check"></i><b>12.7</b> Quick plots</a><ul>
<li class="chapter" data-level="12.7.1" data-path="other-geometries.html"><a href="other-geometries.html#exercises-16"><i class="fa fa-check"></i><b>12.7.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="gapminder.html"><a href="gapminder.html"><i class="fa fa-check"></i><b>13</b> Data visualization in practice</a><ul>
<li class="chapter" data-level="13.1" data-path="gapminder.html"><a href="gapminder.html#gapminder"><i class="fa fa-check"></i><b>13.1</b> Gapminder</a><ul>
<li class="chapter" data-level="13.1.1" data-path="gapminder.html"><a href="gapminder.html#hans-roslings-quiz"><i class="fa fa-check"></i><b>13.1.1</b> Hans Rosling’s quiz</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="gapminder.html"><a href="gapminder.html#scatterplots"><i class="fa fa-check"></i><b>13.2</b> Scatterplots</a></li>
<li class="chapter" data-level="13.3" data-path="gapminder.html"><a href="gapminder.html#faceting"><i class="fa fa-check"></i><b>13.3</b> Faceting</a><ul>
<li class="chapter" data-level="13.3.1" data-path="gapminder.html"><a href="gapminder.html#facet_wrap"><i class="fa fa-check"></i><b>13.3.1</b> <code>facet_wrap</code></a></li>
<li class="chapter" data-level="13.3.2" data-path="gapminder.html"><a href="gapminder.html#fixed-scales-for-better-comparisons"><i class="fa fa-check"></i><b>13.3.2</b> Fixed scales for better comparisons</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="gapminder.html"><a href="gapminder.html#time-series-plots"><i class="fa fa-check"></i><b>13.4</b> Time series plots</a><ul>
<li class="chapter" data-level="13.4.1" data-path="gapminder.html"><a href="gapminder.html#labels-instead-of-legends"><i class="fa fa-check"></i><b>13.4.1</b> Labels instead of legends</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="gapminder.html"><a href="gapminder.html#transformations"><i class="fa fa-check"></i><b>13.5</b> Transformations</a><ul>
<li class="chapter" data-level="13.5.1" data-path="gapminder.html"><a href="gapminder.html#log-transformation"><i class="fa fa-check"></i><b>13.5.1</b> Log transformation</a></li>
<li class="chapter" data-level="13.5.2" data-path="gapminder.html"><a href="gapminder.html#which-base"><i class="fa fa-check"></i><b>13.5.2</b> Which base?</a></li>
<li class="chapter" data-level="13.5.3" data-path="gapminder.html"><a href="gapminder.html#transform-the-values-or-the-scale"><i class="fa fa-check"></i><b>13.5.3</b> Transform the values or the scale?</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="gapminder.html"><a href="gapminder.html#modes"><i class="fa fa-check"></i><b>13.6</b> Modes</a></li>
<li class="chapter" data-level="13.7" data-path="gapminder.html"><a href="gapminder.html#mulitple-distributions-boxplots-and-ridge-plots"><i class="fa fa-check"></i><b>13.7</b> Mulitple distributions: boxplots and ridge plots</a><ul>
<li class="chapter" data-level="13.7.1" data-path="gapminder.html"><a href="gapminder.html#boxplots-1"><i class="fa fa-check"></i><b>13.7.1</b> Boxplots</a></li>
<li class="chapter" data-level="13.7.2" data-path="gapminder.html"><a href="gapminder.html#ridge-plots"><i class="fa fa-check"></i><b>13.7.2</b> Ridge plots</a></li>
</ul></li>
<li class="chapter" data-level="13.8" data-path="gapminder.html"><a href="gapminder.html#example-1970-versus-2010-income-distributions"><i class="fa fa-check"></i><b>13.8</b> Example: 1970 versus 2010 income distributions</a><ul>
<li class="chapter" data-level="13.8.1" data-path="gapminder.html"><a href="gapminder.html#accessing-computed-variables"><i class="fa fa-check"></i><b>13.8.1</b> Accessing computed variables</a></li>
<li class="chapter" data-level="13.8.2" data-path="gapminder.html"><a href="gapminder.html#weighted-densities"><i class="fa fa-check"></i><b>13.8.2</b> Weighted densities</a></li>
</ul></li>
<li class="chapter" data-level="13.9" data-path="gapminder.html"><a href="gapminder.html#ecological-fallacy"><i class="fa fa-check"></i><b>13.9</b> Ecological fallacy</a><ul>
<li class="chapter" data-level="13.9.1" data-path="gapminder.html"><a href="gapminder.html#logit"><i class="fa fa-check"></i><b>13.9.1</b> Logistic transformation</a></li>
<li class="chapter" data-level="13.9.2" data-path="gapminder.html"><a href="gapminder.html#show-the-data"><i class="fa fa-check"></i><b>13.9.2</b> Show the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html"><i class="fa fa-check"></i><b>14</b> Data visualization principles</a><ul>
<li class="chapter" data-level="14.1" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#encoding-data-using-visual-cues"><i class="fa fa-check"></i><b>14.1</b> Encoding data using visual cues</a></li>
<li class="chapter" data-level="14.2" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#know-when-to-include-0"><i class="fa fa-check"></i><b>14.2</b> Know when to include 0</a></li>
<li class="chapter" data-level="14.3" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#do-not-distort-quantities"><i class="fa fa-check"></i><b>14.3</b> Do not distort quantities</a></li>
<li class="chapter" data-level="14.4" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#order-by-a-meaningful-value"><i class="fa fa-check"></i><b>14.4</b> Order by a meaningful value</a></li>
<li class="chapter" data-level="14.5" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#show-the-data-1"><i class="fa fa-check"></i><b>14.5</b> Show the data</a></li>
<li class="chapter" data-level="14.6" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#ease-comparisons-use-common-axes"><i class="fa fa-check"></i><b>14.6</b> Ease comparisons: use common axes</a></li>
<li class="chapter" data-level="14.7" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#ease-comparisons-align-plots-vertically-to-see-horizontal-changes-and-horizontally-to-see-vertical-changes"><i class="fa fa-check"></i><b>14.7</b> Ease comparisons: align plots vertically to see horizontal changes and horizontally to see vertical changes</a></li>
<li class="chapter" data-level="14.8" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#consider-transformations"><i class="fa fa-check"></i><b>14.8</b> Consider transformations</a></li>
<li class="chapter" data-level="14.9" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#visual-cues-to-be-compared-should-be-adjacent"><i class="fa fa-check"></i><b>14.9</b> Visual cues to be compared should be adjacent</a></li>
<li class="chapter" data-level="14.10" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#ease-comparison-use-color"><i class="fa fa-check"></i><b>14.10</b> Ease comparison: use color</a></li>
<li class="chapter" data-level="14.11" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#think-of-the-color-blind"><i class="fa fa-check"></i><b>14.11</b> Think of the color blind</a></li>
<li class="chapter" data-level="14.12" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#two-variables"><i class="fa fa-check"></i><b>14.12</b> Two variables</a><ul>
<li class="chapter" data-level="14.12.1" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#slope-charts"><i class="fa fa-check"></i><b>14.12.1</b> Slope charts</a></li>
<li class="chapter" data-level="14.12.2" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#bland-altman-plot"><i class="fa fa-check"></i><b>14.12.2</b> Bland-Altman plot</a></li>
</ul></li>
<li class="chapter" data-level="14.13" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#encoding-a-third-variable"><i class="fa fa-check"></i><b>14.13</b> Encoding a third variable</a></li>
<li class="chapter" data-level="14.14" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#avoid-pseudo-three-dimensional-plots"><i class="fa fa-check"></i><b>14.14</b> Avoid pseudo three dimensional plots</a></li>
<li class="chapter" data-level="14.15" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#avoid-gratuitous-three-dimensional-plots"><i class="fa fa-check"></i><b>14.15</b> Avoid gratuitous three dimensional plots</a></li>
<li class="chapter" data-level="14.16" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#avoid-too-many-significant-digits"><i class="fa fa-check"></i><b>14.16</b> Avoid too many significant digits</a></li>
<li class="chapter" data-level="14.17" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#know-your-audience"><i class="fa fa-check"></i><b>14.17</b> Know your audience</a></li>
<li class="chapter" data-level="14.18" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#exercises-17"><i class="fa fa-check"></i><b>14.18</b> Exercises</a></li>
<li class="chapter" data-level="14.19" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#case-study-the-impact-of-vaccines-on-battling-infectious-diseases"><i class="fa fa-check"></i><b>14.19</b> Case study: The impact of vaccines on battling infectious diseases</a><ul>
<li class="chapter" data-level="14.19.1" data-path="data-visualization-principles.html"><a href="data-visualization-principles.html#exercises-18"><i class="fa fa-check"></i><b>14.19.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="robust-summaries.html"><a href="robust-summaries.html"><i class="fa fa-check"></i><b>15</b> Robust summaries</a><ul>
<li class="chapter" data-level="15.1" data-path="robust-summaries.html"><a href="robust-summaries.html#outliers"><i class="fa fa-check"></i><b>15.1</b> Outliers</a></li>
<li class="chapter" data-level="15.2" data-path="robust-summaries.html"><a href="robust-summaries.html#median"><i class="fa fa-check"></i><b>15.2</b> Median</a></li>
<li class="chapter" data-level="15.3" data-path="robust-summaries.html"><a href="robust-summaries.html#the-inter-quartile-range-iqr"><i class="fa fa-check"></i><b>15.3</b> The inter quartile range (IQR)</a></li>
<li class="chapter" data-level="15.4" data-path="robust-summaries.html"><a href="robust-summaries.html#tukeys-definition-of-an-outlier"><i class="fa fa-check"></i><b>15.4</b> Tukey’s definition of an outlier</a></li>
<li class="chapter" data-level="15.5" data-path="robust-summaries.html"><a href="robust-summaries.html#median-absolute-deviation"><i class="fa fa-check"></i><b>15.5</b> Median absolute deviation</a></li>
<li class="chapter" data-level="15.6" data-path="robust-summaries.html"><a href="robust-summaries.html#exercises-19"><i class="fa fa-check"></i><b>15.6</b> Exercises</a></li>
<li class="chapter" data-level="15.7" data-path="robust-summaries.html"><a href="robust-summaries.html#case-study-self-reported-student-heights"><i class="fa fa-check"></i><b>15.7</b> Case study: Self-reported student heights</a></li>
</ul></li>
<li class="part"><span><b>III Data Wrangling</b></span></li>
<li class="chapter" data-level="16" data-path="introduction-to-data-wrangling.html"><a href="introduction-to-data-wrangling.html"><i class="fa fa-check"></i><b>16</b> Introduction to Data Wrangling</a></li>
<li class="chapter" data-level="17" data-path="reshaping-data.html"><a href="reshaping-data.html"><i class="fa fa-check"></i><b>17</b> Reshaping data</a><ul>
<li class="chapter" data-level="17.1" data-path="reshaping-data.html"><a href="reshaping-data.html#gather"><i class="fa fa-check"></i><b>17.1</b> <code>gather</code></a></li>
<li class="chapter" data-level="17.2" data-path="reshaping-data.html"><a href="reshaping-data.html#spread"><i class="fa fa-check"></i><b>17.2</b> <code>spread</code></a></li>
<li class="chapter" data-level="17.3" data-path="reshaping-data.html"><a href="reshaping-data.html#separate"><i class="fa fa-check"></i><b>17.3</b> <code>separate</code></a></li>
<li class="chapter" data-level="17.4" data-path="reshaping-data.html"><a href="reshaping-data.html#unite"><i class="fa fa-check"></i><b>17.4</b> <code>unite</code></a></li>
<li class="chapter" data-level="17.5" data-path="reshaping-data.html"><a href="reshaping-data.html#exercises-20"><i class="fa fa-check"></i><b>17.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="joining-tables.html"><a href="joining-tables.html"><i class="fa fa-check"></i><b>18</b> Joining tables</a><ul>
<li class="chapter" data-level="18.1" data-path="joining-tables.html"><a href="joining-tables.html#joins"><i class="fa fa-check"></i><b>18.1</b> Joins</a><ul>
<li class="chapter" data-level="18.1.1" data-path="joining-tables.html"><a href="joining-tables.html#left-join"><i class="fa fa-check"></i><b>18.1.1</b> Left join</a></li>
<li class="chapter" data-level="18.1.2" data-path="joining-tables.html"><a href="joining-tables.html#right-join"><i class="fa fa-check"></i><b>18.1.2</b> Right join</a></li>
<li class="chapter" data-level="18.1.3" data-path="joining-tables.html"><a href="joining-tables.html#inner-join"><i class="fa fa-check"></i><b>18.1.3</b> Inner join</a></li>
<li class="chapter" data-level="18.1.4" data-path="joining-tables.html"><a href="joining-tables.html#full-join"><i class="fa fa-check"></i><b>18.1.4</b> Full join</a></li>
<li class="chapter" data-level="18.1.5" data-path="joining-tables.html"><a href="joining-tables.html#semi-join"><i class="fa fa-check"></i><b>18.1.5</b> Semi join</a></li>
<li class="chapter" data-level="18.1.6" data-path="joining-tables.html"><a href="joining-tables.html#anti-join"><i class="fa fa-check"></i><b>18.1.6</b> Anti join</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="joining-tables.html"><a href="joining-tables.html#binding"><i class="fa fa-check"></i><b>18.2</b> Binding</a><ul>
<li class="chapter" data-level="18.2.1" data-path="joining-tables.html"><a href="joining-tables.html#binding-columns"><i class="fa fa-check"></i><b>18.2.1</b> Binding columns</a></li>
<li class="chapter" data-level="18.2.2" data-path="joining-tables.html"><a href="joining-tables.html#binding-by-rows"><i class="fa fa-check"></i><b>18.2.2</b> Binding by rows</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="joining-tables.html"><a href="joining-tables.html#set-operators"><i class="fa fa-check"></i><b>18.3</b> Set operators</a><ul>
<li class="chapter" data-level="18.3.1" data-path="joining-tables.html"><a href="joining-tables.html#intersect"><i class="fa fa-check"></i><b>18.3.1</b> Intersect</a></li>
<li class="chapter" data-level="18.3.2" data-path="joining-tables.html"><a href="joining-tables.html#union"><i class="fa fa-check"></i><b>18.3.2</b> Union</a></li>
<li class="chapter" data-level="18.3.3" data-path="joining-tables.html"><a href="joining-tables.html#setdiff"><i class="fa fa-check"></i><b>18.3.3</b> <code>setdiff</code></a></li>
<li class="chapter" data-level="18.3.4" data-path="joining-tables.html"><a href="joining-tables.html#setequal"><i class="fa fa-check"></i><b>18.3.4</b> <code>setequal</code></a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="joining-tables.html"><a href="joining-tables.html#exercises-21"><i class="fa fa-check"></i><b>18.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="web-scraping.html"><a href="web-scraping.html"><i class="fa fa-check"></i><b>19</b> Web Scraping</a><ul>
<li class="chapter" data-level="19.1" data-path="web-scraping.html"><a href="web-scraping.html#html"><i class="fa fa-check"></i><b>19.1</b> HTML</a></li>
<li class="chapter" data-level="19.2" data-path="web-scraping.html"><a href="web-scraping.html#the-rvest-package"><i class="fa fa-check"></i><b>19.2</b> The rvest package</a></li>
<li class="chapter" data-level="19.3" data-path="web-scraping.html"><a href="web-scraping.html#css-selectors"><i class="fa fa-check"></i><b>19.3</b> CSS selectors</a></li>
<li class="chapter" data-level="19.4" data-path="web-scraping.html"><a href="web-scraping.html#json"><i class="fa fa-check"></i><b>19.4</b> JSON</a></li>
<li class="chapter" data-level="19.5" data-path="web-scraping.html"><a href="web-scraping.html#exercises-22"><i class="fa fa-check"></i><b>19.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="string-processing.html"><a href="string-processing.html"><i class="fa fa-check"></i><b>20</b> String Processing</a><ul>
<li class="chapter" data-level="20.1" data-path="string-processing.html"><a href="string-processing.html#stringr"><i class="fa fa-check"></i><b>20.1</b> The stringr package</a></li>
<li class="chapter" data-level="20.2" data-path="string-processing.html"><a href="string-processing.html#case-study-1-us-murders-data"><i class="fa fa-check"></i><b>20.2</b> Case study 1: US murders data</a></li>
<li class="chapter" data-level="20.3" data-path="string-processing.html"><a href="string-processing.html#case-study-2-self-reported-heights"><i class="fa fa-check"></i><b>20.3</b> Case study 2: Self reported heights</a></li>
<li class="chapter" data-level="20.4" data-path="string-processing.html"><a href="string-processing.html#how-to-escape-when-defining-strings"><i class="fa fa-check"></i><b>20.4</b> How to <em>escape</em> when defining strings</a></li>
<li class="chapter" data-level="20.5" data-path="string-processing.html"><a href="string-processing.html#regular-expressions"><i class="fa fa-check"></i><b>20.5</b> Regular expressions</a><ul>
<li class="chapter" data-level="20.5.1" data-path="string-processing.html"><a href="string-processing.html#strings-are-a-regexp"><i class="fa fa-check"></i><b>20.5.1</b> Strings are a regexp</a></li>
<li class="chapter" data-level="20.5.2" data-path="string-processing.html"><a href="string-processing.html#special-characters"><i class="fa fa-check"></i><b>20.5.2</b> Special characters</a></li>
<li class="chapter" data-level="20.5.3" data-path="string-processing.html"><a href="string-processing.html#character-classes"><i class="fa fa-check"></i><b>20.5.3</b> Character classes</a></li>
<li class="chapter" data-level="20.5.4" data-path="string-processing.html"><a href="string-processing.html#anchors"><i class="fa fa-check"></i><b>20.5.4</b> Anchors</a></li>
<li class="chapter" data-level="20.5.5" data-path="string-processing.html"><a href="string-processing.html#quantifiers"><i class="fa fa-check"></i><b>20.5.5</b> Quantifiers</a></li>
<li class="chapter" data-level="20.5.6" data-path="string-processing.html"><a href="string-processing.html#white-space-s"><i class="fa fa-check"></i><b>20.5.6</b> White space <code>\s</code></a></li>
<li class="chapter" data-level="20.5.7" data-path="string-processing.html"><a href="string-processing.html#quantifiers-1"><i class="fa fa-check"></i><b>20.5.7</b> Quantifiers: <code>*</code>, <code>?</code>, <code>+</code></a></li>
<li class="chapter" data-level="20.5.8" data-path="string-processing.html"><a href="string-processing.html#not"><i class="fa fa-check"></i><b>20.5.8</b> Not</a></li>
<li class="chapter" data-level="20.5.9" data-path="string-processing.html"><a href="string-processing.html#groups"><i class="fa fa-check"></i><b>20.5.9</b> Groups</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="string-processing.html"><a href="string-processing.html#search-and-replace-with-regex"><i class="fa fa-check"></i><b>20.6</b> Search and replace with regex</a><ul>
<li class="chapter" data-level="20.6.1" data-path="string-processing.html"><a href="string-processing.html#search-and-replace-using-groups"><i class="fa fa-check"></i><b>20.6.1</b> Search and replace using groups</a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="string-processing.html"><a href="string-processing.html#testing-and-improving"><i class="fa fa-check"></i><b>20.7</b> Testing and improving</a></li>
<li class="chapter" data-level="20.8" data-path="string-processing.html"><a href="string-processing.html#trimming"><i class="fa fa-check"></i><b>20.8</b> Trimming</a></li>
<li class="chapter" data-level="20.9" data-path="string-processing.html"><a href="string-processing.html#changing-lettercase"><i class="fa fa-check"></i><b>20.9</b> Changing lettercase</a></li>
<li class="chapter" data-level="20.10" data-path="string-processing.html"><a href="string-processing.html#case-study-2-self-reported-heights-continued"><i class="fa fa-check"></i><b>20.10</b> Case study 2: Self reported heights (continued)</a><ul>
<li class="chapter" data-level="20.10.1" data-path="string-processing.html"><a href="string-processing.html#the-extract-function"><i class="fa fa-check"></i><b>20.10.1</b> The <code>extract</code> function</a></li>
<li class="chapter" data-level="20.10.2" data-path="string-processing.html"><a href="string-processing.html#putting-it-all-together-1"><i class="fa fa-check"></i><b>20.10.2</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="20.11" data-path="string-processing.html"><a href="string-processing.html#string-splitting"><i class="fa fa-check"></i><b>20.11</b> String splitting</a></li>
<li class="chapter" data-level="20.12" data-path="string-processing.html"><a href="string-processing.html#case-study-3-extracting-tables-from-a-pdf"><i class="fa fa-check"></i><b>20.12</b> Case study 3: Extracting tables from a PDF</a></li>
<li class="chapter" data-level="20.13" data-path="string-processing.html"><a href="string-processing.html#recode"><i class="fa fa-check"></i><b>20.13</b> Re-coding</a></li>
<li class="chapter" data-level="20.14" data-path="string-processing.html"><a href="string-processing.html#exercises-23"><i class="fa fa-check"></i><b>20.14</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="parsing-dates-and-times.html"><a href="parsing-dates-and-times.html"><i class="fa fa-check"></i><b>21</b> Parsing Dates and Times</a><ul>
<li class="chapter" data-level="21.1" data-path="parsing-dates-and-times.html"><a href="parsing-dates-and-times.html#the-date-data-type"><i class="fa fa-check"></i><b>21.1</b> The date data type</a></li>
<li class="chapter" data-level="21.2" data-path="parsing-dates-and-times.html"><a href="parsing-dates-and-times.html#lubridate"><i class="fa fa-check"></i><b>21.2</b> The lubridate package</a></li>
<li class="chapter" data-level="21.3" data-path="parsing-dates-and-times.html"><a href="parsing-dates-and-times.html#exercises-24"><i class="fa fa-check"></i><b>21.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="text-mining.html"><a href="text-mining.html"><i class="fa fa-check"></i><b>22</b> Text mining</a><ul>
<li class="chapter" data-level="22.1" data-path="text-mining.html"><a href="text-mining.html#case-study-trump-tweets"><i class="fa fa-check"></i><b>22.1</b> Case study: Trump tweets</a></li>
<li class="chapter" data-level="22.2" data-path="text-mining.html"><a href="text-mining.html#text-as-data"><i class="fa fa-check"></i><b>22.2</b> Text as data</a></li>
<li class="chapter" data-level="22.3" data-path="text-mining.html"><a href="text-mining.html#sentiment-analysis"><i class="fa fa-check"></i><b>22.3</b> Sentiment analysis</a></li>
<li class="chapter" data-level="22.4" data-path="text-mining.html"><a href="text-mining.html#exercises-25"><i class="fa fa-check"></i><b>22.4</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>IV Probability, Inference, and Regression with R</b></span></li>
<li class="chapter" data-level="23" data-path="introduction-to-statistics-with-r.html"><a href="introduction-to-statistics-with-r.html"><i class="fa fa-check"></i><b>23</b> Introduction to Statistics with R</a></li>
<li class="chapter" data-level="24" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>24</b> Probability</a><ul>
<li class="chapter" data-level="24.1" data-path="probability.html"><a href="probability.html#discrete-probability"><i class="fa fa-check"></i><b>24.1</b> Discrete probability</a><ul>
<li class="chapter" data-level="24.1.1" data-path="probability.html"><a href="probability.html#relative-frequency"><i class="fa fa-check"></i><b>24.1.1</b> Relative frequency</a></li>
<li class="chapter" data-level="24.1.2" data-path="probability.html"><a href="probability.html#notation"><i class="fa fa-check"></i><b>24.1.2</b> Notation</a></li>
<li class="chapter" data-level="24.1.3" data-path="probability.html"><a href="probability.html#monte-carlo-simulations"><i class="fa fa-check"></i><b>24.1.3</b> Monte Carlo simulations</a></li>
<li class="chapter" data-level="24.1.4" data-path="probability.html"><a href="probability.html#setting-the-random-seed"><i class="fa fa-check"></i><b>24.1.4</b> Setting the random seed</a></li>
<li class="chapter" data-level="" data-path="probability.html"><a href="probability.html#with-and-without-replacement"><i class="fa fa-check"></i>With and without replacement</a></li>
<li class="chapter" data-level="24.1.5" data-path="probability.html"><a href="probability.html#discrete-probability-distributions"><i class="fa fa-check"></i><b>24.1.5</b> Discrete probability distributions</a></li>
<li class="chapter" data-level="24.1.6" data-path="probability.html"><a href="probability.html#independence"><i class="fa fa-check"></i><b>24.1.6</b> Independence</a></li>
<li class="chapter" data-level="24.1.7" data-path="probability.html"><a href="probability.html#conditional-probabilities"><i class="fa fa-check"></i><b>24.1.7</b> Conditional probabilities</a></li>
<li class="chapter" data-level="24.1.8" data-path="probability.html"><a href="probability.html#multiplication-rule"><i class="fa fa-check"></i><b>24.1.8</b> Multiplication rule</a></li>
<li class="chapter" data-level="24.1.9" data-path="probability.html"><a href="probability.html#multiplication-rule-under-indepedence"><i class="fa fa-check"></i><b>24.1.9</b> Multiplication rule under indepedence</a></li>
<li class="chapter" data-level="24.1.10" data-path="probability.html"><a href="probability.html#addition-rule"><i class="fa fa-check"></i><b>24.1.10</b> Addition rule</a></li>
<li class="chapter" data-level="24.1.11" data-path="probability.html"><a href="probability.html#combinations-and-permutations"><i class="fa fa-check"></i><b>24.1.11</b> Combinations and permutations</a></li>
<li class="chapter" data-level="24.1.12" data-path="probability.html"><a href="probability.html#monte-carlo-example"><i class="fa fa-check"></i><b>24.1.12</b> Monte Carlo example</a></li>
<li class="chapter" data-level="24.1.13" data-path="probability.html"><a href="probability.html#birthday-problem-example"><i class="fa fa-check"></i><b>24.1.13</b> Birthday problem example</a></li>
<li class="chapter" data-level="24.1.14" data-path="probability.html"><a href="probability.html#how-many-monte-carlo-experiments-are-enough"><i class="fa fa-check"></i><b>24.1.14</b> How many Monte Carlo experiments are enough</a></li>
<li class="chapter" data-level="24.1.15" data-path="probability.html"><a href="probability.html#monty-hall-problem-example"><i class="fa fa-check"></i><b>24.1.15</b> Monty Hall problem example</a></li>
<li class="chapter" data-level="24.1.16" data-path="probability.html"><a href="probability.html#exercises-26"><i class="fa fa-check"></i><b>24.1.16</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="probability.html"><a href="probability.html#continuous-probability"><i class="fa fa-check"></i><b>24.2</b> Continuous probability</a><ul>
<li class="chapter" data-level="24.2.1" data-path="probability.html"><a href="probability.html#theoretical-distribution"><i class="fa fa-check"></i><b>24.2.1</b> Theoretical distribution</a></li>
<li class="chapter" data-level="24.2.2" data-path="probability.html"><a href="probability.html#theoretical-distributions-as-approximations"><i class="fa fa-check"></i><b>24.2.2</b> Theoretical distributions as approximations</a></li>
<li class="chapter" data-level="24.2.3" data-path="probability.html"><a href="probability.html#the-probability-density"><i class="fa fa-check"></i><b>24.2.3</b> The probability density</a></li>
<li class="chapter" data-level="24.2.4" data-path="probability.html"><a href="probability.html#monte-carlo-simulations-for-continuous-variables"><i class="fa fa-check"></i><b>24.2.4</b> Monte Carlo simulations for continuous variables</a></li>
<li class="chapter" data-level="24.2.5" data-path="probability.html"><a href="probability.html#other-continuous-distributions"><i class="fa fa-check"></i><b>24.2.5</b> Other continuous distributions</a></li>
<li class="chapter" data-level="24.2.6" data-path="probability.html"><a href="probability.html#exercises-27"><i class="fa fa-check"></i><b>24.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="probability.html"><a href="probability.html#random-variables"><i class="fa fa-check"></i><b>24.3</b> Random variables</a><ul>
<li class="chapter" data-level="24.3.1" data-path="probability.html"><a href="probability.html#sampling-models"><i class="fa fa-check"></i><b>24.3.1</b> Sampling models</a></li>
<li class="chapter" data-level="24.3.2" data-path="probability.html"><a href="probability.html#the-probability-distribution-of-a-random-variable"><i class="fa fa-check"></i><b>24.3.2</b> The probability distribution of a random variable</a></li>
<li class="chapter" data-level="24.3.3" data-path="probability.html"><a href="probability.html#distributions-versus-probability-distributions"><i class="fa fa-check"></i><b>24.3.3</b> Distributions versus probability distributions</a></li>
<li class="chapter" data-level="24.3.4" data-path="probability.html"><a href="probability.html#notation-for-random-variables"><i class="fa fa-check"></i><b>24.3.4</b> Notation for random variables</a></li>
<li class="chapter" data-level="24.3.5" data-path="probability.html"><a href="probability.html#central-limit-theorem"><i class="fa fa-check"></i><b>24.3.5</b> Central Limit Theorem</a></li>
<li class="chapter" data-level="24.3.6" data-path="probability.html"><a href="probability.html#the-expected-value-and-standard-error"><i class="fa fa-check"></i><b>24.3.6</b> The expected value and standard error</a></li>
<li class="chapter" data-level="24.3.7" data-path="probability.html"><a href="probability.html#central-limit-theorem-approximation"><i class="fa fa-check"></i><b>24.3.7</b> Central Limit Theorem approximation</a></li>
<li class="chapter" data-level="24.3.8" data-path="probability.html"><a href="probability.html#statistical-properties-of-averages"><i class="fa fa-check"></i><b>24.3.8</b> Statistical properties of averages</a></li>
<li class="chapter" data-level="24.3.9" data-path="probability.html"><a href="probability.html#law-of-large-numbers"><i class="fa fa-check"></i><b>24.3.9</b> Law of large numbers</a></li>
<li class="chapter" data-level="24.3.10" data-path="probability.html"><a href="probability.html#misinterpreting-law-of-averages"><i class="fa fa-check"></i><b>24.3.10</b> Misinterpreting law of averages</a></li>
<li class="chapter" data-level="24.3.11" data-path="probability.html"><a href="probability.html#how-large-is-large-in-clt"><i class="fa fa-check"></i><b>24.3.11</b> How large is large in CLT?</a></li>
<li class="chapter" data-level="24.3.12" data-path="probability.html"><a href="probability.html#population-sd-versus-the-sample-sd"><i class="fa fa-check"></i><b>24.3.12</b> Population SD versus the sample SD</a></li>
<li class="chapter" data-level="24.3.13" data-path="probability.html"><a href="probability.html#exercises-28"><i class="fa fa-check"></i><b>24.3.13</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="probability.html"><a href="probability.html#case-study-the-big-short"><i class="fa fa-check"></i><b>24.4</b> Case study: The Big Short</a><ul>
<li class="chapter" data-level="24.4.1" data-path="probability.html"><a href="probability.html#interest-rates-explained-with-chance-model"><i class="fa fa-check"></i><b>24.4.1</b> Interest rates explained with chance model</a></li>
<li class="chapter" data-level="24.4.2" data-path="probability.html"><a href="probability.html#the-big-short"><i class="fa fa-check"></i><b>24.4.2</b> The Big Short</a></li>
<li class="chapter" data-level="24.4.3" data-path="probability.html"><a href="probability.html#exercises-29"><i class="fa fa-check"></i><b>24.4.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="statistical-inference.html"><a href="statistical-inference.html"><i class="fa fa-check"></i><b>25</b> Statistical Inference</a><ul>
<li class="chapter" data-level="25.1" data-path="statistical-inference.html"><a href="statistical-inference.html#polls"><i class="fa fa-check"></i><b>25.1</b> Polls</a><ul>
<li class="chapter" data-level="25.1.1" data-path="statistical-inference.html"><a href="statistical-inference.html#the-sampling-model-for-polls"><i class="fa fa-check"></i><b>25.1.1</b> The sampling model for polls</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="statistical-inference.html"><a href="statistical-inference.html#populations-samples-parameters-and-estimates"><i class="fa fa-check"></i><b>25.2</b> Populations, samples, parameters and estimates</a><ul>
<li class="chapter" data-level="25.2.1" data-path="statistical-inference.html"><a href="statistical-inference.html#the-sample-average"><i class="fa fa-check"></i><b>25.2.1</b> The sample average</a></li>
<li class="chapter" data-level="25.2.2" data-path="statistical-inference.html"><a href="statistical-inference.html#parameters"><i class="fa fa-check"></i><b>25.2.2</b> Parameters</a></li>
<li class="chapter" data-level="25.2.3" data-path="statistical-inference.html"><a href="statistical-inference.html#polling-versus-forecasting"><i class="fa fa-check"></i><b>25.2.3</b> Polling versus forecasting</a></li>
<li class="chapter" data-level="25.2.4" data-path="statistical-inference.html"><a href="statistical-inference.html#properties-of-our-estimate-expected-value-and-standard-error"><i class="fa fa-check"></i><b>25.2.4</b> Properties of our estimate: expected value and standard error</a></li>
<li class="chapter" data-level="25.2.5" data-path="statistical-inference.html"><a href="statistical-inference.html#exercises-30"><i class="fa fa-check"></i><b>25.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="statistical-inference.html"><a href="statistical-inference.html#clt"><i class="fa fa-check"></i><b>25.3</b> Central Limit Theorem in practice</a><ul>
<li class="chapter" data-level="25.3.1" data-path="statistical-inference.html"><a href="statistical-inference.html#a-monte-carlo-simulation"><i class="fa fa-check"></i><b>25.3.1</b> A Monte Carlo simulation</a></li>
<li class="chapter" data-level="25.3.2" data-path="statistical-inference.html"><a href="statistical-inference.html#the-spread"><i class="fa fa-check"></i><b>25.3.2</b> The spread</a></li>
<li class="chapter" data-level="25.3.3" data-path="statistical-inference.html"><a href="statistical-inference.html#bias-why-not-run-a-very-large-poll"><i class="fa fa-check"></i><b>25.3.3</b> Bias: why not run a very large poll?</a></li>
<li class="chapter" data-level="25.3.4" data-path="statistical-inference.html"><a href="statistical-inference.html#exercises-31"><i class="fa fa-check"></i><b>25.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.4" data-path="statistical-inference.html"><a href="statistical-inference.html#confidence-intervals"><i class="fa fa-check"></i><b>25.4</b> Confidence intervals</a><ul>
<li class="chapter" data-level="25.4.1" data-path="statistical-inference.html"><a href="statistical-inference.html#a-monte-carlo-simulation-1"><i class="fa fa-check"></i><b>25.4.1</b> A Monte Carlo simulation</a></li>
<li class="chapter" data-level="25.4.2" data-path="statistical-inference.html"><a href="statistical-inference.html#the-correct-language"><i class="fa fa-check"></i><b>25.4.2</b> The correct language</a></li>
<li class="chapter" data-level="25.4.3" data-path="statistical-inference.html"><a href="statistical-inference.html#exercises-32"><i class="fa fa-check"></i><b>25.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="statistical-inference.html"><a href="statistical-inference.html#power"><i class="fa fa-check"></i><b>25.5</b> Power</a></li>
<li class="chapter" data-level="25.6" data-path="statistical-inference.html"><a href="statistical-inference.html#p-values"><i class="fa fa-check"></i><b>25.6</b> p-values</a></li>
<li class="chapter" data-level="25.7" data-path="statistical-inference.html"><a href="statistical-inference.html#statistical-models"><i class="fa fa-check"></i><b>25.7</b> Statistical models</a><ul>
<li class="chapter" data-level="25.7.1" data-path="statistical-inference.html"><a href="statistical-inference.html#poll-aggregators"><i class="fa fa-check"></i><b>25.7.1</b> Poll aggregators</a></li>
<li class="chapter" data-level="25.7.2" data-path="statistical-inference.html"><a href="statistical-inference.html#poll-data"><i class="fa fa-check"></i><b>25.7.2</b> Poll data</a></li>
<li class="chapter" data-level="25.7.3" data-path="statistical-inference.html"><a href="statistical-inference.html#pollster-bias"><i class="fa fa-check"></i><b>25.7.3</b> Pollster bias</a></li>
<li class="chapter" data-level="25.7.4" data-path="statistical-inference.html"><a href="statistical-inference.html#data-driven-model"><i class="fa fa-check"></i><b>25.7.4</b> A data driven model</a></li>
<li class="chapter" data-level="25.7.5" data-path="statistical-inference.html"><a href="statistical-inference.html#exercises-33"><i class="fa fa-check"></i><b>25.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.8" data-path="statistical-inference.html"><a href="statistical-inference.html#bayesian-statistics"><i class="fa fa-check"></i><b>25.8</b> Bayesian statistics</a><ul>
<li class="chapter" data-level="25.8.1" data-path="statistical-inference.html"><a href="statistical-inference.html#bayes-theorem"><i class="fa fa-check"></i><b>25.8.1</b> Bayes theorem</a></li>
</ul></li>
<li class="chapter" data-level="25.9" data-path="statistical-inference.html"><a href="statistical-inference.html#bayes-theorem-simulation"><i class="fa fa-check"></i><b>25.9</b> Bayes Theorem simulation</a><ul>
<li class="chapter" data-level="25.9.1" data-path="statistical-inference.html"><a href="statistical-inference.html#bayes-in-practice"><i class="fa fa-check"></i><b>25.9.1</b> Bayes in practice</a></li>
<li class="chapter" data-level="25.9.2" data-path="statistical-inference.html"><a href="statistical-inference.html#the-hierarchical-model"><i class="fa fa-check"></i><b>25.9.2</b> The hierarchical model</a></li>
<li class="chapter" data-level="25.9.3" data-path="statistical-inference.html"><a href="statistical-inference.html#exercises-34"><i class="fa fa-check"></i><b>25.9.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.10" data-path="statistical-inference.html"><a href="statistical-inference.html#election-forecasting"><i class="fa fa-check"></i><b>25.10</b> Case study: Election forecasting</a><ul>
<li class="chapter" data-level="25.10.1" data-path="statistical-inference.html"><a href="statistical-inference.html#bayesian-approach"><i class="fa fa-check"></i><b>25.10.1</b> Bayesian approach</a></li>
<li class="chapter" data-level="25.10.2" data-path="statistical-inference.html"><a href="statistical-inference.html#the-general-bias"><i class="fa fa-check"></i><b>25.10.2</b> The general bias</a></li>
<li class="chapter" data-level="25.10.3" data-path="statistical-inference.html"><a href="statistical-inference.html#mathematical-representations-of-models"><i class="fa fa-check"></i><b>25.10.3</b> Mathematical representations of models</a></li>
<li class="chapter" data-level="25.10.4" data-path="statistical-inference.html"><a href="statistical-inference.html#predicting-the-electoral-college"><i class="fa fa-check"></i><b>25.10.4</b> Predicting the electoral college</a></li>
<li class="chapter" data-level="25.10.5" data-path="statistical-inference.html"><a href="statistical-inference.html#forecasting"><i class="fa fa-check"></i><b>25.10.5</b> Forecasting</a></li>
<li class="chapter" data-level="25.10.6" data-path="statistical-inference.html"><a href="statistical-inference.html#exercise-1"><i class="fa fa-check"></i><b>25.10.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="25.11" data-path="statistical-inference.html"><a href="statistical-inference.html#t-dist"><i class="fa fa-check"></i><b>25.11</b> The t-distribution</a></li>
<li class="chapter" data-level="25.12" data-path="statistical-inference.html"><a href="statistical-inference.html#association-tests"><i class="fa fa-check"></i><b>25.12</b> Association Tests</a><ul>
<li class="chapter" data-level="25.12.1" data-path="statistical-inference.html"><a href="statistical-inference.html#lady-tasting-tea"><i class="fa fa-check"></i><b>25.12.1</b> Lady Tasting Tea</a></li>
<li class="chapter" data-level="25.12.2" data-path="statistical-inference.html"><a href="statistical-inference.html#two-by-two-tables"><i class="fa fa-check"></i><b>25.12.2</b> Two-by-two tables</a></li>
<li class="chapter" data-level="25.12.3" data-path="statistical-inference.html"><a href="statistical-inference.html#chi-square-test"><i class="fa fa-check"></i><b>25.12.3</b> Chi-square Test</a></li>
<li class="chapter" data-level="25.12.4" data-path="statistical-inference.html"><a href="statistical-inference.html#the-odds-ratio-odds-ratio"><i class="fa fa-check"></i><b>25.12.4</b> The Odds Ratio {odds-ratio}</a></li>
<li class="chapter" data-level="25.12.5" data-path="statistical-inference.html"><a href="statistical-inference.html#confidence-intervals-for-the-odds-ratio"><i class="fa fa-check"></i><b>25.12.5</b> Confidence intervals for the odds ratio</a></li>
<li class="chapter" data-level="25.12.6" data-path="statistical-inference.html"><a href="statistical-inference.html#small-count-correction"><i class="fa fa-check"></i><b>25.12.6</b> Small count correction</a></li>
<li class="chapter" data-level="25.12.7" data-path="statistical-inference.html"><a href="statistical-inference.html#large-samples-small-p-values"><i class="fa fa-check"></i><b>25.12.7</b> Large samples, small p-values</a></li>
<li class="chapter" data-level="25.12.8" data-path="statistical-inference.html"><a href="statistical-inference.html#exercises-35"><i class="fa fa-check"></i><b>25.12.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>26</b> Regression</a><ul>
<li class="chapter" data-level="26.1" data-path="regression.html"><a href="regression.html#case-study-is-height-hereditary"><i class="fa fa-check"></i><b>26.1</b> Case study: Is height hereditary?</a></li>
<li class="chapter" data-level="26.2" data-path="regression.html"><a href="regression.html#the-correlation-coefficient"><i class="fa fa-check"></i><b>26.2</b> The correlation coefficient</a><ul>
<li class="chapter" data-level="26.2.1" data-path="regression.html"><a href="regression.html#sample-correlation-is-a-random-variable"><i class="fa fa-check"></i><b>26.2.1</b> Sample correlation is a random variable</a></li>
<li class="chapter" data-level="26.2.2" data-path="regression.html"><a href="regression.html#correlation-is-not-always-a-useful-summary"><i class="fa fa-check"></i><b>26.2.2</b> Correlation is not always a useful summary</a></li>
</ul></li>
<li class="chapter" data-level="26.3" data-path="regression.html"><a href="regression.html#conditional-expectation"><i class="fa fa-check"></i><b>26.3</b> Conditional Expectations</a></li>
<li class="chapter" data-level="26.4" data-path="regression.html"><a href="regression.html#the-regression-line"><i class="fa fa-check"></i><b>26.4</b> The regression line</a><ul>
<li class="chapter" data-level="26.4.1" data-path="regression.html"><a href="regression.html#regression-improves-precision"><i class="fa fa-check"></i><b>26.4.1</b> Regression improves precision</a></li>
<li class="chapter" data-level="26.4.2" data-path="regression.html"><a href="regression.html#bivariate-normal-distribution-advanced"><i class="fa fa-check"></i><b>26.4.2</b> Bivariate normal distribution (advanced)</a></li>
<li class="chapter" data-level="26.4.3" data-path="regression.html"><a href="regression.html#variance-explained"><i class="fa fa-check"></i><b>26.4.3</b> Variance explained</a></li>
<li class="chapter" data-level="26.4.4" data-path="regression.html"><a href="regression.html#warning-there-are-two-regression-lines"><i class="fa fa-check"></i><b>26.4.4</b> Warning: there are two regression lines</a></li>
<li class="chapter" data-level="26.4.5" data-path="regression.html"><a href="regression.html#exercises-36"><i class="fa fa-check"></i><b>26.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="26.5" data-path="regression.html"><a href="regression.html#case-study-moneyball"><i class="fa fa-check"></i><b>26.5</b> Case Study: Moneyball</a><ul>
<li class="chapter" data-level="26.5.1" data-path="regression.html"><a href="regression.html#sabermetics"><i class="fa fa-check"></i><b>26.5.1</b> Sabermetics</a></li>
<li class="chapter" data-level="26.5.2" data-path="regression.html"><a href="regression.html#baseball-basics"><i class="fa fa-check"></i><b>26.5.2</b> Baseball basics</a></li>
</ul></li>
<li class="chapter" data-level="26.6" data-path="regression.html"><a href="regression.html#no-awards-for-bb"><i class="fa fa-check"></i><b>26.6</b> No awards for BB</a><ul>
<li class="chapter" data-level="26.6.1" data-path="regression.html"><a href="regression.html#base-on-ball-or-stolen-bases"><i class="fa fa-check"></i><b>26.6.1</b> Base on Ball or Stolen Bases?</a></li>
<li class="chapter" data-level="26.6.2" data-path="regression.html"><a href="regression.html#regression-applied-to-baseball-statistics"><i class="fa fa-check"></i><b>26.6.2</b> Regression applied to baseball statistics</a></li>
</ul></li>
<li class="chapter" data-level="26.7" data-path="regression.html"><a href="regression.html#confounding"><i class="fa fa-check"></i><b>26.7</b> Confounding</a><ul>
<li class="chapter" data-level="26.7.1" data-path="regression.html"><a href="regression.html#understanding-confounding-through-stratification"><i class="fa fa-check"></i><b>26.7.1</b> Understanding confounding through stratification</a></li>
<li class="chapter" data-level="26.7.2" data-path="regression.html"><a href="regression.html#multivariate-regression"><i class="fa fa-check"></i><b>26.7.2</b> Multivariate regression</a></li>
</ul></li>
<li class="chapter" data-level="26.8" data-path="regression.html"><a href="regression.html#lse"><i class="fa fa-check"></i><b>26.8</b> Linear Models and Least Squared Estimates</a><ul>
<li class="chapter" data-level="26.8.1" data-path="regression.html"><a href="regression.html#interpreting-linear-models"><i class="fa fa-check"></i><b>26.8.1</b> Interpreting linear models</a></li>
<li class="chapter" data-level="26.8.2" data-path="regression.html"><a href="regression.html#least-squares-estimates-lse"><i class="fa fa-check"></i><b>26.8.2</b> Least Squares Estimates (LSE)</a></li>
<li class="chapter" data-level="26.8.3" data-path="regression.html"><a href="regression.html#the-lm-function"><i class="fa fa-check"></i><b>26.8.3</b> The <code>lm</code> function</a></li>
<li class="chapter" data-level="26.8.4" data-path="regression.html"><a href="regression.html#lse-are-random-variables"><i class="fa fa-check"></i><b>26.8.4</b> LSE are random variables</a></li>
<li class="chapter" data-level="26.8.5" data-path="regression.html"><a href="regression.html#predicted-values-are-random-variables"><i class="fa fa-check"></i><b>26.8.5</b> Predicted values are random variables</a></li>
<li class="chapter" data-level="26.8.6" data-path="regression.html"><a href="regression.html#exercises-37"><i class="fa fa-check"></i><b>26.8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="26.9" data-path="regression.html"><a href="regression.html#linear-regression-in-the-tidyverse"><i class="fa fa-check"></i><b>26.9</b> Linear regression in the tidyverse</a><ul>
<li class="chapter" data-level="26.9.1" data-path="regression.html"><a href="regression.html#the-broom-package"><i class="fa fa-check"></i><b>26.9.1</b> The broom package</a></li>
<li class="chapter" data-level="26.9.2" data-path="regression.html"><a href="regression.html#exercises-38"><i class="fa fa-check"></i><b>26.9.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="26.10" data-path="regression.html"><a href="regression.html#case-study-moneyball-continued"><i class="fa fa-check"></i><b>26.10</b> Case study: Moneyball continued</a><ul>
<li class="chapter" data-level="26.10.1" data-path="regression.html"><a href="regression.html#adding-salary-and-position-information"><i class="fa fa-check"></i><b>26.10.1</b> Adding salary and position information</a></li>
<li class="chapter" data-level="26.10.2" data-path="regression.html"><a href="regression.html#picking-9-players"><i class="fa fa-check"></i><b>26.10.2</b> Picking 9 players</a></li>
<li class="chapter" data-level="26.10.3" data-path="regression.html"><a href="regression.html#exercises-39"><i class="fa fa-check"></i><b>26.10.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="26.11" data-path="regression.html"><a href="regression.html#regression-fallacy"><i class="fa fa-check"></i><b>26.11</b> Regression fallacy</a></li>
<li class="chapter" data-level="26.12" data-path="regression.html"><a href="regression.html#measurement-error-models"><i class="fa fa-check"></i><b>26.12</b> Measurement error models</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html"><i class="fa fa-check"></i><b>27</b> Association is not causation</a><ul>
<li class="chapter" data-level="27.1" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#spurious-correlation"><i class="fa fa-check"></i><b>27.1</b> Spurious correlation</a></li>
<li class="chapter" data-level="27.2" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#outliers-1"><i class="fa fa-check"></i><b>27.2</b> Outliers</a></li>
<li class="chapter" data-level="27.3" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#reversing-cause-and-effect"><i class="fa fa-check"></i><b>27.3</b> Reversing cause and effect</a></li>
<li class="chapter" data-level="27.4" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#confounders"><i class="fa fa-check"></i><b>27.4</b> Confounders</a><ul>
<li class="chapter" data-level="27.4.1" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#example-uc-berkeley-admissions"><i class="fa fa-check"></i><b>27.4.1</b> Example: UC Berkeley admissions</a></li>
<li class="chapter" data-level="27.4.2" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#confounding-explained-graphically"><i class="fa fa-check"></i><b>27.4.2</b> Confounding explained graphically</a></li>
<li class="chapter" data-level="27.4.3" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#average-after-stratifying"><i class="fa fa-check"></i><b>27.4.3</b> Average after stratifying</a></li>
</ul></li>
<li class="chapter" data-level="27.5" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#simpsons-paradox"><i class="fa fa-check"></i><b>27.5</b> Simpson’s Paradox</a></li>
<li class="chapter" data-level="27.6" data-path="association-is-not-causation.html"><a href="association-is-not-causation.html#exercises-40"><i class="fa fa-check"></i><b>27.6</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>V Machine Learning</b></span></li>
<li class="chapter" data-level="28" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html"><i class="fa fa-check"></i><b>28</b> Introduction to Machine Learning</a><ul>
<li class="chapter" data-level="28.1" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#notation-1"><i class="fa fa-check"></i><b>28.1</b> Notation</a></li>
<li class="chapter" data-level="28.2" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#an-example"><i class="fa fa-check"></i><b>28.2</b> An example</a><ul>
<li class="chapter" data-level="28.2.1" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#exercises-41"><i class="fa fa-check"></i><b>28.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#evaluation-metrics"><i class="fa fa-check"></i><b>28.3</b> Evaluation Metrics</a><ul>
<li class="chapter" data-level="28.3.1" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#training-and-test-sets"><i class="fa fa-check"></i><b>28.3.1</b> Training and test sets</a></li>
<li class="chapter" data-level="28.3.2" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#overall-accuracy"><i class="fa fa-check"></i><b>28.3.2</b> Overall accuracy</a></li>
<li class="chapter" data-level="28.3.3" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#the-confusion-matrix"><i class="fa fa-check"></i><b>28.3.3</b> The confusion matrix</a></li>
<li class="chapter" data-level="28.3.4" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#sensitivity-and-specificity"><i class="fa fa-check"></i><b>28.3.4</b> Sensitivity and specificity</a></li>
<li class="chapter" data-level="28.3.5" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#balanced-accuracy-and-f_1-score"><i class="fa fa-check"></i><b>28.3.5</b> Balanced accuracy and <span class="math inline">\(F_1\)</span> score</a></li>
<li class="chapter" data-level="28.3.6" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#prevalence-matters-in-practice"><i class="fa fa-check"></i><b>28.3.6</b> Prevalence matters in practice</a></li>
<li class="chapter" data-level="28.3.7" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#roc-and-precision-recall-curves"><i class="fa fa-check"></i><b>28.3.7</b> ROC and precision-recall curves</a></li>
<li class="chapter" data-level="28.3.8" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#exercises-42"><i class="fa fa-check"></i><b>28.3.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="28.4" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#conditional-probabilities-and-expectations"><i class="fa fa-check"></i><b>28.4</b> Conditional probabilities and expectations</a><ul>
<li class="chapter" data-level="28.4.1" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#conditional-probabilities-1"><i class="fa fa-check"></i><b>28.4.1</b> Conditional probabilities</a></li>
<li class="chapter" data-level="28.4.2" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#conditional-expectations"><i class="fa fa-check"></i><b>28.4.2</b> Conditional expectations</a></li>
<li class="chapter" data-level="28.4.3" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#the-loss-function"><i class="fa fa-check"></i><b>28.4.3</b> The loss function</a></li>
<li class="chapter" data-level="28.4.4" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#conditional-expectation-minimizes-squared-loss-function"><i class="fa fa-check"></i><b>28.4.4</b> Conditional expectation minimizes squared loss function</a></li>
<li class="chapter" data-level="28.4.5" data-path="introduction-to-machine-learning.html"><a href="introduction-to-machine-learning.html#exercises-43"><i class="fa fa-check"></i><b>28.4.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="29" data-path="case-study-is-it-a-2-or-a-7.html"><a href="case-study-is-it-a-2-or-a-7.html"><i class="fa fa-check"></i><b>29</b> Case study: is it a 2 or a 7?</a></li>
<li class="chapter" data-level="30" data-path="smoothing.html"><a href="smoothing.html"><i class="fa fa-check"></i><b>30</b> Smoothing</a><ul>
<li class="chapter" data-level="30.1" data-path="smoothing.html"><a href="smoothing.html#bin-smoothing"><i class="fa fa-check"></i><b>30.1</b> Bin smoothing</a></li>
<li class="chapter" data-level="30.2" data-path="smoothing.html"><a href="smoothing.html#kernels"><i class="fa fa-check"></i><b>30.2</b> Kernels</a></li>
<li class="chapter" data-level="30.3" data-path="smoothing.html"><a href="smoothing.html#local-weighted-regression-loess"><i class="fa fa-check"></i><b>30.3</b> Local weighted regression (loess)</a></li>
<li class="chapter" data-level="30.4" data-path="smoothing.html"><a href="smoothing.html#fitting-parabolas"><i class="fa fa-check"></i><b>30.4</b> Fitting parabolas</a></li>
<li class="chapter" data-level="30.5" data-path="smoothing.html"><a href="smoothing.html#beware-of-ggplot-defaults"><i class="fa fa-check"></i><b>30.5</b> Beware of <code>ggplot</code> defaults</a></li>
<li class="chapter" data-level="30.6" data-path="smoothing.html"><a href="smoothing.html#exercises-44"><i class="fa fa-check"></i><b>30.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html"><i class="fa fa-check"></i><b>31</b> Examples of algorithms</a><ul>
<li class="chapter" data-level="31.1" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#linear-regression"><i class="fa fa-check"></i><b>31.1</b> Linear regression</a><ul>
<li class="chapter" data-level="31.1.1" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#the-predict-function"><i class="fa fa-check"></i><b>31.1.1</b> The <code>predict</code> function</a></li>
<li class="chapter" data-level="31.1.2" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#exercises-45"><i class="fa fa-check"></i><b>31.1.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="31.2" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#logistic-regression"><i class="fa fa-check"></i><b>31.2</b> Logistic regression</a><ul>
<li class="chapter" data-level="31.2.1" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#generalized-linear-models"><i class="fa fa-check"></i><b>31.2.1</b> Generalized Linear Models</a></li>
<li class="chapter" data-level="31.2.2" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#exercises-46"><i class="fa fa-check"></i><b>31.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="31.3" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>31.3</b> K-nearest neighbors</a><ul>
<li class="chapter" data-level="31.3.1" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#over-training"><i class="fa fa-check"></i><b>31.3.1</b> Over training</a></li>
<li class="chapter" data-level="31.3.2" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#over-smoothing"><i class="fa fa-check"></i><b>31.3.2</b> Over-smoothing</a></li>
<li class="chapter" data-level="31.3.3" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#picking-the-k-in-knn"><i class="fa fa-check"></i><b>31.3.3</b> Picking the <span class="math inline">\(k\)</span> in kNN</a></li>
<li class="chapter" data-level="31.3.4" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#exercises-47"><i class="fa fa-check"></i><b>31.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="31.4" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#generative-models"><i class="fa fa-check"></i><b>31.4</b> Generative models</a><ul>
<li class="chapter" data-level="31.4.1" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#naive-bayes"><i class="fa fa-check"></i><b>31.4.1</b> Naive Bayes</a></li>
<li class="chapter" data-level="31.4.2" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#controlling-prevalence"><i class="fa fa-check"></i><b>31.4.2</b> Controlling prevalence</a></li>
<li class="chapter" data-level="31.4.3" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#quadratic-discriminant-analysis"><i class="fa fa-check"></i><b>31.4.3</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="31.4.4" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#linear-discriminant-analysis"><i class="fa fa-check"></i><b>31.4.4</b> Linear discriminant analysis</a></li>
<li class="chapter" data-level="31.4.5" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#connection-to-distance"><i class="fa fa-check"></i><b>31.4.5</b> Connection to distance</a></li>
<li class="chapter" data-level="31.4.6" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#case-study-more-than-three-classes"><i class="fa fa-check"></i><b>31.4.6</b> Case study: more than three classes</a></li>
<li class="chapter" data-level="31.4.7" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#exercises-48"><i class="fa fa-check"></i><b>31.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="31.5" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#classification-and-regression-trees-cart"><i class="fa fa-check"></i><b>31.5</b> Classification and Regression Trees (CART)</a><ul>
<li class="chapter" data-level="31.5.1" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#the-curse-of-dimensionality"><i class="fa fa-check"></i><b>31.5.1</b> The curse of dimensionality</a></li>
<li class="chapter" data-level="31.5.2" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#cart-motivation"><i class="fa fa-check"></i><b>31.5.2</b> CART motivation</a></li>
<li class="chapter" data-level="31.5.3" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#regression-trees"><i class="fa fa-check"></i><b>31.5.3</b> Regression trees</a></li>
<li class="chapter" data-level="31.5.4" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#classification-decision-trees"><i class="fa fa-check"></i><b>31.5.4</b> Classification (decision) trees</a></li>
</ul></li>
<li class="chapter" data-level="31.6" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#random-forests"><i class="fa fa-check"></i><b>31.6</b> Random Forests</a><ul>
<li class="chapter" data-level="31.6.1" data-path="examples-of-algorithms.html"><a href="examples-of-algorithms.html#exercises-49"><i class="fa fa-check"></i><b>31.6.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="32" data-path="cross-validation.html"><a href="cross-validation.html"><i class="fa fa-check"></i><b>32</b> Cross validation</a><ul>
<li class="chapter" data-level="32.1" data-path="cross-validation.html"><a href="cross-validation.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>32.1</b> K-fold cross validation</a></li>
<li class="chapter" data-level="32.2" data-path="cross-validation.html"><a href="cross-validation.html#exercises-50"><i class="fa fa-check"></i><b>32.2</b> Exercises</a></li>
<li class="chapter" data-level="32.3" data-path="cross-validation.html"><a href="cross-validation.html#bootstrap"><i class="fa fa-check"></i><b>32.3</b> Bootstrap</a></li>
<li class="chapter" data-level="32.4" data-path="cross-validation.html"><a href="cross-validation.html#exercises-51"><i class="fa fa-check"></i><b>32.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="caret.html"><a href="caret.html"><i class="fa fa-check"></i><b>33</b> The caret package</a><ul>
<li class="chapter" data-level="33.1" data-path="caret.html"><a href="caret.html#the-caret-train-functon"><i class="fa fa-check"></i><b>33.1</b> The caret <code>train</code> functon</a></li>
<li class="chapter" data-level="33.2" data-path="cross-validation.html"><a href="cross-validation.html#cross-validation"><i class="fa fa-check"></i><b>33.2</b> Cross validation</a></li>
<li class="chapter" data-level="33.3" data-path="caret.html"><a href="caret.html#example-fitting-with-loess"><i class="fa fa-check"></i><b>33.3</b> Example: fitting with loess</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="machine-learning-in-practice.html"><a href="machine-learning-in-practice.html"><i class="fa fa-check"></i><b>34</b> Machine Learning in practice</a><ul>
<li class="chapter" data-level="34.1" data-path="machine-learning-in-practice.html"><a href="machine-learning-in-practice.html#preprocessing"><i class="fa fa-check"></i><b>34.1</b> Preprocessing</a></li>
<li class="chapter" data-level="34.2" data-path="machine-learning-in-practice.html"><a href="machine-learning-in-practice.html#k-nearest-neighbor"><i class="fa fa-check"></i><b>34.2</b> k-Nearest Neighbor</a></li>
<li class="chapter" data-level="34.3" data-path="machine-learning-in-practice.html"><a href="machine-learning-in-practice.html#variable-importance"><i class="fa fa-check"></i><b>34.3</b> Variable importance</a></li>
<li class="chapter" data-level="34.4" data-path="machine-learning-in-practice.html"><a href="machine-learning-in-practice.html#visual-assessments"><i class="fa fa-check"></i><b>34.4</b> Visual assessments</a></li>
<li class="chapter" data-level="34.5" data-path="machine-learning-in-practice.html"><a href="machine-learning-in-practice.html#ensembles"><i class="fa fa-check"></i><b>34.5</b> Ensembles</a></li>
<li class="chapter" data-level="34.6" data-path="machine-learning-in-practice.html"><a href="machine-learning-in-practice.html#exercises-52"><i class="fa fa-check"></i><b>34.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="large-datasets.html"><a href="large-datasets.html"><i class="fa fa-check"></i><b>35</b> Large datasets</a><ul>
<li class="chapter" data-level="35.1" data-path="large-datasets.html"><a href="large-datasets.html#matrix-algebra"><i class="fa fa-check"></i><b>35.1</b> Matrix algebra</a><ul>
<li class="chapter" data-level="35.1.1" data-path="large-datasets.html"><a href="large-datasets.html#notation-2"><i class="fa fa-check"></i><b>35.1.1</b> Notation</a></li>
<li class="chapter" data-level="35.1.2" data-path="large-datasets.html"><a href="large-datasets.html#converting-a-vector-to-a-matrix"><i class="fa fa-check"></i><b>35.1.2</b> Converting a vector to a matrix</a></li>
<li class="chapter" data-level="35.1.3" data-path="large-datasets.html"><a href="large-datasets.html#row-and-column-summaries"><i class="fa fa-check"></i><b>35.1.3</b> Row and column summaries</a></li>
<li class="chapter" data-level="35.1.4" data-path="large-datasets.html"><a href="large-datasets.html#apply"><i class="fa fa-check"></i><b>35.1.4</b> <code>apply</code></a></li>
<li class="chapter" data-level="35.1.5" data-path="large-datasets.html"><a href="large-datasets.html#filtering-columns-based-on-summaries"><i class="fa fa-check"></i><b>35.1.5</b> Filtering columns based on summaries</a></li>
<li class="chapter" data-level="35.1.6" data-path="large-datasets.html"><a href="large-datasets.html#indexing-with-matrices"><i class="fa fa-check"></i><b>35.1.6</b> Indexing with matrices</a></li>
<li class="chapter" data-level="35.1.7" data-path="large-datasets.html"><a href="large-datasets.html#binarizing-the-data"><i class="fa fa-check"></i><b>35.1.7</b> Binarizing the data</a></li>
<li class="chapter" data-level="35.1.8" data-path="large-datasets.html"><a href="large-datasets.html#vectorization-for-matrices"><i class="fa fa-check"></i><b>35.1.8</b> Vectorization for matrices</a></li>
<li class="chapter" data-level="35.1.9" data-path="large-datasets.html"><a href="large-datasets.html#matrix-algebra-operations"><i class="fa fa-check"></i><b>35.1.9</b> Matrix algebra operations</a></li>
<li class="chapter" data-level="35.1.10" data-path="large-datasets.html"><a href="large-datasets.html#exercises-53"><i class="fa fa-check"></i><b>35.1.10</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="35.2" data-path="large-datasets.html"><a href="large-datasets.html#distance"><i class="fa fa-check"></i><b>35.2</b> Distance</a><ul>
<li class="chapter" data-level="35.2.1" data-path="large-datasets.html"><a href="large-datasets.html#euclidean-distance"><i class="fa fa-check"></i><b>35.2.1</b> Euclidean distance</a></li>
<li class="chapter" data-level="35.2.2" data-path="large-datasets.html"><a href="large-datasets.html#distance-in-higher-dimensions"><i class="fa fa-check"></i><b>35.2.2</b> Distance in higher dimensions</a></li>
<li class="chapter" data-level="35.2.3" data-path="large-datasets.html"><a href="large-datasets.html#example"><i class="fa fa-check"></i><b>35.2.3</b> Example</a></li>
<li class="chapter" data-level="35.2.4" data-path="large-datasets.html"><a href="large-datasets.html#predictor-space"><i class="fa fa-check"></i><b>35.2.4</b> Predictor Space</a></li>
<li class="chapter" data-level="35.2.5" data-path="large-datasets.html"><a href="large-datasets.html#distance-between-predictors"><i class="fa fa-check"></i><b>35.2.5</b> Distance between predictors</a></li>
<li class="chapter" data-level="35.2.6" data-path="large-datasets.html"><a href="large-datasets.html#exercises-54"><i class="fa fa-check"></i><b>35.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="35.3" data-path="large-datasets.html"><a href="large-datasets.html#dimension-reduction"><i class="fa fa-check"></i><b>35.3</b> Dimension Reduction</a><ul>
<li class="chapter" data-level="35.3.1" data-path="large-datasets.html"><a href="large-datasets.html#preserving-distance"><i class="fa fa-check"></i><b>35.3.1</b> Preserving distance</a></li>
<li class="chapter" data-level="35.3.2" data-path="large-datasets.html"><a href="large-datasets.html#linear-transformations-advnced"><i class="fa fa-check"></i><b>35.3.2</b> Linear transformations (advnced)</a></li>
<li class="chapter" data-level="35.3.3" data-path="large-datasets.html"><a href="large-datasets.html#orthogogal-transformations-advaced"><i class="fa fa-check"></i><b>35.3.3</b> Orthogogal transformations (advaced)</a></li>
<li class="chapter" data-level="35.3.4" data-path="large-datasets.html"><a href="large-datasets.html#principal-component-analysis"><i class="fa fa-check"></i><b>35.3.4</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="35.3.5" data-path="large-datasets.html"><a href="large-datasets.html#iris-example"><i class="fa fa-check"></i><b>35.3.5</b> Iris Example</a></li>
<li class="chapter" data-level="35.3.6" data-path="large-datasets.html"><a href="large-datasets.html#mnist-example"><i class="fa fa-check"></i><b>35.3.6</b> MNIST Example</a></li>
<li class="chapter" data-level="35.3.7" data-path="large-datasets.html"><a href="large-datasets.html#exercises-55"><i class="fa fa-check"></i><b>35.3.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="35.4" data-path="large-datasets.html"><a href="large-datasets.html#recommendation-systems"><i class="fa fa-check"></i><b>35.4</b> Recommendation systems</a><ul>
<li class="chapter" data-level="35.4.1" data-path="large-datasets.html"><a href="large-datasets.html#movielens-data"><i class="fa fa-check"></i><b>35.4.1</b> Movielens data</a></li>
<li class="chapter" data-level="35.4.2" data-path="large-datasets.html"><a href="large-datasets.html#recommendation-systems-as-a-machine-learning-challenge"><i class="fa fa-check"></i><b>35.4.2</b> Recommendation systems as a machine learning challenge</a></li>
<li class="chapter" data-level="35.4.3" data-path="large-datasets.html"><a href="large-datasets.html#loss-function"><i class="fa fa-check"></i><b>35.4.3</b> Loss function</a></li>
<li class="chapter" data-level="35.4.4" data-path="large-datasets.html"><a href="large-datasets.html#a-first-model"><i class="fa fa-check"></i><b>35.4.4</b> A first model</a></li>
<li class="chapter" data-level="35.4.5" data-path="large-datasets.html"><a href="large-datasets.html#modeling-movie-effects"><i class="fa fa-check"></i><b>35.4.5</b> Modeling movie effects</a></li>
<li class="chapter" data-level="35.4.6" data-path="large-datasets.html"><a href="large-datasets.html#user-effects"><i class="fa fa-check"></i><b>35.4.6</b> User effects</a></li>
<li class="chapter" data-level="35.4.7" data-path="large-datasets.html"><a href="large-datasets.html#exercises-56"><i class="fa fa-check"></i><b>35.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="35.5" data-path="large-datasets.html"><a href="large-datasets.html#regularization"><i class="fa fa-check"></i><b>35.5</b> Regularization</a><ul>
<li class="chapter" data-level="35.5.1" data-path="large-datasets.html"><a href="large-datasets.html#motivation"><i class="fa fa-check"></i><b>35.5.1</b> Motivation</a></li>
<li class="chapter" data-level="35.5.2" data-path="large-datasets.html"><a href="large-datasets.html#penalized-least-squares"><i class="fa fa-check"></i><b>35.5.2</b> Penalized Least Squares</a></li>
<li class="chapter" data-level="35.5.3" data-path="large-datasets.html"><a href="large-datasets.html#choosing-the-penalty-terms"><i class="fa fa-check"></i><b>35.5.3</b> Choosing the penalty terms</a></li>
<li class="chapter" data-level="35.5.4" data-path="large-datasets.html"><a href="large-datasets.html#exercises-57"><i class="fa fa-check"></i><b>35.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="35.6" data-path="large-datasets.html"><a href="large-datasets.html#matrix-factorization"><i class="fa fa-check"></i><b>35.6</b> Matrix factorization</a><ul>
<li class="chapter" data-level="35.6.1" data-path="r-basics.html"><a href="r-basics.html#factors"><i class="fa fa-check"></i><b>35.6.1</b> Factors</a></li>
<li class="chapter" data-level="35.6.2" data-path="large-datasets.html"><a href="large-datasets.html#connection-to-svd-and-pca"><i class="fa fa-check"></i><b>35.6.2</b> Connection to SVD and PCA</a></li>
<li class="chapter" data-level="35.6.3" data-path="large-datasets.html"><a href="large-datasets.html#exercises-58"><i class="fa fa-check"></i><b>35.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="36" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>36</b> Clustering</a><ul>
<li class="chapter" data-level="36.1" data-path="clustering.html"><a href="clustering.html#hierarchical-clustering"><i class="fa fa-check"></i><b>36.1</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="36.2" data-path="clustering.html"><a href="clustering.html#k-means"><i class="fa fa-check"></i><b>36.2</b> k-means</a></li>
<li class="chapter" data-level="36.3" data-path="clustering.html"><a href="clustering.html#heatmaps"><i class="fa fa-check"></i><b>36.3</b> Heatmaps</a></li>
<li class="chapter" data-level="36.4" data-path="clustering.html"><a href="clustering.html#filtering-features"><i class="fa fa-check"></i><b>36.4</b> Filtering features</a></li>
<li class="chapter" data-level="36.5" data-path="clustering.html"><a href="clustering.html#exercises-59"><i class="fa fa-check"></i><b>36.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>VI Productivity tools</b></span></li>
<li class="chapter" data-level="37" data-path="introduction-to-productivity-tools.html"><a href="introduction-to-productivity-tools.html"><i class="fa fa-check"></i><b>37</b> Introduction to productivity tools</a></li>
<li class="chapter" data-level="38" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>38</b> GitHub</a><ul>
<li class="chapter" data-level="38.1" data-path="github.html"><a href="github.html#installing-git"><i class="fa fa-check"></i><b>38.1</b> Installing Git</a><ul>
<li class="chapter" data-level="38.1.1" data-path="github.html"><a href="github.html#installing-git-and-git-bash-on-windows"><i class="fa fa-check"></i><b>38.1.1</b> Installing Git and Git Bash on Windows</a></li>
<li class="chapter" data-level="38.1.2" data-path="github.html"><a href="github.html#installing-git-on-the-mac"><i class="fa fa-check"></i><b>38.1.2</b> Installing Git on the Mac</a></li>
</ul></li>
<li class="chapter" data-level="38.2" data-path="github.html"><a href="github.html#github-accounts"><i class="fa fa-check"></i><b>38.2</b> GitHub Accounts</a></li>
<li class="chapter" data-level="38.3" data-path="github.html"><a href="github.html#github-repositories"><i class="fa fa-check"></i><b>38.3</b> GitHub repositories</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="getting-started.html"><a href="getting-started.html#rstudio"><i class="fa fa-check"></i><b>39</b> RStudio</a><ul>
<li class="chapter" data-level="39.1" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>39.1</b> The panes</a></li>
<li class="chapter" data-level="39.2" data-path="rstudio.html"><a href="rstudio.html#key-bindings-1"><i class="fa fa-check"></i><b>39.2</b> Key bindings</a></li>
<li class="chapter" data-level="39.3" data-path="rstudio.html"><a href="rstudio.html#installing-r-packages-1"><i class="fa fa-check"></i><b>39.3</b> Installing R packages</a></li>
<li class="chapter" data-level="39.4" data-path="rstudio.html"><a href="rstudio.html#running-commands-while-editing-scripts-1"><i class="fa fa-check"></i><b>39.4</b> Running commands while editing scripts</a></li>
<li class="chapter" data-level="39.5" data-path="rstudio.html"><a href="rstudio.html#global-options"><i class="fa fa-check"></i><b>39.5</b> Global options</a></li>
<li class="chapter" data-level="39.6" data-path="rstudio.html"><a href="rstudio.html#keeping-organized-with-rstudio-projects"><i class="fa fa-check"></i><b>39.6</b> Keeping organized with RStudio projects</a></li>
<li class="chapter" data-level="39.7" data-path="rstudio.html"><a href="rstudio.html#using-git-and-github-in-rstudio"><i class="fa fa-check"></i><b>39.7</b> Using Git and GitHub in RStudio</a></li>
<li class="chapter" data-level="39.8" data-path="rstudio.html"><a href="rstudio.html#running-r-without-rstudio"><i class="fa fa-check"></i><b>39.8</b> Running R without RStudio</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="unix.html"><a href="unix.html"><i class="fa fa-check"></i><b>40</b> Organizing with Unix</a><ul>
<li class="chapter" data-level="40.1" data-path="unix.html"><a href="unix.html#the-terminal"><i class="fa fa-check"></i><b>40.1</b> The terminal</a></li>
<li class="chapter" data-level="40.2" data-path="unix.html"><a href="unix.html#filesystem"><i class="fa fa-check"></i><b>40.2</b> The filesystem</a><ul>
<li class="chapter" data-level="40.2.1" data-path="unix.html"><a href="unix.html#directories-and-subdirectories"><i class="fa fa-check"></i><b>40.2.1</b> Directories and subdirectories</a></li>
<li class="chapter" data-level="40.2.2" data-path="unix.html"><a href="unix.html#the-home-directory"><i class="fa fa-check"></i><b>40.2.2</b> The home directory</a></li>
<li class="chapter" data-level="40.2.3" data-path="unix.html"><a href="unix.html#working-directory"><i class="fa fa-check"></i><b>40.2.3</b> Working directory</a></li>
<li class="chapter" data-level="40.2.4" data-path="unix.html"><a href="unix.html#paths"><i class="fa fa-check"></i><b>40.2.4</b> Paths</a></li>
</ul></li>
<li class="chapter" data-level="40.3" data-path="unix.html"><a href="unix.html#unix-commands"><i class="fa fa-check"></i><b>40.3</b> Unix commands</a><ul>
<li class="chapter" data-level="40.3.1" data-path="unix.html"><a href="unix.html#ls-listing-directory-content"><i class="fa fa-check"></i><b>40.3.1</b> <code>ls</code>: Listing directory content</a></li>
<li class="chapter" data-level="40.3.2" data-path="unix.html"><a href="unix.html#mkdir-and-rmdir-make-and-remove-a-directory"><i class="fa fa-check"></i><b>40.3.2</b> <code>mkdir</code> and <code>rmdir</code>: make and remove a directory</a></li>
<li class="chapter" data-level="40.3.3" data-path="unix.html"><a href="unix.html#cd-navigating-the-filesystem-by-changing-directories"><i class="fa fa-check"></i><b>40.3.3</b> <code>cd</code>: Navigating the filesystem by changing directories</a></li>
</ul></li>
<li class="chapter" data-level="40.4" data-path="unix.html"><a href="unix.html#some-examples"><i class="fa fa-check"></i><b>40.4</b> Some examples</a></li>
<li class="chapter" data-level="40.5" data-path="unix.html"><a href="unix.html#more-unix-commands"><i class="fa fa-check"></i><b>40.5</b> More Unix commands</a><ul>
<li class="chapter" data-level="40.5.1" data-path="unix.html"><a href="unix.html#mv-moving-files"><i class="fa fa-check"></i><b>40.5.1</b> <code>mv</code>: moving files</a></li>
<li class="chapter" data-level="40.5.2" data-path="unix.html"><a href="unix.html#cp-copying-files"><i class="fa fa-check"></i><b>40.5.2</b> <code>cp</code>: copying files</a></li>
<li class="chapter" data-level="40.5.3" data-path="unix.html"><a href="unix.html#rm-removing-files"><i class="fa fa-check"></i><b>40.5.3</b> <code>rm</code>: removing files</a></li>
<li class="chapter" data-level="40.5.4" data-path="unix.html"><a href="unix.html#less-looking-at-a-file"><i class="fa fa-check"></i><b>40.5.4</b> <code>less</code>: looking at a file</a></li>
</ul></li>
<li class="chapter" data-level="40.6" data-path="unix.html"><a href="unix.html#preparing-for-a-data-science-project"><i class="fa fa-check"></i><b>40.6</b> Preparing for a data science project</a></li>
<li class="chapter" data-level="40.7" data-path="unix.html"><a href="unix.html#advanced-unix"><i class="fa fa-check"></i><b>40.7</b> Advanced Unix</a><ul>
<li class="chapter" data-level="40.7.1" data-path="unix.html"><a href="unix.html#arguments"><i class="fa fa-check"></i><b>40.7.1</b> Arguments</a></li>
<li class="chapter" data-level="40.7.2" data-path="unix.html"><a href="unix.html#getting-help"><i class="fa fa-check"></i><b>40.7.2</b> Getting help</a></li>
<li class="chapter" data-level="40.7.3" data-path="unix.html"><a href="unix.html#pipes"><i class="fa fa-check"></i><b>40.7.3</b> Pipes</a></li>
<li class="chapter" data-level="40.7.4" data-path="unix.html"><a href="unix.html#wild-cards"><i class="fa fa-check"></i><b>40.7.4</b> Wild cards</a></li>
<li class="chapter" data-level="40.7.5" data-path="unix.html"><a href="unix.html#environment-variables"><i class="fa fa-check"></i><b>40.7.5</b> Environment variables</a></li>
<li class="chapter" data-level="40.7.6" data-path="unix.html"><a href="unix.html#shells"><i class="fa fa-check"></i><b>40.7.6</b> Shells</a></li>
<li class="chapter" data-level="40.7.7" data-path="unix.html"><a href="unix.html#executables"><i class="fa fa-check"></i><b>40.7.7</b> Executables</a></li>
<li class="chapter" data-level="40.7.8" data-path="unix.html"><a href="unix.html#permissions-and-file-types"><i class="fa fa-check"></i><b>40.7.8</b> Permissions and file types</a></li>
<li class="chapter" data-level="40.7.9" data-path="unix.html"><a href="unix.html#commands-you-should-learn"><i class="fa fa-check"></i><b>40.7.9</b> Commands you should learn</a></li>
<li class="chapter" data-level="40.7.10" data-path="unix.html"><a href="unix.html#file-manipulation-in-r"><i class="fa fa-check"></i><b>40.7.10</b> File manipulation in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="41" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>41</b> Git</a><ul>
<li class="chapter" data-level="41.1" data-path="git.html"><a href="git.html#why-use-git-and-github"><i class="fa fa-check"></i><b>41.1</b> Why use Git and GitHub?</a></li>
<li class="chapter" data-level="41.2" data-path="git.html"><a href="git.html#overview-of-git"><i class="fa fa-check"></i><b>41.2</b> Overview of Git</a><ul>
<li class="chapter" data-level="41.2.1" data-path="git.html"><a href="git.html#clone"><i class="fa fa-check"></i><b>41.2.1</b> Clone</a></li>
</ul></li>
<li class="chapter" data-level="41.3" data-path="git.html"><a href="git.html#initilazing-a-git-directory"><i class="fa fa-check"></i><b>41.3</b> Initilazing a Git directory</a></li>
</ul></li>
<li class="chapter" data-level="42" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html"><i class="fa fa-check"></i><b>42</b> Reproducible reports with R Markdown</a><ul>
<li class="chapter" data-level="42.1" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#r-markdown"><i class="fa fa-check"></i><b>42.1</b> R Markdown</a><ul>
<li class="chapter" data-level="42.1.1" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#the-header"><i class="fa fa-check"></i><b>42.1.1</b> The header</a></li>
<li class="chapter" data-level="42.1.2" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#r-code-chunks"><i class="fa fa-check"></i><b>42.1.2</b> R code chunks</a></li>
<li class="chapter" data-level="42.1.3" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#global-options-1"><i class="fa fa-check"></i><b>42.1.3</b> Global options</a></li>
</ul></li>
<li class="chapter" data-level="42.2" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#knitr"><i class="fa fa-check"></i><b>42.2</b> knitR</a></li>
<li class="chapter" data-level="42.3" data-path="reproducible-reports-with-r-markdown.html"><a href="reproducible-reports-with-r-markdown.html#more-on-r-markdown"><i class="fa fa-check"></i><b>42.3</b> More on R markdown</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="statistical-inference" class="section level1">
<h1><span class="header-section-number">Chapter 25</span> Statistical Inference</h1>
<p>In this chapter we will demonstrate how <em>poll aggregators</em>, such as FiveThirtyEight, collected and combined data reported by different experts to produce improved predictions. The two main statistical tools used by the aggregators are the topic of this chapter: inference and modeling. To begin to understand how election forecasting works, we need to understand the basic data point they use: poll results. After introducing how polls work we will briefly introduce the main concepts of statistical inference and modeling and then demonstrate how these were used to forecast elections.</p>
<div id="polls" class="section level2">
<h2><span class="header-section-number">25.1</span> Polls</h2>
<p>Opinion polling has been conducted since the 19th century. The general goal of these is to describe the opinions held by a specific population on a given set of topics. In recent times, these polls have been pervasive during presidential elections. Polls are useful when interviewing every member of a particular population is logistically impossible. The general strategy is to interview a smaller group, chosen at random, and then infer the opinions of the entire population from the opinions of the smaller group. Statistical theory is used to justify the process. This theory is referred to as <em>inference</em> and it is the main topic of this chapter.</p>
<p>Perhaps the best known opinion polls are those conducted to determine which candidate is preferred by voters in a given election. Political strategists make extensive use of polls to decide, among other things, how to invest resources. For example, they may want to know which geographical locations to focus their ‘get out the vote’ efforts.</p>
<p>Elections are a particularly interesting case of opinion polls because the actual opinion of the entire population is revealed on election day. Of course, it costs millions of dollars to run an actual election which makes polling a cost effective strategy for those that want to forecast the results.</p>
<p>Although typically the results of these polls are kept private, similar polls are conducted by news organizations because results tend to be of interest to the general public and made public. We will eventually be looking at such data.</p>
<p><a href="http://www.realclearpolitics.com">Real Clear Politics</a> is an example of a news aggregator that organizes and publishes poll results. For example, <a href="http://www.realclearpolitics.com/epolls/2016/president/us/general_election_trump_vs_clinton-5491.html">here</a> are examples of polls reporting estimates of the popular vote for the 2016 presidential election:</p>
<p><img src="inference/img/rcp-polls.png" width="70%" style="display: block; margin: auto;" /></p>
<p>(Source: <a href="https://www.realclearpolitics.com/epolls/2016/president/us/general_election_trump_vs_clinton-5491.html">Real Clear Politics</a>)</p>
<p>Although in the United States the popular vote does not determine the result of the presidential election, we will use it as an illustrative and simple example of how well polls work. Forecasting the election is a more complex process since it involves combining results from 50 states and DC and we describe it in Section <a href="statistical-inference.html#election-forecasting">25.10</a>.</p>
<p>Let’s make some observations about the table above. First, note that different polls, all taken days before the election, report a different <em>spread</em>: the estimated difference between support for the two candidates. Notice also that the reported spreads hover around what ended up being the actual result: Clinton won the popular vote by 2.1%. We also see a column titled <strong>MoE</strong> which stands for <em>margin of error</em>.</p>
<p>In this section, we will show how the probability concepts we learned in the previous chapter can be applied to develop the statistical approaches that make polls an effective tool. We will learn the statistical concepts necessary to define <em>estimates</em> and <em>margins of errors</em>, and show how we can use these to forecast final results relatively well and also provide an estimate of the precision of our forecast. Once we learn this, we will be able to understand two concepts that are ubiquitous in data science: <em>confidence intervals</em> and <em>p-values</em>. Finally, to understand probabilistic statements about the probability of a candidate winning, we will have to learn about Bayesian modelling. In the final sections, we put it all together to recreate the simplified version of the FiveThirtyEight model and apply it to the 2016 election.</p>
<p>We start by connecting probability theory to the task of using polls to learn about a population.</p>
<div id="the-sampling-model-for-polls" class="section level3">
<h3><span class="header-section-number">25.1.1</span> The sampling model for polls</h3>
<p>To help us understand the connection between polls and what we have learned, let’s construct a similar situation to the one pollsters face. To mimic the challenge real pollsters face in terms of competing with other pollsters for media attention, we will use an urn full of beads to represent voters and pretend we are a competiting for a $25 dollar prize. The challenge is to guess the spread between the proportion of blue and red beads in this urn (in this case, a pickle jar):</p>
<p><img src="inference/img/urn.jpg" width="3in" style="display: block; margin: auto;" /></p>
<p>Before making a prediction, you can take a sample (with replacement) from the urn. To mimic the fact that running polls is expensive, it cost you $0.10 per each bead you sample. Therefore, if your sample size is 250, and you win, you will break even since you will pay $25 to collect your $25 prize. Your entry into the competition can be an interval. If the interval you submit contains the true proportion, you get half what you paid and pass to the second phase of the competition. In the second phase, the entry with the smallest interval is selected as the winner.</p>
<p>The <strong>dslabs</strong> package includes a function that shows a random draw from this urn:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(dslabs)
<span class="kw">take_poll</span>(<span class="dv">25</span>)</code></pre></div>
<p><img src="book_files/figure-html/first-simulated-poll-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Think about how you would construct your interval based on the data shown above.</p>
<p>We have just described a simple sampling model for opinion polls. The beads inside the urn represent the individuals that will vote on election day. Those that will vote for the Republican candidate are represented with red beads and the Democrats with the blue beads. For simplicity, assume there are no other colors; that is, that there are just two parties.</p>
</div>
</div>
<div id="populations-samples-parameters-and-estimates" class="section level2">
<h2><span class="header-section-number">25.2</span> Populations, samples, parameters and estimates</h2>
<p>We want to predict the proportion of blue beads in the urn. Let’s call this quantity <span class="math inline">\(p\)</span>, which then tells us the proportion of red beads <span class="math inline">\(1-p\)</span>, and the spread <span class="math inline">\(p - (1-p)\)</span>, which simplifies to <span class="math inline">\(2p - 1\)</span>.</p>
<p>In statistical textbooks, the beads in the urn are called the <em>population</em>. The proportion of blue beads in the population <span class="math inline">\(p\)</span> is called a <em>parameter</em>. The 25 beads we see in the previous plot are called a <em>sample</em>. The task of statistical inference is to predict the parameter <span class="math inline">\(p\)</span> using the observed data in the sample.</p>
<p>Can we do this with the 25 observations above? It is certainly informative. For example, given that we see 13 red and 12 blue beads, it is unlikely that <span class="math inline">\(p\)</span> &gt; .9 or <span class="math inline">\(p\)</span> &lt; .1. But are we ready to predict with certainty that there are more red beads than blue in the jar?</p>
<p>We want to construct an estimate of <span class="math inline">\(p\)</span> using only the information we observe. An estimate should be thought of as a summary of the observed data that we think is informative about the parameter of interest. It seems intuitive to think that the proportion of blue beads in the sample <span class="math inline">\(0.48\)</span> must be at least related to the actual proportion <span class="math inline">\(p\)</span>. But do we simply predict <span class="math inline">\(p\)</span> to be 0.48? First, remember that the sample proportion is a random variable. If we run the command <code>take_poll(25)</code> four times we get a different answer each time since the sample proportion is a random variable.</p>
<p><img src="book_files/figure-html/four-simulated-polls-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Note that in the four random samples shown above, the sample proportions range from 0.44 to 0.60. By describing the distribution of this random variable, we will be able to gain insights into how good this estimate is and how we can make it better.</p>
<div id="the-sample-average" class="section level3">
<h3><span class="header-section-number">25.2.1</span> The sample average</h3>
<p>Conducting an opinion poll is being modeled as taking a random sample from an urn. We are proposing the use of the proportion of blue beads in our sample as an <em>estimate</em> of the parameter <span class="math inline">\(p\)</span>. Once we have this estimate, we can can easily report an estimate for the spread <span class="math inline">\(2p-1\)</span>, but for simplicity we will illustrate the concepts for estimating <span class="math inline">\(p\)</span>. We will use our knowledge of probability to defend our use of the sample proportion and quantify how close we think it is from the population proportion <span class="math inline">\(p\)</span>.</p>
<p>We start by defining the random variable <span class="math inline">\(X=1\)</span> if we pick a blue bead at random and <span class="math inline">\(X=0\)</span> if it is red. This implies that the population is a list of 0s and 1s. If we sample <span class="math inline">\(N\)</span> beads, then the average of the draws <span class="math inline">\(X_1, \dots, X_N\)</span> is equivalent to the proportion of blue beads in our sample. This is because adding the <span class="math inline">\(X\)</span>s is equivalent to counting the blue beads and dividing this count by the total <span class="math inline">\(N\)</span> is equivalent to computing a proportion. We use the symbol <span class="math inline">\(\bar{X}\)</span> to represent this average. In general, in statistics textbooks a bar on top of a symbol means the average.</p>
<p>The theory we just learned about the sum of draws becomes useful because if we that the distribution of the average <span class="math inline">\(\bar{X}\)</span> because <span class="math inline">\(N\)</span> is a non-random constant.</p>
<p>For simplicity, let’s assume that the draws are independent: after we see each sampled bead, we return it to the urn. In this case, what do we know about the distribution of the sum of draws? First, we know that the expected value of the sum of draws is <span class="math inline">\(N\)</span> times the average of the values in the urn. We know that the average of the 0s and 1s in the urn must be <span class="math inline">\(p\)</span>, the proportion of blue beads.</p>
<p>Here we encounter an important difference with what we did in the Probability chapter: we don’t know what is in the urn. We know there are blue and red beads, but we don’t know how many of each. This is what we want to find out: we are trying to <strong>estimate</strong> <span class="math inline">\(p\)</span>.</p>
</div>
<div id="parameters" class="section level3">
<h3><span class="header-section-number">25.2.2</span> Parameters</h3>
<p>Just like we use variables to define unknowns in systems of equations, in statistical inference we define <em>parameters</em> to define unknown parts of our models. In the urn model which we are using to mimic an opinion poll, we do not know the proportion of blue beads in the urn. We define the parameters <span class="math inline">\(p\)</span> to represent this quantity. <span class="math inline">\(p\)</span> is the average of the urn because if we take the average of the 1s (blue) and 0s (red), we get the proportion of blue beads. Since our main goal is figuring out what is <span class="math inline">\(p\)</span>, we are going to <em>estimate this parameter</em>.</p>
<p>The ideas presented here on how we estimate parameters and provide insights into how good these estimates are, extrapolate to many data science tasks. For example, we may want to determine the difference in health improvement between patients receiving treatment and a control group. We may ask what are the health effects of smoking on a population? What are the differences in racial groups of fatal shootings by police? What is the rate of change in life expectancy in the US during the last 10 years? All these questions can be framed as a task of estimating a parameter from a sample.</p>
</div>
<div id="polling-versus-forecasting" class="section level3">
<h3><span class="header-section-number">25.2.3</span> Polling versus forecasting</h3>
<p>Before we continue, let’s make an important clarification related to the practical problem of forecasting the election. If a poll is conducted four months before the election, it is estimating the <span class="math inline">\(p\)</span> for that moment and not for election day. The <span class="math inline">\(p\)</span> for election night might be different since people’s opinions fluctuate through time. The polls provided the night before the election tend to be the most accurate since opinions don’t change that much in a day. However, forecasters try to build tools that model how opinions vary across time and try to predict the election night results taking into consideration the fact that opinions fluctuate. We will describe some approaches for doing this in our a later section.</p>
</div>
<div id="properties-of-our-estimate-expected-value-and-standard-error" class="section level3">
<h3><span class="header-section-number">25.2.4</span> Properties of our estimate: expected value and standard error</h3>
<p>To understand how good our estimate is, we will describe the statistical properties of the random variable defined above: the sample proportion <span class="math inline">\(\bar{X}\)</span>. Remember that <span class="math inline">\(\bar{X}\)</span> is the sum of independent draws so the rules we covered in the probability chapter apply.</p>
<p>Using what we have learned, the expected value of the sum <span class="math inline">\(N\bar{X}\)</span> is <span class="math inline">\(N \times\)</span> the average of the urn, <span class="math inline">\(p\)</span>. So dividing by the non-random constant <span class="math inline">\(N\)</span> gives us that the expected value of the average <span class="math inline">\(\bar{X}\)</span> is <span class="math inline">\(p\)</span>. We can write it using our mathematical notation:</p>
<p><span class="math display">\[
\mbox{E}(\bar{X}) = p
\]</span></p>
<p>We can also use what we learned to figure out the standard error: the standard error of the sum is <span class="math inline">\(\sqrt{N} \times\)</span> the standard deviation of the urn. Can we compute the standard error of the urn? We learned a formula that tells us that it is <span class="math inline">\((1-0) \sqrt{p (1-p)}\)</span> = <span class="math inline">\(\sqrt{p (1-p)}\)</span>. Because we are dividing the sum by <span class="math inline">\(N\)</span>, we arrive at the following formula for the standard error for the average:</p>
<p><span class="math display">\[
\mbox{SE}(\bar{X}) = \sqrt{p(1-p)/N}
\]</span></p>
<p>This result reveals the power of polls. The expected value of the sample proportion <span class="math inline">\(\bar{X}\)</span> is the parameter of interest <span class="math inline">\(p\)</span> and we can make the standard error as small as we want by increasing <span class="math inline">\(N\)</span>. The law of large numbers tells us that with a large enough poll, our estimate converges to <span class="math inline">\(p\)</span>.</p>
<p>If we take a large enough poll to make our standard error about 1%, we will be quite certain about who will win. But how large does the poll have to be for the standard error to be this small?</p>
<p>One problem is that we do not know <span class="math inline">\(p\)</span>, so we can’t compute the standard error. However, for illustrative purposes, let’s assume that <span class="math inline">\(p=0.51\)</span> and make a plot of the standard error versus the sample size <span class="math inline">\(N\)</span>:</p>
<p><img src="book_files/figure-html/standard-error-versus-sample-size-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>From the plot we see that we would need a poll of over 10,000 people to get the standard error that low. We rarely see polls of this size due in part to costs. From the Real Clear Politics table, we learn that the sample sizes in opinion polls range from 500-3,500 people. For a sample size of 1,000 and <span class="math inline">\(p=0.51\)</span>, the standard error is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqrt</span>(p<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>p))<span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">1000</span>)
<span class="co">#&gt; [1] 0.0158</span></code></pre></div>
<p>or 1.5 percentage points. So even with large polls, for close elections, <span class="math inline">\(\bar{X}\)</span> can lead us astray if we don’t realize it is a random variable. Nonetheless, we can actually say more about how close we get the <span class="math inline">\(p\)</span> and we do that in Section <a href="statistical-inference.html#clt">25.3</a></p>
</div>
<div id="exercises-30" class="section level3">
<h3><span class="header-section-number">25.2.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Suppose you poll a population in which a proportion <span class="math inline">\(p\)</span> of voters are Democrats and <span class="math inline">\(1-p\)</span> are Republicans. Your sample size is <span class="math inline">\(N=25\)</span>. Consider the random variable <span class="math inline">\(S\)</span> which is the <strong>total</strong> number of Democrats in your sample. What is the expected value of this random variable? Hint: it’s a function of <span class="math inline">\(p\)</span>.</p></li>
<li><p>What is the standard error of <span class="math inline">\(S\)</span> ? Hint: it’s a function of <span class="math inline">\(p\)</span>.</p></li>
<li><p>Consider the random variable <span class="math inline">\(S/N\)</span>. This is equivalent to the sample average, which we have been denoting as <span class="math inline">\(\bar{X}\)</span>. What is the expected value of the <span class="math inline">\(\bar{X}\)</span>? Hint: it’s a function of <span class="math inline">\(p\)</span>.</p></li>
<li><p>What is the standard error of <span class="math inline">\(\bar{X}\)</span>? Hint: it’s a function of <span class="math inline">\(p\)</span>.</p></li>
<li><p>Write a line of code that gives you the standard error <code>se</code> for the problem above for several values of <span class="math inline">\(p\)</span>, specifically for <code>p &lt;- seq(0, 1, length = 100)</code>. Make a plot of <code>se</code> versus <code>p</code>.</p></li>
<li><p>Copy the code above and put it inside a for-loop to make the plot for <span class="math inline">\(N=25\)</span>, <span class="math inline">\(N=100\)</span> and <span class="math inline">\(N=1000\)</span>.</p></li>
<li><p>If we are interested in the difference in proportions, <span class="math inline">\(p - (1-p)\)</span>, our estimate is <span class="math inline">\(d = \bar{X} - (1-\bar{X})\)</span>. Use the rules we learned about sums of random variables and scaled random variables to derive the expected value of <span class="math inline">\(d\)</span>.</p></li>
<li><p>What is the standard error of <span class="math inline">\(d\)</span>?</p></li>
<li><p>If the actual <span class="math inline">\(p=.45\)</span>, it means the Republicans are winning by a relatively large margin since <span class="math inline">\(d= -.1\)</span>, which is a 10% margin of victory. In this case, what is the standard error of <span class="math inline">\(2\hat{X}-1\)</span> if we take a sample of <span class="math inline">\(N=25\)</span>?</p></li>
<li><p>Given the answer to 9, which of the following best describes your strategy of using a sample size of <span class="math inline">\(N=25\)</span>?</p>
<p>A. The expected value of our estimate <span class="math inline">\(2\bar{X}-1\)</span> is <span class="math inline">\(d\)</span>, so our prediction will be right on.</p>
<p>B. Our standard error is larger than the difference, so the chances of <span class="math inline">\(2\bar{X}-1\)</span> being positive and throwing us off were not that small. We should pick a larger sample size.</p>
<p>C. The difference is 10% and the standard error is about 0.2, therefore much smaller than the difference.</p>
<p>D. Because we don’t know <span class="math inline">\(p\)</span>, we have no way knowing that making <span class="math inline">\(N\)</span> larger would actually improve our standard error.</p></li>
</ol>

</div>
</div>
<div id="clt" class="section level2">
<h2><span class="header-section-number">25.3</span> Central Limit Theorem in practice</h2>
<p>The CLT tells us that the distribution function for a sum of draws is approximately normal. We also learned that dividing a normally distributed random variable by a constant is also a normally distributed variable. This implies that the distribution of <span class="math inline">\(\bar{X}\)</span> is approximately normal.</p>
<p>In summary, we have that <span class="math inline">\(\bar{X}\)</span> has an approximately normal distribution with expected value <span class="math inline">\(p\)</span> and standard error <span class="math inline">\(\sqrt{p(1-p)/N}\)</span>.</p>
<p>Now how does this help us? Suppose we want to know what is the probability that we are within 1% from <span class="math inline">\(p\)</span>. We are basically asking what is</p>
<p><span class="math display">\[
\mbox{Pr}(| \bar{X} - p| \leq .01)
\]</span> which is the same as:</p>
<p><span class="math display">\[
\mbox{Pr}(\bar{X}\leq p + .01) - \mbox{Pr}(\bar{X} \leq p - .01)
\]</span></p>
<p>Can we answer this question? We can use the mathematical trick we learned in the previous chapter. Subtract the expected value and divide by the standard error to get a standard normal random variable, call it <span class="math inline">\(Z\)</span>, on the left. Since <span class="math inline">\(p\)</span> is the expected value and <span class="math inline">\(\mbox{SE}(\bar{X}) = \sqrt{p(1-p)/N}\)</span> is the standard error we get:</p>
<p><span class="math display">\[
\mbox{Pr}\left(Z \leq \,.01 / \mbox{SE}(\bar{X}) \right) -
\mbox{Pr}\left(Z \leq - \,.01 / \mbox{SE}(\bar{X}) \right) 
\]</span></p>
<p>One problem we have is that since we don’t know <span class="math inline">\(p\)</span>, we don’t know <span class="math inline">\(\mbox{SE}(\bar{X})\)</span>. But it turns out that the CLT still works if we estimate the standard error by using <span class="math inline">\(\bar{X}\)</span> in place of <span class="math inline">\(p\)</span>. We say that we <em>plug-in</em> the estimate. Our estimate of the standard error is therefore:</p>
<p><span class="math display">\[
\hat{\mbox{SE}}(\bar{X})=\sqrt{\bar{X}(1-\bar{X})/N}
\]</span> In statistics textbooks, we use a little hat to denote estimates. The estimate can be constructed using the observed data and <span class="math inline">\(N\)</span>.</p>
<p>Now we continue with our calculation, but dividing by <span class="math inline">\(\hat{\mbox{SE}}(\bar{X})=\sqrt{\bar{X}(1-\bar{X})/N})\)</span> instead. In our first sample we had 12 blue and 13 red so <span class="math inline">\(\bar{X} = 0.48\)</span> and our estimate of standard error is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x_hat &lt;-<span class="st"> </span><span class="fl">0.48</span>
se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x_hat<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>x_hat)<span class="op">/</span><span class="dv">25</span>)
se
<span class="co">#&gt; [1] 0.0999</span></code></pre></div>
<p>And now we can answer the question of the probability of being close to <span class="math inline">\(p\)</span>. The answer is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pnorm</span>(<span class="fl">0.01</span><span class="op">/</span>se) <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="op">-</span><span class="fl">0.01</span><span class="op">/</span>se)
<span class="co">#&gt; [1] 0.0797</span></code></pre></div>
<p>Therefore, there is a small chance that we will be close. A poll of only <span class="math inline">\(N=25\)</span> people is not really very useful, at least not for a close election.</p>
<p>Earlier we mentioned the <em>margin of error</em>. Now we can define it because it is simply two times the standard error, which we can now estimate. In our case it is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="fl">1.96</span><span class="op">*</span>se
<span class="co">#&gt; [1] 0.196</span></code></pre></div>
<p>Why do we multiply by 1.96? Because if you ask what is the probability that we are within 1.96 standard errors from <span class="math inline">\(p\)</span>, we get:</p>
<p><span class="math display">\[
\mbox{Pr}\left(Z \leq \, 1.96\,\mbox{SE}(\bar{X})  / \mbox{SE}(\bar{X}) \right) -
\mbox{Pr}\left(Z \leq - 1.96\, \mbox{SE}(\bar{X}) / \mbox{SE}(\bar{X}) \right) 
\]</span> which is:</p>
<p><span class="math display">\[
\mbox{Pr}\left(Z \leq 1.96 \right) -
\mbox{Pr}\left(Z \leq - 1.96\right) 
\]</span></p>
<p>which we know is about 95%:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pnorm</span>(<span class="fl">1.96</span>)<span class="op">-</span><span class="kw">pnorm</span>(<span class="op">-</span><span class="fl">1.96</span>)
<span class="co">#&gt; [1] 0.95</span></code></pre></div>
<p>Hence, there is a 95% probability that <span class="math inline">\(\bar{X}\)</span> will be within <span class="math inline">\(1.96\times \hat{SE}(\bar{X})\)</span>, in our case 0, to <span class="math inline">\(p\)</span>. Note that 95% is somewhat of an arbitrary choice and sometimes other percentages are used, but it is the most commonly used value to define <em>margin of error</em>. We often round 1.96 up to 2 for simplicity of presentation.</p>
<p>In summary, the CLT tells us that our poll based on a sample size of <span class="math inline">\(25\)</span> is not very useful. We don’t really learn much when the margin of error is this large. All we can really say is that the popular vote will not be won by a large margin. This is why pollsters tend to use larger sample sizes.</p>
<p>From the table above, we see that typical sample sizes range from 700 to 3500. To see how this gives us a much more practical result, notice that if we had obtained a <span class="math inline">\(\bar{X}\)</span>=0.48 with a sample size of 2,000, our standard error <span class="math inline">\(\hat{\mbox{SE}}(\bar{X})\)</span> would have been 0.011. So our result is an estimate of <code>48</code>% with a margin of error of 2%. In this case, the result is much more informative and would make us think that there are more red balls than blue. Keep in mind, however, that this is hypothetical. We did not take a poll of 2,000 since we don’t want to ruin the competition.</p>
<div id="a-monte-carlo-simulation" class="section level3">
<h3><span class="header-section-number">25.3.1</span> A Monte Carlo simulation</h3>
<p>Suppose we want to use a Monte Carlo simulation to corroborate the tools we have built using probability theory. To create the simulation, we would write code like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">B &lt;-<span class="st"> </span><span class="dv">10000</span>
N &lt;-<span class="st"> </span><span class="dv">1000</span>
x_hat &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {
  x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">size =</span> N, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>p, p))
  <span class="kw">mean</span>(x)
})</code></pre></div>
<p>The problem is, of course, we don’t know <code>p</code>. We could construct an urn like the one pictured above and run an analog (without a computer) simulation. It would take a long time, but you could take 10,000 samples, count the beads and keep track of the proportions of blue. We can use the function <code>take_poll(n=1000)</code> instead of drawing from an actual urn, but it would still take time to count the beads and enter the results.</p>
<p>One thing we therefore do to corroborate theoretical results is to pick one or several values of <code>p</code> and run the simulations. Let’s set <code>p=0.45</code>. We can then simulate a poll:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="fl">0.45</span>
N &lt;-<span class="st"> </span><span class="dv">1000</span>

x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">size =</span> N, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>p, p))
x_hat &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</code></pre></div>
<p>In this particular sample, our estimate is <code>x_hat</code>. We can use that code to do a Monte Carlo simulation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">B &lt;-<span class="st"> </span><span class="dv">10000</span>
x_hat &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {
  x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">size =</span> N, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>p, p))
  <span class="kw">mean</span>(x)
})</code></pre></div>
<p>To review, the theory tells us that <span class="math inline">\(\bar{X}\)</span> is approximately normally distributed, has expected value <span class="math inline">\(p=\)</span> 0.45 and standard error <span class="math inline">\(\sqrt{p(1-p)/N}\)</span> = 0.016. The simulation confirms this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(x_hat)
<span class="co">#&gt; [1] 0.45</span>
<span class="kw">sd</span>(x_hat)
<span class="co">#&gt; [1] 0.0156</span></code></pre></div>
<p>A histogram and qq-plot confirm that the normal approximation is accurate as well:</p>
<p><img src="book_files/figure-html/normal-approximation-for-polls-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Of course, in real life we would never be able to run such an experiment because we don’t know <span class="math inline">\(p\)</span>. But we could run it for various values of <span class="math inline">\(p\)</span> and <span class="math inline">\(N\)</span> and see that the theory does indeed work well for most values. You can easily do this by re-running the code above after changing <code>p</code> and <code>N</code>.</p>
</div>
<div id="the-spread" class="section level3">
<h3><span class="header-section-number">25.3.2</span> The spread</h3>
<p>The competition is to predict the spread, not the proportion <span class="math inline">\(p\)</span>. However, because we are assuming there are only two parties, we know that the spread if <span class="math inline">\(p - (1-p) = 2p - 1\)</span>. As a result, everything we have done can easily be adapted to an estimate of <span class="math inline">\(2p - 1\)</span>. Once we have our estimate <span class="math inline">\(\bar{X}\)</span> and <span class="math inline">\(\hat{\mbox{SE}}(\bar{X})\)</span>, we estimate the spread with <span class="math inline">\(2\bar{X} - 1\)</span> and, since we are multiplying by 2, the standard error is <span class="math inline">\(2\hat{\mbox{SE}}(\bar{X})\)</span>. Note that subtracting 1 does not add any variability so it does not affect the standard error.</p>
<p>For our 25 sample above, our estimate <span class="math inline">\(p\)</span> is <code>.48</code> with margin of error <code>.20</code> and our estimate of the spread is <code>0.04</code> with margin of error <code>.40</code>. Again, not a very useful sample size. However, the point is that once we have an estimate and standard error for <span class="math inline">\(p\)</span>, we have it for the spread <span class="math inline">\(2p-1\)</span>.</p>
</div>
<div id="bias-why-not-run-a-very-large-poll" class="section level3">
<h3><span class="header-section-number">25.3.3</span> Bias: why not run a very large poll?</h3>
<p>For realistic values of <span class="math inline">\(p\)</span>, say from 0.35 to 0.65, if we run a very large poll with 100,000 people, theory tells us that we would predict the election perfectly since the largest possible margin of error is around 0.3%. Here are the calculations:</p>
<p><img src="book_files/figure-html/standard-error-versus-p-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>One reason is that running such a poll is very expensive. Another possibly more important reason is that theory has its limitations. Polling is much more complicated than picking beads from an urn. Some people might lie to pollsters and others might not have phones. But perhaps the most important way an actual poll differs from an urn model is that we actually don’t know for sure who is in our population and who is not. How do we know who is going to vote? Are we reaching all possible voters? Hence, even if our margin of error is very small, it might not be exactly right that our expected value is <span class="math inline">\(p\)</span>. We call this bias. Historically, we observe that polls are indeed biased, although not by that much. The typical bias appears to be about 1-2%. This makes election forecasting a bit more interesting and we will talk about how to model this in a later chapter.</p>
</div>
<div id="exercises-31" class="section level3">
<h3><span class="header-section-number">25.3.4</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Write an <em>urn model</em> function that takes the proportion of Democrats <span class="math inline">\(p\)</span> and the sample size <span class="math inline">\(N\)</span> as arguments and returns the sample average if Democrats are 1s and Republicans are 0s. Call the function <code>take_sample</code>.</p></li>
<li><p>Now assume <code>p &lt;- 0.45</code> and that your sample size is <span class="math inline">\(N=100\)</span>. Take a sample 10,000 times and save the vector of <code>mean(X) - p</code> into an object called <code>errors</code>. Hint: use the function you wrote for exercise 1 to write this in one line of code.</p></li>
<li><p>The vector <code>errors</code> contains, for each simulated sample, the difference between the actual <span class="math inline">\(p\)</span> and our estimate <span class="math inline">\(\bar{X}\)</span>. We refer to this difference as the <em>error</em>. Compute the average and make a histogram of the errors generated in the Monte Carlo simulation and select which of the following best describes their distributions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(errors)
<span class="kw">hist</span>(errors)</code></pre></div>
<p>A. The errors are all about 0.05.</p>
<p>B. The error are all about -0.05.</p>
<p>C. The errors are symmetrically distributed around 0.</p>
<p>D. The errors range from -1 to 1.</p></li>
<li><p>The error <span class="math inline">\(\bar{X}-p\)</span> is a random variable. In practice, the error is not observed because we do not know <span class="math inline">\(p\)</span>. Here we observe it because we constructed the simulation. What is the average size of the error if we define the size by taking the absolute value <span class="math inline">\(\mid \bar{X} - p \mid\)</span> ?</p></li>
<li><p>The standard error is related to the typical <strong>size</strong> of the error we make when predicting. We say <strong>size</strong> because we just saw that the errors are centered around 0, so thus the averate error value 0. For mathematical reasons related to the Central Limit Theorem, we actually use the standard deviation of <code>errors</code> rather than the average of the absolute values to quantify the typical size. What is this standard deviation of the errors?</p></li>
<li><p>The theory we just learned tells us what this standard deviation is going to be because it is the standard error of <span class="math inline">\(\bar{X}\)</span>. What does theory tell us is the standard error of <span class="math inline">\(\bar{X}\)</span> for a sample size of 100.</p></li>
<li><p>In practice, we don’t know <span class="math inline">\(p\)</span>, so we construct an estimate of the theoretical prediction based by plugging in <span class="math inline">\(\bar{X}\)</span> for <span class="math inline">\(p\)</span>. Compute this estimate. Set the seed at 1 with <code>set.seed(1)</code>.</p></li>
<li><p>Note how close the standard error estimates obtained from the Monte Carlo simulation (exercise 5), the theoretical prediction (exercise 6), and the estimate of the theoretical prediction (exercise 7) are. The theory is working and it gives us a practical approach to knowing the typical error we will make if we predict <span class="math inline">\(p\)</span> with <span class="math inline">\(\bar{X}\)</span>. Another advantage that the theoretical result provides is that it gives an idea of how large a sample size is required to obtain the precision we need. Earlier we learned that the largest standard errors occur for <span class="math inline">\(p=0.5\)</span>. Create a plot of the largest standard error for <span class="math inline">\(N\)</span> ranging from 100 to 5,000. Based on this plot, how large does the sample size have to be to have a standard error of about 1%?</p>
<p>A. 100</p>
<p>B. 500</p>
<p>C. 2,500</p>
<p>D. 4,000</p></li>
<li><p>For sample size <span class="math inline">\(N=100\)</span>, the central limit theorem tells us that the distribution of <span class="math inline">\(\bar{X}\)</span> is:</p>
<p>A. practically equal to <span class="math inline">\(p\)</span>.</p>
<p>B. approximately normal with expected value <span class="math inline">\(p\)</span> and standard error <span class="math inline">\(\sqrt{p(1-p)/N}\)</span>.</p>
<p>C. approximately normal with expected value <span class="math inline">\(\bar{X}\)</span> and standard error <span class="math inline">\(\sqrt{\bar{X}(1-\bar{X})/N}\)</span>.</p>
<p>D. not a random variable.</p></li>
<li><p>Based on the answer from exercise 8, the error <span class="math inline">\(\bar{X} - p\)</span> is:</p>
<p>A. practically equal to 0.</p>
<p>B. approximately normal with expected value <span class="math inline">\(0\)</span> and standard error <span class="math inline">\(\sqrt{p(1-p)/N}\)</span>.</p>
<p>C. approximately normal with expected value <span class="math inline">\(p\)</span> and standard error <span class="math inline">\(\sqrt{p(1-p)/N}\)</span>.</p>
<p>D. not a random variable.</p></li>
<li><p>To corroborate your answer to exercise 9, make a qq-plot of the <code>errors</code> you generated in exercise 2 to see if they follow a normal distribution.</p></li>
<li><p>If <span class="math inline">\(p=0.45\)</span> and <span class="math inline">\(N=100\)</span> as in exercise 2, use the CLT to estimate the probability that <span class="math inline">\(\bar{X}&gt;0.5\)</span>. You can assume you know <span class="math inline">\(p=0.45\)</span> for this calculation.</p></li>
<li><p>Assume you are in a practical situation and you don’t know <span class="math inline">\(p\)</span>. Take a sample of size <span class="math inline">\(N=100\)</span> and obtain a sample average of <span class="math inline">\(\bar{X} = 0.51\)</span>. What is the CLT approximation for the probability that your error is equal or larger than 0.01?</p></li>
</ol>

</div>
</div>
<div id="confidence-intervals" class="section level2">
<h2><span class="header-section-number">25.4</span> Confidence intervals</h2>
<p>Confidence intervals are a very useful concept widely employed by data analysts. A version of these that are commonly seen come from the <code>ggplot</code> geometry <code>geom_smooth</code>. Here is an example using a temperature dataset available in R:</p>
<p><img src="book_files/figure-html/first-confidence-intervals-example-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In the Machine Learning part we will learn how the curve is formed, but for now consider the shaded area around the curve. This is created using the concept of confidence intervals.</p>
<p>In our earlier competition, you were asked to give an interval. If the interval you submitted includes the <span class="math inline">\(p\)</span>, you get half the money you spent on your “poll” back and pass to the next stage of the competition. One way to pass to the second round is to report a very large interval. For example, the interval <span class="math inline">\([0,1]\)</span> is guaranteed to include <span class="math inline">\(p\)</span>. However, with an interval this big, we have no chance of winning the competition. Similarly, if you are an election forecaster and predict the spread will be between -100% and 100%, you will be ridiculed for stating the obvious. Even a smaller interval, such as saying the spread will be between -10 and 10%, will not be considered serious.</p>
<p>On the other hand, the smaller the interval we report, the smaller our chances are of winning the prize. Likewise, a bold pollster that reports very small intervals and misses the mark most of the time will not be considered a good pollster. We want to be somewhere in between.</p>
<p>We can use the statistical theory we have learned to compute the probability of any given interval including <span class="math inline">\(p\)</span>. If we are asked to create an interval with, say, a 95% chance of including <span class="math inline">\(p\)</span>, we can do that as well. These are called 95% confidence intervals.</p>
<p>When a pollster reports an estimate and a margin of error, they are, in a way, reporting a 95% confidence interval. Let’s show how this works mathematically.</p>
<p>We want to know the probability that the interval <span class="math inline">\([\bar{X} - 2\hat{\mbox{SE}}(\bar{X}), \bar{X} - 2\hat{\mbox{SE}}(\bar{X})]\)</span> contains the true proportion <span class="math inline">\(p\)</span>. First, consider that the start and end of these intervals are random variables: every time we take a sample, they change. To illustrate this, run the Monte Carlo simulation above twice. We use the same parameters as above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="fl">0.45</span>
N &lt;-<span class="st"> </span><span class="dv">1000</span></code></pre></div>
<p>And notice that the interval here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">size =</span> N, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>p, p))
x_hat &lt;-<span class="st"> </span><span class="kw">mean</span>(x)
se_hat &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_hat) <span class="op">/</span><span class="st"> </span>N)
<span class="kw">c</span>(x_hat <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se_hat, x_hat <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se_hat)
<span class="co">#&gt; [1] 0.433 0.495</span></code></pre></div>
<p>is different from this one:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">size=</span>N, <span class="dt">replace=</span><span class="ot">TRUE</span>, <span class="dt">prob=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>p, p))
x_hat &lt;-<span class="st"> </span><span class="kw">mean</span>(x)
se_hat &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_hat) <span class="op">/</span><span class="st"> </span>N)
<span class="kw">c</span>(x_hat <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se_hat, x_hat <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se_hat)
<span class="co">#&gt; [1] 0.443 0.505</span></code></pre></div>
<p>Keep sampling and creating intervals and you will see the random variation.</p>
<p>To determine the probability that the interval includes <span class="math inline">\(p\)</span>, we need to compute this: <span class="math display">\[
\mbox{Pr}\left(\bar{X} - 1.96\hat{\mbox{SE}}(\bar{X}) \leq p \leq \bar{X} + 1.96\hat{\mbox{SE}}(\bar{X})\right)
\]</span></p>
<p>By subtracting and dividing the same quantities in all parts of the equation, we get that the above is equivalent to:</p>
<p><span class="math display">\[
\mbox{Pr}\left(-1.96 \leq \frac{\bar{X}- p}{\hat{\mbox{SE}}(\bar{X})} \leq  1.96\right)
\]</span></p>
<p>The term in the middle is an approximately normal random variable with expected value 0 and standard error 1, which we have been denoting with <span class="math inline">\(Z\)</span>, so we have:</p>
<p><span class="math display">\[
\mbox{Pr}\left(-1.96 \leq Z \leq  1.96\right)
\]</span></p>
<p>which we can quickly compute using :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pnorm</span>(<span class="fl">1.96</span>) <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="op">-</span><span class="fl">1.96</span>)
<span class="co">#&gt; [1] 0.95</span></code></pre></div>
<p>proving that we have a 95% probability.</p>
<p>If we want to have a larger probability, say 99%, we need to multiply by whatever <code>z</code> satisfies the following:</p>
<p><span class="math display">\[
\mbox{Pr}\left(-z \leq Z \leq  z\right) = 0.99
\]</span></p>
<p>Using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.995</span>)
z
<span class="co">#&gt; [1] 2.58</span></code></pre></div>
<p>will achieve this because by definition <code>pnorm(qnorm(0.995))</code> is 0.995 and by symmetry <code>pnorm(1-qnorm(0.995))</code> is 1 - 0.995. As a consequence, we have that:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pnorm</span>(z) <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="op">-</span>z)
<span class="co">#&gt; [1] 0.99</span></code></pre></div>
<p>is <code>0.995 - 0.005 = 0.99</code>. We can use this approach for any proportion <span class="math inline">\(p\)</span>: we set <code>z = qnorm(1 - (1 - p)/2)</code> becuase <span class="math inline">\(1 - (1 - p)/2 + (1 - p)/2 = p\)</span>.</p>
<p>So, for example, for <span class="math inline">\(p=0.95\)</span>, <span class="math inline">\((1-p)/2 = 0.975\)</span> and we get the 1.96 we have been using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qnorm</span>(<span class="fl">0.975</span>)
<span class="co">#&gt; [1] 1.96</span></code></pre></div>
<div id="a-monte-carlo-simulation-1" class="section level3">
<h3><span class="header-section-number">25.4.1</span> A Monte Carlo simulation</h3>
<p>We can run a Monte Carlo simulation to confirm that, in fact, a 95% confidence interval includes <span class="math inline">\(p\)</span> 95% of the time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="dv">1000</span>
B &lt;-<span class="st"> </span><span class="dv">10000</span>
inside &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {
  x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">size =</span> N, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>p, p))
  x_hat &lt;-<span class="st"> </span><span class="kw">mean</span>(x)
  se_hat &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_hat) <span class="op">/</span><span class="st"> </span>N)
  <span class="kw">between</span>(p, x_hat <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se_hat, x_hat <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se_hat)
})
<span class="kw">mean</span>(inside)
<span class="co">#&gt; [1] 0.948</span></code></pre></div>
<p>The following plot shows the first 100 confidence intervals. In this case, we created the simulation so the black line denotes the parameter we are trying to estimate:</p>
<p><img src="book_files/figure-html/confidence-interval-coverage-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="the-correct-language" class="section level3">
<h3><span class="header-section-number">25.4.2</span> The correct language</h3>
<p>When using the theory we described above, it is important to remember that it is the intervals that are random, not <span class="math inline">\(p\)</span>. In the plot above, we can see the random intervals moving around and <span class="math inline">\(p\)</span>, represented with the vertical line, staying in the same place. The proportion of blue in the urn <span class="math inline">\(p\)</span> is not. So the 95% relates to the probability that this random interval falls on top of <span class="math inline">\(p\)</span>. Saying the <span class="math inline">\(p\)</span> has a 95% of being between this and that is technically an incorrect statement because <span class="math inline">\(p\)</span> is not random.</p>
</div>
<div id="exercises-32" class="section level3">
<h3><span class="header-section-number">25.4.3</span> Exercises</h3>
<p>For these exercises, we will use actual polls from the 2016 election. You can load the data from the <strong>dslabs</strong> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dslabs)
<span class="kw">data</span>(<span class="st">&quot;polls_us_election_2016&quot;</span>)</code></pre></div>
<p>Specifically, we will use all the national polls that ended within one week before the election.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
polls &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(enddate <span class="op">&gt;=</span><span class="st"> &quot;2016-10-31&quot;</span> <span class="op">&amp;</span><span class="st"> </span>state <span class="op">==</span><span class="st"> &quot;U.S.&quot;</span>) </code></pre></div>
<ol style="list-style-type: decimal">
<li><p>For the first poll, you can obtain the samples size and estimated Clinton percentage with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span>polls<span class="op">$</span>samplesize[<span class="dv">1</span>]
x_hat &lt;-<span class="st"> </span>polls<span class="op">$</span>rawpoll_clinton[<span class="dv">1</span>]<span class="op">/</span><span class="dv">100</span></code></pre></div>
<p>Assume there are only two candidates and construct a 95% confidence interval for the election night proportion <span class="math inline">\(p\)</span>.</p></li>
<li><p>Now use <code>dplyr</code> to add a confidence interval as two columns, call them <code>lower</code> and <code>upper</code>, to the object <code>poll</code>. Then use <code>select</code> to show the <code>pollster</code>, <code>enddate</code>, <code>x_hat</code>,<code>lower</code>, <code>upper</code> variables. Hint: define temporary columns <code>x_hat</code> and <code>se_hat</code>.</p></li>
<li><p>The final tally for the popular vote was Clinton 48.2% and Trump 46.1%. Add a column, call it <code>hit</code>, to the previous table stating if the confidence interval included the true proportion <span class="math inline">\(p=0.482\)</span> or not.</p></li>
<li><p>For the table you just created, what proportion of confidence intervals included <span class="math inline">\(p\)</span>?</p></li>
<li><p>If these confidence intervals are constructed correctly, and the theory holds up, what proportion should include <span class="math inline">\(p\)</span>?</p></li>
<li><p>A much smaller proportion of the polls than expected produce confidence intervals containing <span class="math inline">\(p\)</span>. If you look closely at the table, you will see that most polls that fail to include <span class="math inline">\(p\)</span> are underestimating. The reason for this is undecided voters, individuals polled that do not yet know who they will vote for or do not want to say. Because, historically, undecideds divide evenly between the two main candidates on election day, it is more informative to estimate the spread or the difference between the proportion of two candidates <span class="math inline">\(d\)</span>, which in this election was <span class="math inline">\(0.482 - 0.461 = 0.021\)</span>. Assume that there are only two parties and that <span class="math inline">\(d = 2p - 1\)</span>, define:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(enddate <span class="op">&gt;=</span><span class="st"> &quot;2016-10-31&quot;</span> <span class="op">&amp;</span><span class="st"> </span>state <span class="op">==</span><span class="st"> &quot;U.S.&quot;</span>)  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d_hat =</span> rawpoll_clinton <span class="op">/</span><span class="st"> </span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</code></pre></div>
<p>and re-do exercise 1, but for the difference.</p></li>
<li><p>Now repeat exercise 3, but for the difference.</p></li>
<li><p>Now repeat exercise 4, but for the difference.</p></li>
<li><p>Although the proportion of confidence intervals goes up substantially, it is still lower that 0.95. In the next chapter, we learn the reason for this. To motivate this, make a plot of the error, the difference between each poll’s estimate and the actual <span class="math inline">\(d=0.021\)</span>. Stratify by pollster.</p></li>
<li><p>Re-do the plot that you made for exercise 9, but only for pollsters that took five or more polls.</p></li>
</ol>
</div>
</div>
<div id="power" class="section level2">
<h2><span class="header-section-number">25.5</span> Power</h2>
<p>Pollsters are not successful at providing correct confidence intervals, but rather at predicting who will win. When we took a 25 bead sample size, the confidence interval for the spread:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="dv">25</span>
x_hat &lt;-<span class="st"> </span><span class="fl">0.48</span>
(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>x_hat <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">1.96</span>, <span class="fl">1.96</span>) <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(x_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>x_hat) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(N))
<span class="co">#&gt; [1] -0.935  0.817</span></code></pre></div>
<p>includes 0. If this were a poll and we were forced to make a declaration, we would have to say it was a “toss-up”.</p>
<p>A problem with our poll results is that given the sample size and the value of <span class="math inline">\(p\)</span>, we would have to sacrifice on the probability of an incorrect call to create an interval that does not include 0.</p>
<p>This does not mean that the election is close. It only means that we have a small sample size. In statistical textbooks this is called lack of <em>power</em>. In the context of polls, <em>power</em> is the probability of detecting spreads different from 0.</p>
<p>By increasing our sample size, we lower our standard error and therefore have a much better chance of detecting the direction of the spread.</p>
</div>
<div id="p-values" class="section level2">
<h2><span class="header-section-number">25.6</span> p-values</h2>
<p>p-values are ubiquitous in the scientific literature. They are related to confidence intervals so we introduce the concept here.</p>
<p>Let’s consider the blue and red beads. Suppose that rather than wanting an estimate of the spread or the proportion of blue, I am interested only in the question: are there more blue beads or red beads? I want to know if the spread <span class="math inline">\(2p-1 &gt; 0\)</span>.</p>
<p>Say we take a random sample of <span class="math inline">\(N=100\)</span> and we observe <span class="math inline">\(52\)</span> blue beads, which gives us <span class="math inline">\(2\bar{X}-1=0.04\)</span>. This seems to be pointing to the existence of more blue than red beads since 0.04 is larger than 0. However, as data scientists we need to be skeptical. We know there is chance involved in this process and we could get a 52 even when the actual spread is 0. We call the assumption that the spread is <span class="math inline">\(2p-1=0\)</span> a <em>null hypothesis</em>. The null hypothesis is the skeptic’s hypothesis. We have observed a random variable <span class="math inline">\(2*\bar{X}-1 = 0.04\)</span> and the p-value is the answer to the question: how likely is it to see a value this large, when the null hypothesis is true? So we write:</p>
<p><span class="math display">\[\mbox{Pr}(\mid \bar{X} - 0.5 \mid &gt; 0.02 ) \]</span></p>
<p>assuming the <span class="math inline">\(2p-1=0\)</span> or <span class="math inline">\(p=0.5\)</span>. Under the null hypothesis we know that:</p>
<p><span class="math display">\[
\sqrt{N}\frac{\bar{X} - 0.5}{\sqrt{0.5(1-0.5)}}
\]</span></p>
<p>is standard normal. We therefore can compute the probability above, which is the p-value.</p>
<p><span class="math display">\[\mbox{Pr}\left(\sqrt{N}\frac{\mid \bar{X} - 0.5\mid}{\sqrt{0.5(1-0.5)}} &gt; \sqrt{N} \frac{0.02}{ \sqrt{0.5(1-0.5)}}\right)\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N=<span class="dv">100</span>
z &lt;-<span class="st"> </span><span class="kw">sqrt</span>(N)<span class="op">*</span><span class="fl">0.02</span><span class="op">/</span><span class="fl">0.5</span>
<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="kw">pnorm</span>(z) <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="op">-</span>z))
<span class="co">#&gt; [1] 0.689</span></code></pre></div>
<p>In this case, there is actually a large chance of seeing 52 or larger under the null hypothesis.</p>
<p>Keep in mind that there is a close connection between p-values and confidence intervals. If a 95% confidence interval of the spread does not include 0, we know that the p-value must be smaller than 0.05.</p>
<p>To learn more about p-values, you can consult any statistics textbook. However, in general, we prefer reporting confidence intervals over p-values since it gives us an idea of the size of the estimate. If we just report the p-value we provide no information about the significance of the finding in the context of the problem.</p>

</div>
<div id="statistical-models" class="section level2">
<h2><span class="header-section-number">25.7</span> Statistical models</h2>
<p>“All models are wrong, but some are useful” -George E. P. Box</p>
<p>In this section we will describe how statistical models were used by Fivethirtyeight, and other poll aggregotors, to improve the election forecasts power of individual polls.</p>
<div id="poll-aggregators" class="section level3">
<h3><span class="header-section-number">25.7.1</span> Poll aggregators</h3>
<p>As we described earlier, a few weeks before the 2012 election Nate Silver was giving Obama a 90% chance of winning. How was Mr. Silver so confident? We will use a Monte Carlo simulation to illustrate the insight Mr. Silver had and others missed. To do this, we generate results for 12 polls taken the week before the election. We mimic sample sizes from actual polls and construct and report 95% confidence intervals for each of the 12 polls. We save the results from this simulation in a data frame and add a poll ID column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(dslabs)
d &lt;-<span class="st"> </span><span class="fl">0.039</span>
Ns &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1298</span>, <span class="dv">533</span>, <span class="dv">1342</span>, <span class="dv">897</span>, <span class="dv">774</span>, <span class="dv">254</span>, <span class="dv">812</span>, <span class="dv">324</span>, <span class="dv">1291</span>, <span class="dv">1056</span>, <span class="dv">2172</span>, <span class="dv">516</span>)
p &lt;-<span class="st"> </span>(d <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>

polls &lt;-<span class="st"> </span><span class="kw">map_df</span>(Ns, <span class="cf">function</span>(N) {
  x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">size=</span>N, <span class="dt">replace=</span><span class="ot">TRUE</span>, <span class="dt">prob=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>p, p))
  x_hat &lt;-<span class="st"> </span><span class="kw">mean</span>(x)
  se_hat &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_hat) <span class="op">/</span><span class="st"> </span>N)
  <span class="kw">list</span>(<span class="dt">estimate =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x_hat <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, 
    <span class="dt">low =</span> <span class="dv">2</span><span class="op">*</span>(x_hat <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se_hat) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, 
    <span class="dt">high =</span> <span class="dv">2</span><span class="op">*</span>(x_hat <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se_hat) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,
    <span class="dt">sample_size =</span> N)
}) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">poll =</span> <span class="kw">seq_along</span>(Ns))</code></pre></div>
<p>Here is a visualization showing the intervals the pollsters would have reported for the difference between Obama and Romney:</p>
<p><img src="book_files/figure-html/simulated-polls-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Not surprisingly, all 12 polls report confidence intervals that include the election night result (dashed line). However, all 12 polls also include 0 (solid black line) as well. Therefore, if asked individually for a prediction, the pollsters would have to say: it’s a toss-up. Below we describe a key insight they are missing.</p>
<p>Poll aggregators, such as Nate Silver, realized that by combining the results of different polls you could greatly improve precision. By doing this, we are effectively conducting a poll with a huge sample size. We can therefore report a smaller 95% confidence interval and a more precise prediction.</p>
<p>Although as aggregators we do not have access to the raw poll data, we can use mathematics to reconstruct what we would have obtained had we made one large poll with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(polls<span class="op">$</span>sample_size)
<span class="co">#&gt; [1] 11269</span></code></pre></div>
<p>participants. Basically, we construct an estimate of the spread, let’s call it <span class="math inline">\(d\)</span>, with a weighted average in the following way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d_hat &lt;-<span class="st"> </span>polls <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg =</span> <span class="kw">sum</span>(estimate<span class="op">*</span>sample_size) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(sample_size)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(avg)</code></pre></div>
<p>Once we have an estimate of <span class="math inline">\(d\)</span>, we can construct an estimate for the proportion voting for Obama, which we can then use to estimate the standard error. Once we do this, we see that our margin of error is 0.018.</p>
<p>Thus, we can predict that the spread will be 3.1 plus or minus 1.8, which not only includes the actual result we eventually observed on election night, but is quite far from including 0. Once we combine the 12 polls, we become quite certain that Obama will win the popular vote.</p>
<p><img src="book_files/figure-html/confidence-coverage-2008-election-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Of course, this was just a simulation to illustrate the idea. The actual data science exercise of forecasting elections is much more complicated and it involves modeling. Below we explain how pollsters fit multilevel models to the data and use this to forecast election results. In the 2008 and 2012 US presidential elections, Nate Silver used this approach to make an almost perfect prediction and silence the pundits.</p>
<p>Since the 2008 elections, other organizations have started their own election forecasting group that, like Nate Silver’s, aggregates polling data and uses statistical models to make predictions. In 2016, forecasters underestimated Trump’s chances of winning greatly.</p>
<p><img src="inference/img/pollster-2016-predictions.png" width="100%" style="display: block; margin: auto;" /></p>
<p>(Source: <a href="https://www.nytimes.com/interactive/2016/upshot/presidential-polls-forecast.html">New York Times</a>)</p>
<p>For example, the Princeton Election Consortium gave Trump less than 1% chance of winning, while the Huffington Post gave him a 2% chance. In contrast, FiveThirtyEight had Trump’s probability of winning at 29%, higher than tossing two coins and getting two heads. In fact, four days before the election FiveThirtyEight published an article titled <a href="https://fivethirtyeight.com/features/trump-is-just-a-normal-polling-error-behind-clinton/"><em>Trump Is Just A Normal Polling Error Behind Clinton</em></a>. By understanding statistical models and how these forecasters use them, we will start to understand how this happened.</p>
<p>Although not nearly as interesting as predicting the electoral college, for illustrative purposes we will start by looking at predictions for the popular vote. FiveThirtyEight predicted a 3.6% advantage for Clinton, included the actual result of 2.1% (48.2% to 46.1%) in their interval, and was much more confident about Clinton winning the election, giving her a 81.4% chance.</p>
<p><img src="inference/img/popular-vote-538.png" width="70%" style="display: block; margin: auto;" /></p>
<p>(Source: <a href="https://projects.fivethirtyeight.com/2016-election-forecast/">FiveThirtyEight</a>)</p>
<p>We introduce actual data from the 2016 US presidential election to show how models are motivated and built to produce these predictions.</p>
</div>
<div id="poll-data" class="section level3">
<h3><span class="header-section-number">25.7.2</span> Poll data</h3>
<p>We use public polling data organized by FiveThirtyEight for the 2016 presidential election. The data is included as part of of the <strong>dslabs</strong> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(polls_us_election_<span class="dv">2016</span>)
<span class="kw">names</span>(polls_us_election_<span class="dv">2016</span>)
<span class="co">#&gt;  [1] &quot;state&quot;            &quot;startdate&quot;        &quot;enddate&quot;         </span>
<span class="co">#&gt;  [4] &quot;pollster&quot;         &quot;grade&quot;            &quot;samplesize&quot;      </span>
<span class="co">#&gt;  [7] &quot;population&quot;       &quot;rawpoll_clinton&quot;  &quot;rawpoll_trump&quot;   </span>
<span class="co">#&gt; [10] &quot;rawpoll_johnson&quot;  &quot;rawpoll_mcmullin&quot; &quot;adjpoll_clinton&quot; </span>
<span class="co">#&gt; [13] &quot;adjpoll_trump&quot;    &quot;adjpoll_johnson&quot;  &quot;adjpoll_mcmullin&quot;</span></code></pre></div>
<p>The table includes results for national polls, as well as state polls, taken during the year prior to the election. For this first example, we will filter the data to include national polls conducted during the week before the election. We also remove polls that FiveThirtyEight has determined not to be reliable and graded with a “B” or less. Some polls have not been graded and we include those:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;U.S.&quot;</span> <span class="op">&amp;</span><span class="st"> </span>enddate <span class="op">&gt;=</span><span class="st"> &quot;2016-10-31&quot;</span> <span class="op">&amp;</span>
<span class="st">           </span>(grade <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A+&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;A-&quot;</span>,<span class="st">&quot;B+&quot;</span>) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(grade)))</code></pre></div>
<p>We add a spread estimate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls &lt;-<span class="st"> </span>polls <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>)</code></pre></div>
<p>For this example, we will assume that there are only two parties and call <span class="math inline">\(p\)</span> the proportion voting for Clinton and <span class="math inline">\(1-p\)</span> the proportion voting for Trump. We are interested in the spread <span class="math inline">\(2p-1\)</span>. Let’s call the spread <span class="math inline">\(d\)</span> (for difference).</p>
<p>We have 49 estimates of the spread. The theory we learned tells us that these estimates are a random variable with a probability distribution that is approximately normal. The expected value is the election night spread <span class="math inline">\(d\)</span> and the standard error is <span class="math inline">\(\sqrt{p (1 - p) / N}\)</span>. Assuming the urn model we described earlier is a good one, we can use this information to construct a confidence interval based on the aggregated data. The estimated spread is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d_hat &lt;-<span class="st"> </span>polls <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">d_hat =</span> <span class="kw">sum</span>(spread <span class="op">*</span><span class="st"> </span>samplesize) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(samplesize)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(d_hat)</code></pre></div>
<p>and the standard error is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_hat &lt;-<span class="st"> </span>(d_hat<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span> 
moe &lt;-<span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(p_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_hat) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(polls<span class="op">$</span>samplesize))
moe
<span class="co">#&gt; [1] 0.00662</span></code></pre></div>
<p>So we report a spread of 1.43% with a margin of error of 0.66%. On election night, we discover that the actual percentage was 2.1%, which is outside a 95% confidence interval. What happened?</p>
<p>A histogram of the reported spreads shows a problem:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(spread)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color=</span><span class="st">&quot;black&quot;</span>, <span class="dt">binwidth =</span> .<span class="dv">01</span>)</code></pre></div>
<p><img src="book_files/figure-html/polls-2016-spread-histogram-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The data does not appear to be normally distributed and the standard error appears to be larger than 0.007. The theory is not quite working here.</p>
</div>
<div id="pollster-bias" class="section level3">
<h3><span class="header-section-number">25.7.3</span> Pollster bias</h3>
<p>Notice that various pollsters are involved and some are taking several polls a week:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(pollster) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="kw">n</span>())
<span class="co">#&gt; # A tibble: 15 x 2</span>
<span class="co">#&gt;   pollster                                                   `n()`</span>
<span class="co">#&gt;   &lt;fct&gt;                                                      &lt;int&gt;</span>
<span class="co">#&gt; 1 ABC News/Washington Post                                       7</span>
<span class="co">#&gt; 2 Angus Reid Global                                              1</span>
<span class="co">#&gt; 3 CBS News/New York Times                                        2</span>
<span class="co">#&gt; 4 Fox News/Anderson Robbins Research/Shaw &amp; Company Research     2</span>
<span class="co">#&gt; 5 IBD/TIPP                                                       8</span>
<span class="co">#&gt; 6 Insights West                                                  1</span>
<span class="co">#&gt; # ... with 9 more rows</span></code></pre></div>
<p>Let’s visualize the data for the pollsters that are regularly polling:</p>
<p><img src="book_files/figure-html/pollster-bias-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This plot reveals a unexpected result. First, consider that the standard error predicted by theory for each poll:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(pollster) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;=</span><span class="st"> </span><span class="dv">6</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">se =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(p_hat <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>p_hat) <span class="op">/</span><span class="st"> </span><span class="kw">median</span>(samplesize)))
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   pollster                     se</span>
<span class="co">#&gt;   &lt;fct&gt;                     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 ABC News/Washington Post 0.0265</span>
<span class="co">#&gt; 2 IBD/TIPP                 0.0333</span>
<span class="co">#&gt; 3 Ipsos                    0.0225</span>
<span class="co">#&gt; 4 The Times-Picayune/Lucid 0.0196</span>
<span class="co">#&gt; 5 USC Dornsife/LA Times    0.0183</span></code></pre></div>
<p>is between 0.018 and 0.033, which agrees with the within poll variation we see. However, there appears to be differences <em>across the polls</em>. Note, for example, how the USC Dornsife/LA Times pollster is predicting a 4% win for Trump, while Ipsos is predicting a win larger than 5% for Clinton. The theory we learned says nothing about different pollsters producing polls with different expected values. All the polls should have the same expected value. FiveThirtyEight refers to these differences as “house effects”. We can also call them <em>pollster bias</em>.</p>
<p>In the following section, rather than use the urn model theory, we are instead going to develop a data-driven model.</p>
</div>
<div id="data-driven-model" class="section level3">
<h3><span class="header-section-number">25.7.4</span> A data driven model</h3>
<p>For each pollster, let’s collect their last reported result before the election:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">one_poll_per_pollster &lt;-<span class="st"> </span>polls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(pollster) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(enddate <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(enddate)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()</code></pre></div>
<p>Here is a histogram of the data for these 15 pollsters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span>(spread, <span class="dt">data =</span> one_poll_per_pollster, <span class="dt">geom =</span> <span class="st">&quot;histogram&quot;</span>, <span class="dt">binwidth =</span> <span class="fl">0.01</span>)</code></pre></div>
<p><img src="book_files/figure-html/pollster-bias-histogram-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In the previous section, we saw that using the urn model theory to combine these results might not be appropriate due to the pollster effect. Instead, we will model this spread data directly.</p>
<p>The new model can also be thought of as an urn model, although the connection is not as direct. Rather than 0s (Republicans) and 1s (Democrats), our urn now contains poll results from all possible pollsters. We <em>assume</em> that the expected value of our urn is the actual spread <span class="math inline">\(d=2p-1\)</span>.</p>
<p>Because instead of 0s and 1s, our urn contains continuous numbers between -1 and 1, the standard deviation of the urn is no longer <span class="math inline">\(\sqrt{p(1-p)}\)</span>. Rather than voter sampling variability, the standard error now includes the pollster to pollster variability. Our new urn, also includes the sampling variability from the polling. Regardless, this standard deviation is now an unknown parameter. In statistics textbooks, the Greek symbol <span class="math inline">\(\sigma\)</span> is used to represent this parameter.</p>
<p>In summary, we have two unknown parameters: the expected value <span class="math inline">\(d\)</span> and the standard deviation <span class="math inline">\(\sigma\)</span>.</p>
<p>Our task is to estimate <span class="math inline">\(d\)</span>. Because we model the observed values <span class="math inline">\(X_1,\dots X_N\)</span> as a random sample from the urn, the CLT might still work in this situation because it is an average of independent random variables. For a large enough sample size <span class="math inline">\(N\)</span>, the probability distribution of the sample average <span class="math inline">\(\bar{X}\)</span> is approximately normal with expected value <span class="math inline">\(\mu\)</span> and standard error <span class="math inline">\(\sigma/\sqrt{N}\)</span>. If we are willing to consider <span class="math inline">\(N=15\)</span> large enough, we can use this to construct confidence intervals.</p>
<p>A problem is that we don’t know <span class="math inline">\(\sigma\)</span>. But theory tells us that we can estimate the urn model <span class="math inline">\(\sigma\)</span> with the <em>sample standard deviation</em> defined as:</p>
<p><span class="math display">\[
s = \sqrt{ \frac{1}{N-1}\sum_{i=1}^N (X_i - \bar{X})^2}
\]</span></p>
<p>Unlike for the population standard deviation definition, we now divide by <span class="math inline">\(N-1\)</span>. This makes <span class="math inline">\(s\)</span> a better estimate of <span class="math inline">\(\sigma\)</span>. There is a mathematical explanation for this, which is explained in most statistics textbooks, but we don’t cover it here.</p>
<p>The <code>sd</code> function in R computes the sample standard deviation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(one_poll_per_pollster<span class="op">$</span>spread)
<span class="co">#&gt; [1] 0.0242</span></code></pre></div>
<p>We are now ready to form a new confidence interval based on our new data driven model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results &lt;-<span class="st"> </span>one_poll_per_pollster <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg =</span> <span class="kw">mean</span>(spread), 
            <span class="dt">se =</span> <span class="kw">sd</span>(spread) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">length</span>(spread))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">start =</span> avg <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se, 
         <span class="dt">end =</span> avg <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se) 

<span class="kw">round</span>(results <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">1</span>)
<span class="co">#&gt;   avg  se start end</span>
<span class="co">#&gt; 1 2.9 0.6   1.7 4.1</span></code></pre></div>
<p>Our confidence interval is wider now since it incorporates the pollster variability. It does include the election night result of 2.1%. Also, note that it was small enough not to include 0, which means we were confident Clinton would win the electoral vote.</p>
<p>Are we now ready to declare a probability of Clinton winning the popular vote? Not yet. In our model <span class="math inline">\(d\)</span> is a fixed parameter so we can’t talk about probabilities. To provide probabilities, we will need to learn about Bayesian statistics.</p>
</div>
<div id="exercises-33" class="section level3">
<h3><span class="header-section-number">25.7.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>We have been using urn models to motivate the use of probability models. Most data science applications are not related to data obtained from urns. More common are data that come from individuals. The reason probability plays a role here is because the data come from a random sample. The random sample is taken from a population and the urn serves as an analogy for the population.</li>
</ol>
<p>Let’s revisit the heights dataset. Suppose we consider the males in our course the population.</p>
<pre><code>```r
library(dslabs)
data(heights)
x &lt;- heights %&gt;% filter(sex == &quot;Male&quot;) %&gt;%
  pull(height)
```

Mathematically speaking, `x` is our population. Using the urn analogy, we have an urn with the values of  `x` in it. What are the average and standard deviation of our population?</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Call the population average computed above <span class="math inline">\(\mu\)</span> and the standard deviation <span class="math inline">\(\sigma\)</span>. Now take a sample of size 50, with replacement, and construct an estimate for <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>.</p></li>
<li><p>What does the theory tell us about the sample average <span class="math inline">\(\bar{X}\)</span> and how it is related to <span class="math inline">\(\mu\)</span>?</p>
<p>A. It is practically identical to <span class="math inline">\(\mu\)</span>.</p>
<p>B. It is a random variable with expected value <span class="math inline">\(\mu\)</span> and standard error <span class="math inline">\(\sigma/\sqrt{N}\)</span>.</p>
<p>C. It is a random variable with expected value <span class="math inline">\(\mu\)</span> and standard error <span class="math inline">\(\sigma\)</span>.</p>
<p>D. Contains no information.</p></li>
<li><p>So how is this useful? We are going to use an oversimplified yet illustrative example. Suppose we want to know the average height of our male students, but we only get to measure 50 of the 708. We will use <span class="math inline">\(\bar{X}\)</span> as our estimate. We know from the answer to exercise 3 that the standard estimate of our error <span class="math inline">\(\bar{X}-\mu\)</span> is <span class="math inline">\(\sigma/\sqrt{N}\)</span>. We want to compute this, but we don’t know <span class="math inline">\(\sigma\)</span>. Based on what is described in this section, show your estimate of <span class="math inline">\(\sigma\)</span>.</p></li>
<li><p>Now that we have an estimate of <span class="math inline">\(\sigma\)</span>, let’s call our estimate <span class="math inline">\(s\)</span>. Construct a 95% confidence interval for <span class="math inline">\(\mu\)</span>.</p></li>
<li><p>Now run a Monte Carlo simulation in which you compute 10,000 confidence intervals as you have just done. What proportion of these intervals include <span class="math inline">\(\mu\)</span>?</p></li>
<li><p>In this section, we talked about pollster bias. We used visualization to motivate the presence of such bias. Here we will give it a more rigorous treatment. We will consider two pollsters that conducted daily polls. We will look at national polls for the month before the election.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(polls_us_election_<span class="dv">2016</span>)
polls &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(pollster <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Rasmussen Reports/Pulse Opinion Research&quot;</span>,
                         <span class="st">&quot;The Times-Picayune/Lucid&quot;</span>) <span class="op">&amp;</span>
<span class="st">           </span>enddate <span class="op">&gt;=</span><span class="st"> &quot;2016-10-15&quot;</span> <span class="op">&amp;</span>
<span class="st">           </span>state <span class="op">==</span><span class="st"> &quot;U.S.&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>) </code></pre></div>
<p>We want to answer the question: is there a poll bias? Make a plot showing the spreads for each poll.</p></li>
<li><p>The data does seem to suggest there is a difference. However, these data are subject to variability. Perhaps the differences we observe are due to chance.</p>
<p>The urn model theory says nothing about pollster effect. Under the urn model, both pollsters have the same expected value: the election day difference, that we call <span class="math inline">\(d\)</span>.</p>
<p>To answer the question “is there an urn model?”, we will model the observed data <span class="math inline">\(Y_{i,j}\)</span> in the following way:</p>
<p><span class="math display">\[
Y_{i,j} = d + b_i + \varepsilon_{i,j}
\]</span></p>
<p>with <span class="math inline">\(i=1,2\)</span> indexing the two pollsters, <span class="math inline">\(b_i\)</span> the bias for pollster <span class="math inline">\(i\)</span> and <span class="math inline">\(\varepsilon_ij\)</span> poll to poll chance variability. We assume the <span class="math inline">\(\varepsilon\)</span> are independent from each other, have expected value <span class="math inline">\(0\)</span> and standard deviation <span class="math inline">\(\sigma_i\)</span> regardless of <span class="math inline">\(j\)</span>.</p>
<p>Which of the following best represents our question?</p>
<p>A. Is <span class="math inline">\(\varepsilon_{i,j}\)</span> = 0?</p>
<p>B. How close are the <span class="math inline">\(Y_{i,j}\)</span> to <span class="math inline">\(d\)</span>?</p>
<p>C. Is <span class="math inline">\(b_1 \neq b_2\)</span>?</p>
<p>D. Are <span class="math inline">\(b_1 = 0\)</span> and <span class="math inline">\(b_2 = 0\)</span> ?</p></li>
<li><p>In the right side of this model only <span class="math inline">\(\varepsilon_{i,j}\)</span> is a random variable. The other two are constants. What is the expected value of <span class="math inline">\(Y_{1,j}\)</span>?</p></li>
<li><p>Suppose we define <span class="math inline">\(\bar{Y}_1\)</span> as the average of poll results from the first poll, <span class="math inline">\(Y_{1,1},\dots,Y_{1,N_1}\)</span> with <span class="math inline">\(N_1\)</span> the number of polls conducted by the first pollster:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(pollster<span class="op">==</span><span class="st">&quot;Rasmussen Reports/Pulse Opinion Research&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N_1 =</span> <span class="kw">n</span>())</code></pre></div>
<p>What is the expected values <span class="math inline">\(\bar{Y}_1\)</span>?</p></li>
<li><p>What is the standard error of <span class="math inline">\(\bar{Y}_1\)</span> ?</p></li>
<li><p>Suppose we define <span class="math inline">\(\bar{Y}_2\)</span> as the average of poll results from the first poll, <span class="math inline">\(Y_{2,1},\dots,Y_{2,N_2}\)</span> with <span class="math inline">\(N_2\)</span> the number of polls conducted by the first pollster. What is the expected value <span class="math inline">\(\bar{Y}_2\)</span>?</p></li>
<li><p>What is the standard error of <span class="math inline">\(\bar{Y}_2\)</span> ?</p></li>
<li><p>Using what we learned by answering the questions above, what is the expected value of <span class="math inline">\(\bar{Y}_{2} - \bar{Y}_1\)</span>?</p></li>
<li><p>Using what we learned by answering the questions above, what is the standard error of <span class="math inline">\(\bar{Y}_{2} - \bar{Y}_1\)</span>?</p></li>
<li><p>The answer to the question above depends on <span class="math inline">\(\sigma_1\)</span> and <span class="math inline">\(\sigma_2\)</span>, which we don’t know. We learned that we can estimate these with the sample standard deviation. Write code that computes these two estimates.</p></li>
<li><p>What does the CLT tells us about the distribution of <span class="math inline">\(\bar{Y}_2 - \bar{Y}_1\)</span>?</p>
<p>A. Nothing because this is not the average of a sample.</p>
<p>B. Because the <span class="math inline">\(Y_{ij}\)</span> are approximately normal, so are the averages.</p>
<p>C. Note that <span class="math inline">\(\bar{Y}_2\)</span> and <span class="math inline">\(\bar{Y}_1\)</span> are sample averages, so if we assume <span class="math inline">\(N_2\)</span> and <span class="math inline">\(N_1\)</span> are large enough, each is approximately normal. The difference of normals is also normal.</p>
<p>D. The data are not 0 or 1, so CLT does not apply.</p></li>
<li><p>We have constructed a random variable that has expected value <span class="math inline">\(b_2 - b_1\)</span>, the pollster bias difference. If our model holds, then this random variable has an approximately normal distribution and we know its standard error. The standard error depends on <span class="math inline">\(\sigma_1\)</span> and <span class="math inline">\(\sigma_2\)</span>, but we can plug the sample standard deviations we computed above. We started off by asking: is <span class="math inline">\(b_2 - b_1\)</span> different from 0? Use all the information we have learned above to construct a 95% confidence interval for the difference <span class="math inline">\(b_2\)</span> and <span class="math inline">\(b_1\)</span>.</p></li>
<li><p>The confidence interval tells us there is relatively strong pollster effect resulting in a difference of about 5%. Random variability does not seem to explain it. We can compute a p-value to relay the fact that chance does not explain it. What is the p-value?</p></li>
<li><p>The statistic formed by dividing our estimate of <span class="math inline">\(b_2-b_1\)</span> by its estimated standard error:</p>
<p><span class="math display">\[
\frac{\bar{Y}_2 - \bar{Y}_1}{\sqrt{s_2^2/N_2 + s_1^2/N_1}}
\]</span></p>
<p>is called the t-statistic. Now notice that we have more than two pollsters. We can also test for pollster effect using all pollsters, not just two. The idea is to compare the variability across polls to variability within polls. We can actually construct statistics to test for effects and approximate their distribution. The area of statistics that does this is called Analysis of Variance or ANOVA. We do not cover it here, but ANOVA provides a very useful set of tools to answer questions such as: is there a pollster effect?</p>
<p>For this exercise, create a new table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(enddate <span class="op">&gt;=</span><span class="st"> &quot;2016-10-15&quot;</span> <span class="op">&amp;</span>
<span class="st">           </span>state <span class="op">==</span><span class="st"> &quot;U.S.&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(pollster) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;=</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()</code></pre></div>
<p>Compute the average and standard deviation for each pollster and examine the variability across the averages and how it compares to the variability within the pollsters, summarized by the standard deviation.</p></li>
</ol>

</div>
</div>
<div id="bayesian-statistics" class="section level2">
<h2><span class="header-section-number">25.8</span> Bayesian statistics</h2>
<p>What does it mean when an election forecaster tell us that a given candidate has a 90% chance of winning? In the context of the urn model, this would be equivalent to stating that the probability <span class="math inline">\(p&gt;0.5\)</span> is 90%. However, as we discussed earlier, in the urn model <span class="math inline">\(p\)</span> is a fixed parameter and it does not make sense to talk about probability. With the Bayesian approach we assume <span class="math inline">\(p\)</span> is random.</p>
<p>Forecasters also use models to describe variability at different levels. For example, sampling variability, pollster to pollster variability, day to day variability, and election to election variability. One of the most successful approaches used for this are hierarchical models, which can be explained in the context of Bayesian statistics.</p>
<div id="bayes-theorem" class="section level3">
<h3><span class="header-section-number">25.8.1</span> Bayes theorem</h3>
<p>We start by reviewing Bayes theorem. We do this using a hypothetical cystic fibrosis test as an example. Suppose a test for cystic fibrosis has an accuracy of 99%. We will use the following notation:</p>
<p><span class="math display">\[
\mbox{Prob}(+ \mid D=1)=0.99, \mbox{Prob}(- \mid D=0)=0.99 
\]</span></p>
<p>with <span class="math inline">\(+\)</span> meaning a positive test and <span class="math inline">\(D\)</span> representing if you actually have the disease (1) or not (0).</p>
<p>Suppose we select a random person and they test positive, what is the probability that they have the disease? We write this as <span class="math inline">\(\mbox{Prob}(D=1 \mid +)?\)</span> The cystic fibrosis rate is 1 in 3,900 which implies that <span class="math inline">\(\mbox{Prob}(D=1)=0.00025\)</span>. To answer this question, we will use Bayes Theorem, which in general tells us that:</p>
<p><span class="math display">\[
\mbox{Pr}(A \mid B)  =  \frac{\mbox{Pr}(B \mid A)\mbox{Pr}(A)}{\mbox{Pr}(B)} 
\]</span></p>
<p>This equation applied to our problem becomes:</p>
<p><span class="math display">\[
\begin{aligned}
\mbox{Pr}(D=1 \mid +) &amp; =  \frac{ P(+ \mid D=1) \cdot P(D=1)} {\mbox{Pr}(+)} \\
&amp; =  \frac{\mbox{Pr}(+ \mid D=1)\cdot P(D=1)} {\mbox{Pr}(+ \mid D=1) \cdot P(D=1) + \mbox{Pr}(+ \mid D=0) \mbox{Pr}( D=0)} 
\end{aligned}
\]</span></p>
<p>Plugging in the numbers we get:</p>
<p><span class="math display">\[
\frac{0.99 \cdot 0.00025}{0.99 \cdot 0.00025 + 0.01 \cdot (.99975)}  =  0.02 
\]</span></p>
<p>This says that despite the test having 0.99 accuracy, the probability of having the disease given a positive test is only 0.02. This may appear counter-intuitive to some, but the reason this is the case is because we have to factor in the very rare probability that a person, chosen at random, has the disease. To illustrate this, we run a Monte Carlo simulation.</p>
</div>
</div>
<div id="bayes-theorem-simulation" class="section level2">
<h2><span class="header-section-number">25.9</span> Bayes Theorem simulation</h2>
<p>The following simulation is meant to help you visualize Bayes Theorem. We start by randomly selecting 100,000 people from a population in which the disease in question has a 1 in 4,000 prevalence.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prev &lt;-<span class="st"> </span><span class="fl">0.00025</span>
N &lt;-<span class="st"> </span><span class="dv">100000</span>
outcome &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;Disease&quot;</span>,<span class="st">&quot;Healthy&quot;</span>), N, <span class="dt">replace =</span> <span class="ot">TRUE</span>, 
                  <span class="dt">prob =</span> <span class="kw">c</span>(prev, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prev))</code></pre></div>
<p>Note that there are very few people with the disease:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N_D &lt;-<span class="st"> </span><span class="kw">sum</span>(outcome <span class="op">==</span><span class="st"> &quot;Disease&quot;</span>)
N_D
<span class="co">#&gt; [1] 23</span>
N_H &lt;-<span class="st"> </span><span class="kw">sum</span>(outcome <span class="op">==</span><span class="st"> &quot;Healthy&quot;</span>)
N_H
<span class="co">#&gt; [1] 99977</span></code></pre></div>
<p>Also, there are many without the disease, which makes it more probable that we will see some false positives given that the test is not perfect. Now each person gets the test which is correct 90% of the time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">accuracy &lt;-<span class="st"> </span><span class="fl">0.99</span>
test &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;character&quot;</span>, N)
test[outcome <span class="op">==</span><span class="st"> &quot;Disease&quot;</span>]  &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;+&quot;</span>, <span class="st">&quot;-&quot;</span>), N_D, <span class="dt">replace =</span> <span class="ot">TRUE</span>, 
                                    <span class="dt">prob =</span> <span class="kw">c</span>(accuracy, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>accuracy))
test[outcome <span class="op">==</span><span class="st"> &quot;Healthy&quot;</span>]  &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;+&quot;</span>), N_H, <span class="dt">replace =</span> <span class="ot">TRUE</span>, 
                                    <span class="dt">prob =</span> <span class="kw">c</span>(accuracy, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>accuracy))</code></pre></div>
<p>Because there are so many more controls than cases, even with a low false positive rate, we get more controls than cases in the group that tested positive:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(outcome, test)
<span class="co">#&gt;          test</span>
<span class="co">#&gt; outcome       -     +</span>
<span class="co">#&gt;   Disease     0    23</span>
<span class="co">#&gt;   Healthy 99012   965</span></code></pre></div>
<p>From this table, we see that the proportion of positive tests that have the disease is 23 out of 988. We can run this over and over again to see that, in fact, the probability converges to about 0.022</p>
<div id="bayes-in-practice" class="section level3">
<h3><span class="header-section-number">25.9.1</span> Bayes in practice</h3>
<p>José Iglesias is a professional baseball player. In April 2013, when he was starting his career, he was performing rather well:</p>
<table>
<thead>
<tr class="header">
<th>Month</th>
<th>At Bats</th>
<th>H</th>
<th>AVG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>April</td>
<td>20</td>
<td>9</td>
<td>.450</td>
</tr>
</tbody>
</table>
<p>The batting average (<code>AVG</code>) statistic is one way of measuring success. Roughly speaking, it tells us the success rate when batting. An <code>AVG</code> of .450 means José has been successful 45% of the times he has batted (<code>At Bats</code>) which is rather high, historically speaking. Keep in mind that no one has finished a season with an <code>AVG</code> of .400 or more since Ted Williams did it in 1941! To illustrate the way hierarchical models are powerful, we will try to predict José’s batting average at the end of the season. Note that in a typical season, players have about 500 at bats.</p>
<p>With the techniques we have learned up to now, referred to as <em>frequentist techniques</em>, the best we can do is provide a confidence interval. We can think of outcomes from hitting as a binomial with a success rate of <span class="math inline">\(p\)</span>. So if the success rate is indeed .450, the standard error of just 20 at bats is:</p>
<p><span class="math display">\[
\sqrt{\frac{.450 (1-.450)}{20}}=.111
\]</span></p>
<p>This means that our confidence interval is <span class="math inline">\(.450 - .222\)</span> to <span class="math inline">\(.450 + .222\)</span> or <span class="math inline">\(.228\)</span> to <span class="math inline">\(.672\)</span>.</p>
<p>This prediction has two problems. First, it is very large, so not very useful. Second, it is centered at .450, which implies that our best guess is that this new player will break Ted Williams’ record.</p>
<p>If you follow baseball, this last statement will seem wrong and this is because you are implicitly using a hierarchical model that factors in information from years of following baseball. Here we show how we can quantify this intuition.</p>
<p>First, let’s explore the distribution of batting averages for all players with more than 500 at bats during the previous three seasons:</p>
<p><img src="book_files/figure-html/batting-averages-histogram-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>The average player had an <code>AVG</code> of .275 and the standard deviation of the population of players was 0.027. So we can see already that .450 would be quite an anomaly since it is over six standard deviations away from the mean.</p>
<p>So is José lucky or is he the best batter seen in the last 50 years? Perhaps it’s a combination of both luck and talent. But how much of each? If we become convinced that he is lucky, we should trade him to a team that trusts the .450 observation and is maybe overestimating his potential.</p>
</div>
<div id="the-hierarchical-model" class="section level3">
<h3><span class="header-section-number">25.9.2</span> The hierarchical model</h3>
<p>The hierarchical model provides a mathematical description of how we came to see the observation of .450. First, we pick a player at random with an intrinsic ability summarized by, for example, <span class="math inline">\(p\)</span>. Then we see 20 random outcomes with success probability <span class="math inline">\(p\)</span>.</p>
<p>We use a model to represents two levels of variability in our data. First, each player is assigned a natural ability to hit. We will use the symbol <span class="math inline">\(p\)</span> to represent this ability. You can think of <span class="math inline">\(\theta\)</span> as the batting average you would converge to if this particular player batted over and over again.</p>
<p>Based on the plots we showed earlier, we assume that <span class="math inline">\(p\)</span> has a normal distribution. With expected value .270 and standard error 0.027.</p>
<p>Now the second level of variability has to do with luck when batting. Regardless of how good the player is, sometimes you have bad luck and sometimes you have good luck. At each at bat, this player has a probability of success <span class="math inline">\(p\)</span>. If we add up these successes and failures, then the CLT tells us that the observed average, call it <span class="math inline">\(Y\)</span>, has a normal distribution with expected value <span class="math inline">\(p\)</span> and standard error <span class="math inline">\(\sqrt{p(1-p)/\sqrt{N}}\)</span> with <span class="math inline">\(N\)</span> the number of at bats.</p>
<p>Statistical textbooks will write the model like this: <span class="math display">\[
\begin{aligned}
p &amp;\sim N(\mu, \tau^2) \\
Y \mid p &amp;\sim N(p, \sigma^2) 
\end{aligned}
\]</span> Here the <span class="math inline">\(~\)</span> symbol tells use the random variable on the left of the symbol follows the distribution on the right and <span class="math inline">\(N(a,b^2)\)</span> represents the normal distribution with mean <span class="math inline">\(a\)</span> and standard deviation <span class="math inline">\(b\)</span>. The <span class="math inline">\(\mid\)</span> is read as <em>conditioned on</em>, and it means that we are treating the random variable to the right of the symbol as known. We refer to the model as hierarchical because we need to know <span class="math inline">\(p\)</span>, the first level, in order to model <span class="math inline">\(Y\)</span>, the second level. In our example the first level describes randomness in assigning talent to a player and the second described describes randomness in this particular player’s performance once we have fixed the talent parameter. In a Bayesian framework, the first level is called a <em>prior distribution</em> and the second the <em>sampling distribution</em>. The data analysis we have conducted here suggest that we set <span class="math inline">\(\mu = .270\)</span>, <span class="math inline">\(\tau = 0.027\)</span>, and <span class="math inline">\(\sigma^2 = p(1-p)/N\)</span>.</p>
<p>Now, let’s use this model for José’s data. Suppose we want to predict his innate ability in the form of his <em>true</em> batting average <span class="math inline">\(p\)</span>. This would be the hierarchical model for our data:</p>
<p><span class="math display">\[
\begin{aligned}
p &amp;\sim N(.275, .027^2) \\
Y \mid p &amp;\sim N(p, .111^2) 
\end{aligned}
\]</span></p>
<p>We now are ready to compute a posterior distribution to summarize our prediction of <span class="math inline">\(p\)</span>. The continuous version of Bayes’ rule can be used here to derive the <em>posterior probability function</em>, which is the distribution of <span class="math inline">\(p\)</span> assuming we observe <span class="math inline">\(Y=y\)</span>. In our case, we can show that when we fix <span class="math inline">\(Y=y\)</span>, <span class="math inline">\(p\)</span> follows a normal distribution with expected value:</p>
<p><span class="math display">\[
\begin{aligned}
\mbox{E}(p \mid Y=y) &amp;= B \mu + (1-B) y\\
&amp;= \mu + (1-B)(y-\mu)\\
\mbox{with } B &amp;= \frac{\sigma^2}{\sigma^2+\tau^2}
\end{aligned}
\]</span></p>
<p>This is a weighted average of the population average <span class="math inline">\(\mu\)</span> and the observed data <span class="math inline">\(y\)</span>. The weight depends on the SD of the population <span class="math inline">\(\tau\)</span> and the SD of our observed data <span class="math inline">\(\sigma\)</span>. This weighted average is sometimes referred to as <em>shrinking</em> because it <em>shrinks</em> estimates towards a prior mean. In the case of José Iglesias, we have:</p>
<p><span class="math display">\[
\begin{aligned}
\mbox{E}(p \mid Y=.450) &amp;= B \times .275 + (1 - B) \times .450 \\
&amp;= .275 + (1 - B)(.450 - .275) \\
B &amp;=\frac{.111^2}{.111^2 + .027^2} = 0.944\\
\mbox{E}(p \mid Y=450) &amp;\approx .285
\end{aligned}
\]</span></p>
<p>We do not show the derivation here, but the standard error can be shown to be:</p>
<p><span class="math display">\[
\mbox{SE}(p\mid y)^2 = \frac{1}{1/\sigma^2+1/\tau^2}
= \frac{1}{1/.111^2 + 1/.027^2} = 0.00069
\]</span> and the standard deviation is therefore <span class="math inline">\(0.026\)</span>. So we started with a frequentist 95% confidence interval that ignored data from other players and summarized just José’s data: .450 <span class="math inline">\(\pm\)</span> 0.220. Then we used a Bayesian approach that incorporated data from other players and other years to obtain a posterior probability. This is actually referred to as an empirical Bayes approach because we used data to construct the prior. From the posterior, we can report what is called a 95% <em>credible interval</em> by reporting a region, centered at the mean, with a 95% chance of occurring. In our case, this turns out to be: .285 <span class="math inline">\(\pm\)</span> 0.052.</p>
<p>The Bayesian credible interval suggests that if another team is impressed by the .450 observation, we should consider trading José as we are predicting he will be just slightly above average. Interestingly, the Red Sox traded José to the Detroit Tigers in July. Here are the José Iglesias batting averages for the next five months:</p>
<table>
<thead>
<tr class="header">
<th>Month</th>
<th>At Bat</th>
<th>Hits</th>
<th>AVG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>April</td>
<td>20</td>
<td>9</td>
<td>.450</td>
</tr>
<tr class="even">
<td>May</td>
<td>26</td>
<td>11</td>
<td>.423</td>
</tr>
<tr class="odd">
<td>June</td>
<td>86</td>
<td>34</td>
<td>.395</td>
</tr>
<tr class="even">
<td>July</td>
<td>83</td>
<td>17</td>
<td>.205</td>
</tr>
<tr class="odd">
<td>August</td>
<td>85</td>
<td>25</td>
<td>.294</td>
</tr>
<tr class="even">
<td>September</td>
<td>50</td>
<td>10</td>
<td>.200</td>
</tr>
<tr class="odd">
<td>Total w/o April</td>
<td>330</td>
<td>97</td>
<td>.293</td>
</tr>
</tbody>
</table>
<p>Although both intervals included the final batting average, the Bayesian credible interval provided a much more precise prediction. In particular, it predicted that he would not be as good during the remainder of the season.</p>
</div>
<div id="exercises-34" class="section level3">
<h3><span class="header-section-number">25.9.3</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>In 1999, in England, <a href="https://en.wikipedia.org/wiki/Sally_Clark">Sally Clark</a> was found guilty of the murder of two of her sons. Both infants were found dead in the morning, one in 1996 and another in 1998. In both cases, she claimed the cause of death was sudden infant death syndrome (SIDS). No evidence of physical harm was found on the two infants so the main piece of evidence against her was the testimony of Professor Sir Roy Meadow, who testified that the chances of two infants dying of SIDS was 1 in 73 million. He arrived at this figure by finding that the rate of SIDS was 1 in 8,500 and then calculating that the chance of two SIDS cases was 8,500 <span class="math inline">\(\times\)</span> 8,500 <span class="math inline">\(\approx\)</span> 73 million. Which of the following do you agree with?</p>
<p>A. Sir Meadow assumed that the probability of the second son being affected by SIDS was independent of the first son being affected, thereby ignoring possible genetic causes. If genetics plays a role then: <span class="math inline">\(\mbox{Pr}(\mbox{second case of SIDS} \mid \mbox{first case of SIDS}) &lt; \mbox{P}r(\mbox{first case of SIDS})\)</span>.</p>
<p>B. Nothing. The multiplicative rule always applies in this way: <span class="math inline">\(\mbox{Pr}(A \mbox{ and } B) =\mbox{Pr}(A)\mbox{Pr}(B)\)</span></p>
<p>C. Sir Meadow is an expert and we should trust his calculations.</p>
<p>D. Numbers don’t lie.</p></li>
<li><p>Let’s assume that there is in fact a genetic component to SIDS and the the probability of <span class="math inline">\(\mbox{Pr}(\mbox{second case of SIDS} \mid \mbox{first case of SIDS}) = 1/100\)</span>, is much higher than 1 in 8,500. What is the probability of both of her sons dying of SIDS?</p></li>
<li><p>Many press reports stated that the expert claimed the probability of Sally Clark being innocent as 1 in 73 million. Perhaps the jury and judge also interpreted the testimony this way. This probability can be written like as the probability of <em>a mother is a son-murdering psychopath</em> given that <em>two of her children are found dead with no evidence of physical harm</em>. According to Bayes’ rule, what is this?</p></li>
<li><p>Assume that the chance of a son-murdering psychopath finding a way to kill her children, without leaving evidence of physical harm, is:</p>
<p><span class="math display">\[
\mbox{Pr}(A \mid B) = 0.50
\]</span></p>
<p>with <span class="math inline">\(A = \mbox{two of her children are found dead with no evidence of physical harm}\)</span> and <span class="math inline">\(B=\mbox{a mother is a son-murdering psychopath} ) = 0.50\)</span>. Assume that the rate of son-murdering psychopaths mothers is 1 in 1,000,000. According to Bayes’ rule, what is the probability of <span class="math inline">\(\mbox{Pr}(B \mid A)\)</span> ?</p></li>
<li><p>After Sally Clark was found guilty, the Royal Statistical Society issued a statement saying that there was “no statistical basis” for the expert’s claim. They expressed concern at the “misuse of statistics in the courts”. Eventually, Sally Clarke was acquitted in June 2003. What did the expert miss?</p>
<p>A. He made an arithmetic error.</p>
<p>B. He made two mistakes. First, he misused the multiplicative rule and did not take into account how rare it is for a mother to murder her children. After using Bayes’ rule, we found a probability closer to 0.5 than 1 in 73 million.</p>
<p>C. He mixed up the numerator and denominator of Bayes’ rule.</p>
<p>D. He did not use R.</p></li>
<li><p>Florida is one of the most closely watched states in the U.S. election because it has many electoral votes and the election is generally close. Create the following table with the polls taken during the last two weeks:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(dslabs)
<span class="kw">data</span>(polls_us_election_<span class="dv">2016</span>)
polls &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;Florida&quot;</span> <span class="op">&amp;</span><span class="st"> </span>enddate <span class="op">&gt;=</span><span class="st"> &quot;2016-11-04&quot;</span> ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>)</code></pre></div>
<p>Take the average spread of these polls. The CLT tells us this average is approximately normal. Calculate an average and provide an estimate of the standard error. Save your results in an object called <code>results</code>.</p></li>
<li><p>Now assume a Bayesian model that sets the prior distribution for Florida’s election night spread <span class="math inline">\(d\)</span> to be Normal with expected value <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\tau\)</span>. What are the interpretations of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span>?</p>
<p>A. <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span> are arbitrary numbers that let us make probability statements about <span class="math inline">\(d\)</span>.</p>
<p>B. <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span> summarize what we would predict for Florida before seeing any polls. Based on past elections, we would set <span class="math inline">\(\mu\)</span> close to 0 because both Republicans and Democrats have won, and <span class="math inline">\(\tau\)</span> at about <span class="math inline">\(0.02\)</span>, because these elections tend to be close.</p>
<p>C. <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span> summarize what we want to be true. We therefore set <span class="math inline">\(\mu\)</span> at <span class="math inline">\(0.10\)</span> and <span class="math inline">\(\tau\)</span> at <span class="math inline">\(0.01\)</span>.</p>
<p>D. The choice of prior has no effect on Bayesian Analysis.</p></li>
<li><p>The CLT tells us that our estimate of the spread <span class="math inline">\(\hat{d}\)</span> has normal distribution with expected value <span class="math inline">\(d\)</span> and standard deviation <span class="math inline">\(\sigma\)</span> calculated in problem 6. Use the formulas we showed for the posterior distribution to calculate the expected value of the posterior distribution if we set <span class="math inline">\(\mu = 0\)</span> and <span class="math inline">\(\tau = 0.01\)</span>.</p></li>
<li><p>Now compute the standard deviation of the posterior distribution.</p></li>
<li><p>Using the fact that the posterior distribution is normal, create an interval that has a 95% probability of occurring centered at the posterior expected value. Note that we call these credible intervals.</p></li>
<li><p>According to this analysis, what was the probability that Trump wins Florida?</p></li>
<li><p>Now use <code>sapply</code> function to change the prior variance from <code>seq(0.05, 0.05, len = 100)</code> and observe how the probability changes by making a plot.</p></li>
</ol>

</div>
</div>
<div id="election-forecasting" class="section level2">
<h2><span class="header-section-number">25.10</span> Case study: Election forecasting</h2>
<p>In a previous section, we generated these data tables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(dslabs)
polls &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;U.S.&quot;</span> <span class="op">&amp;</span><span class="st"> </span>enddate <span class="op">&gt;=</span><span class="st"> &quot;2016-10-31&quot;</span> <span class="op">&amp;</span>
<span class="st">           </span>(grade <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A+&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;A-&quot;</span>,<span class="st">&quot;B+&quot;</span>) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(grade))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>)

one_poll_per_pollster &lt;-<span class="st"> </span>polls <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(pollster) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(enddate <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(enddate)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()

results &lt;-<span class="st"> </span>one_poll_per_pollster <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg =</span> <span class="kw">mean</span>(spread), <span class="dt">se =</span> <span class="kw">sd</span>(spread)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">length</span>(spread))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">start =</span> avg <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se, <span class="dt">end =</span> avg <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se) </code></pre></div>
<p>Below, we will use these for our forecasting.</p>
<div id="bayesian-approach" class="section level3">
<h3><span class="header-section-number">25.10.1</span> Bayesian approach</h3>
<p>Pollsters tend to make probabilistic statements about the results of the election. For example, “The chance that Obama wins the electoral colleges is 91%” is a probabilistic statement about a parameter which in previous sections we have denoted with <span class="math inline">\(d\)</span>. We showed that for the 2016 election, FiveThirtyEight gave Clinton a 81.4% chance of winning the popular vote. To do this, they used the Bayesian approach we described.</p>
<p>We assume a hierarchical model similar to what we did to predict the performance of a baseball player. Statistical textbooks will write the model like this:</p>
<p><span class="math display">\[
\begin{aligned}
d &amp;\sim N(\mu, \tau^2) \mbox{ describes our best guess had we not seen any polling data}\\
\bar{X} \mid d &amp;\sim N(d, \sigma^2) \mbox{ describes randomness due to sampling and the  pollster effect}
\end{aligned}
\]</span></p>
<p>For our best guess, we note that before any poll data is available, we can use data sources other than polling data. A popular approach is to use what pollsters call <em>fundamentals</em>, which are based on properties about the current economy that historically appear to have an effect in favor or against the incumbent party. We won’t use these here. Instead, we will use <span class="math inline">\(\mu = 0\)</span>, which is interpreted as a model that simply does not provide any information on who will win. For the standard deviation, we will use recent historical data that shows the winner of the popular vote has an average spread of about 3.5%. Therefore, we set <span class="math inline">\(\tau = 0.035\)</span>.</p>
<p>Now we can use the formulas for the posterior distribution for the parameter <span class="math inline">\(d\)</span>: the probability of <span class="math inline">\(d&gt;0\)</span> given the observed poll data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu &lt;-<span class="st"> </span><span class="dv">0</span>
tau &lt;-<span class="st"> </span><span class="fl">0.035</span>
sigma &lt;-<span class="st"> </span>results<span class="op">$</span>se
Y &lt;-<span class="st"> </span>results<span class="op">$</span>avg
B &lt;-<span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>tau<span class="op">^</span><span class="dv">2</span>)

posterior_mean &lt;-<span class="st"> </span>B<span class="op">*</span>mu <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>B)<span class="op">*</span>Y
posterior_se &lt;-<span class="st"> </span><span class="kw">sqrt</span>( <span class="dv">1</span><span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>tau<span class="op">^</span><span class="dv">2</span>))

posterior_mean
<span class="co">#&gt; [1] 0.0281</span>
posterior_se
<span class="co">#&gt; [1] 0.00615</span></code></pre></div>
<p>To make a probability statement, we use the fact that the posterior distribution is also normal. And we have a credible interval of:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">posterior_mean <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">1.96</span>, <span class="fl">1.96</span>)<span class="op">*</span>posterior_se
<span class="co">#&gt; [1] 0.0160 0.0401</span></code></pre></div>
<p>The posterior probability <span class="math inline">\(\mbox{Pr}(d&gt;0 \mid \bar{X})\)</span> can be computed like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="dv">0</span>, posterior_mean, posterior_se)
<span class="co">#&gt; [1] 1</span></code></pre></div>
<p>This says we are 100% sure Clinton will win the popular vote which seems too overconfident. Also, it is not in agreement with FiveThirtyEight’s 81.4%. What explains this difference?</p>
</div>
<div id="the-general-bias" class="section level3">
<h3><span class="header-section-number">25.10.2</span> The general bias</h3>
<p>After elections are over, one can look at the difference between pollster predictions and actual result. An important observation that our model does not take into account, is that it is common to see the general bias that affects many pollsters in the same way. There is no good explanation for this, but we do observe it in historical data: in one election, the average of polls favors Democrats by 2%, then in the following election they favor Republicans by 1%, then in the next election there is no bias, then in the following one Republicans are favored by 3%, and so on. In 2016, the polls were biased in favor of the Democrats by 1-2%.</p>
<p>Although we know this bias term affects our polls, we have no way of knowing what this bias is until election night. So we can’t correct our polls accordingly. What we can do is include a term in our model that accounts for this variability.</p>
</div>
<div id="mathematical-representations-of-models" class="section level3">
<h3><span class="header-section-number">25.10.3</span> Mathematical representations of models</h3>
<p>Suppose we are collecting data from one pollster and we assume there is no general bias. The pollster collects several polls with a sample size of <span class="math inline">\(N\)</span>, so we observe several measurements of the spread <span class="math inline">\(X_1, \dots, X_J\)</span>. The theory tells us that these random variables have expected value <span class="math inline">\(d\)</span> and <span class="math inline">\(2 \sqrt{p(1-p)/N}\)</span>. Let’s start by using the following model to describe the observed variability:</p>
<p><span class="math display">\[
X_j = d + \varepsilon_j.
\]</span> We use the index <span class="math inline">\(j\)</span> to represent the different polls and we define <span class="math inline">\(\varepsilon_j\)</span> to be a random variable that explains the poll-to-poll variability introduced by sampling error. To do this, we assume its average is 0 and standard error is <span class="math inline">\(2 \sqrt{p(1-p)/N}\)</span>. If <span class="math inline">\(d\)</span> is 2.1 and the sample size for these polls is 2,000, we can simulate <span class="math inline">\(J=6\)</span> data points from this model like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">3</span>)
J &lt;-<span class="st"> </span><span class="dv">6</span>
N &lt;-<span class="st"> </span><span class="dv">2000</span>
d &lt;-<span class="st"> </span>.<span class="dv">021</span>
p &lt;-<span class="st"> </span>(d <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>
X &lt;-<span class="st"> </span>d <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(J, <span class="dv">0</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">/</span><span class="st"> </span>N))</code></pre></div>
<p>Now suppose we have <span class="math inline">\(J=6\)</span> data points from <span class="math inline">\(I=5\)</span> different pollsters. To represent this we now need two indexes, one for pollster and one for the polls each pollster takes. We use <span class="math inline">\(X_{ij}\)</span> with <span class="math inline">\(i\)</span> representing the pollster and <span class="math inline">\(j\)</span> representing the <span class="math inline">\(j\)</span>-th poll from that pollster. If we apply the same model, we write:</p>
<p><span class="math display">\[
X_{i,j} = d + h_i + \varepsilon_{i,j}
\]</span></p>
<p>To simulate data, we now have to loop through the pollsters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">I &lt;-<span class="st"> </span><span class="dv">5</span>
J &lt;-<span class="st"> </span><span class="dv">6</span>
N &lt;-<span class="st"> </span><span class="dv">2000</span>
X &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>I, <span class="cf">function</span>(i){
  d <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(J, <span class="dv">0</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">/</span><span class="st"> </span>N))
})</code></pre></div>
<p>The simulated data does not really seem to capture the features of the actual data:</p>
<p><img src="book_files/figure-html/simulated-data-without-bias-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Here is the actual data:</p>
<p><img src="book_files/figure-html/pollster-bias-data-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The model above does not account for pollster to pollster variability. To fix this, we add a new term for the pollster effect. We will use <span class="math inline">\(\theta_i\)</span> to represent the house effect of the <span class="math inline">\(i\)</span>-th pollster. The model is now augmented to:</p>
<p><span class="math display">\[
X_{i,j} = d + h_i + \varepsilon_{i,j}
\]</span></p>
<p>To simulate data from a specific pollster, we now need to draw an <span class="math inline">\(h_i\)</span> and then add the <span class="math inline">\(\varepsilon\)</span>s. Here is how we would do it for one specific pollster. We assume <span class="math inline">\(\sigma_h\)</span> is 0.025:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">I &lt;-<span class="st"> </span><span class="dv">5</span>
J &lt;-<span class="st"> </span><span class="dv">6</span>
N &lt;-<span class="st"> </span><span class="dv">2000</span>
d &lt;-<span class="st"> </span>.<span class="dv">021</span>
p &lt;-<span class="st"> </span>(d <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>
h &lt;-<span class="st"> </span><span class="kw">rnorm</span>(I, <span class="dv">0</span>, <span class="fl">0.025</span>)
X &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>I, <span class="cf">function</span>(i){
  d <span class="op">+</span><span class="st"> </span>h[i] <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(J, <span class="dv">0</span>, <span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">/</span><span class="st"> </span>N))
})</code></pre></div>
<p>The simulated data now looks more like the actual data:</p>
<p><img src="book_files/figure-html/simulated-pollster-data-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Note that <span class="math inline">\(h_i\)</span> is common to all the observed spreads from a specific pollster. Different pollsters have a different <span class="math inline">\(h_i\)</span>, which explains why we can see the groups of points shift up and down from pollster to pollster.</p>
<p>Now, in the model above, we assume the average house effect is 0. We think that for every pollster biased in favor of our party, there is another one in favor of the other and assume the standard deviation is <span class="math inline">\(\sigma_h\)</span>. But historically we see that every election has a general bias affecting all polls. We can observe this with the 2016 data, but if we collect historical data, we see that the average of polls misses by more than models like the one above predict. To see this, we would take the average of polls for each election year and compare it to the actual value. If we did this, we would see a difference with a standard deviation of between 2-3%. To incorporate this into the model, we can add another term to account for this variability: <span class="math display">\[
X_{ij} = d + b + h_i + \varepsilon_{i,j}.
\]</span></p>
<p>Here <span class="math inline">\(b\)</span> is a random variable that accounts for the election-to-election variability. This random variable changes from election to election, but for any given election, it is the same for all pollsters and polls within on election. This is why it does not have indexes. One way to interpret <span class="math inline">\(b\)</span> is as the difference between the average of all polls from all pollsters and the actual result of the election. However, because we don’t know the actual result until after the election, we can’t estimate <span class="math inline">\(b\)</span> until after the election. However, we can estimate <span class="math inline">\(b\)</span> from previous elections and study the distribution of these values. Based on this approach we assume <span class="math inline">\(b\)</span> has expected value 0 and the standard error is about <span class="math inline">\(\sigma_b = 0.025\)</span>.</p>
<p>An implication of adding this term to the model is that the standard deviation for <span class="math inline">\(X_{ij}\)</span> is actually higher than what we earlier called <span class="math inline">\(\sigma\)</span>, which combines the pollster variability and the sample in variability, and was estimated with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(one_poll_per_pollster<span class="op">$</span>spread)
<span class="co">#&gt; [1] 0.0242</span></code></pre></div>
<p>This estimate does not include the variability introduced by <span class="math inline">\(b\)</span>. Note that because</p>
<p><span class="math display">\[
\bar{X} = d + b + \frac{1}{N}\sum_{i=1}^N X_i
\]</span></p>
<p>then the standard deviation of <span class="math inline">\(\bar{X}\)</span> is:</p>
<p><span class="math display">\[
\sqrt{\sigma^2/N + \sigma_b^2}.
\]</span> Since the same <span class="math inline">\(b\)</span> is in every measurement, the average does not reduce its variance. This is an important point: it does not matter how many polls you take, this bias does not get reduced.</p>
<p>If we redo the Bayesian calculation taking this variability into account, we get a result much closer to FiveThirtyEight’s:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu &lt;-<span class="st"> </span><span class="dv">0</span>
tau &lt;-<span class="st"> </span><span class="fl">0.035</span>
sigma &lt;-<span class="st"> </span><span class="kw">sqrt</span>(results<span class="op">$</span>se<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>.<span class="dv">025</span><span class="op">^</span><span class="dv">2</span>)
Y &lt;-<span class="st"> </span>results<span class="op">$</span>avg
B &lt;-<span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>tau<span class="op">^</span><span class="dv">2</span>)

posterior_mean &lt;-<span class="st"> </span>B<span class="op">*</span>mu <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>B)<span class="op">*</span>Y
posterior_se &lt;-<span class="st"> </span><span class="kw">sqrt</span>( <span class="dv">1</span><span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>tau<span class="op">^</span><span class="dv">2</span>))

<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="dv">0</span>, posterior_mean, posterior_se)
<span class="co">#&gt; [1] 0.817</span></code></pre></div>
</div>
<div id="predicting-the-electoral-college" class="section level3">
<h3><span class="header-section-number">25.10.4</span> Predicting the electoral college</h3>
<p>Up to now we have focused on the popular vote. But in the United States, elections are not decided by the popular vote but rather by what is known as the electoral college. Each state gets a number of electoral votes that depends, in a somewhat complex way, on the population size of the state. Here are the top 5 states ranked by electoral votes in 2016.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">5</span>, electoral_votes)
<span class="co">#&gt;          state electoral_votes clinton trump others</span>
<span class="co">#&gt; 1   California              55    61.7  31.6    6.7</span>
<span class="co">#&gt; 2        Texas              38    43.2  52.2    4.5</span>
<span class="co">#&gt; 3      Florida              29    47.8  49.0    3.2</span>
<span class="co">#&gt; 4     New York              29    59.0  36.5    4.5</span>
<span class="co">#&gt; 5     Illinois              20    55.8  38.8    5.4</span>
<span class="co">#&gt; 6 Pennsylvania              20    47.9  48.6    3.6</span></code></pre></div>
<p>With some minor exceptions we don’t discuss, the electoral votes are won all or nothing. For example, if you win California by just 1 vote, you still get all 55 of its electoral votes. This means that by winning a few big states by a large margin, but losing many small states by small margins, you can win the popular vote and yet lose the electoral college. This happened in 1876, 1888, 2000 and 2016. The idea behind this is to avoid a few large states having the power to dominate the presidential election. Nonetheless, many people in the US consider the electoral college unfair and would like to see it abolished.</p>
<p>We are now ready to predict the electoral college result for 2016. We start by aggregating results from a poll taken during the last week before the election. We use the <code>str_detect</code>, a function we introduce later in Section @ref{stringr}, to remove polls that are not for entire states.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(state<span class="op">!=</span><span class="st">&quot;U.S.&quot;</span> <span class="op">&amp;</span><span class="st"> </span>
<span class="st">           </span><span class="op">!</span><span class="kw">str_detect</span>(state, <span class="st">&quot;CD&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>
<span class="st">           </span>enddate <span class="op">&gt;=</span><span class="st">&quot;2016-10-31&quot;</span> <span class="op">&amp;</span><span class="st"> </span>
<span class="st">           </span>(grade <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A+&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;A-&quot;</span>,<span class="st">&quot;B+&quot;</span>) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(grade))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg =</span> <span class="kw">mean</span>(spread), <span class="dt">sd =</span> <span class="kw">sd</span>(spread), <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">as.character</span>(state))</code></pre></div>
<p>Here are the 10 closest races according to the polls:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">abs</span>(avg))
<span class="co">#&gt; # A tibble: 47 x 4</span>
<span class="co">#&gt;   state               avg     sd     n</span>
<span class="co">#&gt;   &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 Florida         0.00356 0.0163     7</span>
<span class="co">#&gt; 2 North Carolina -0.00730 0.0306     9</span>
<span class="co">#&gt; 3 Ohio           -0.0104  0.0252     6</span>
<span class="co">#&gt; 4 Nevada          0.0169  0.0441     7</span>
<span class="co">#&gt; 5 Iowa           -0.0197  0.0437     3</span>
<span class="co">#&gt; 6 Michigan        0.0209  0.0203     6</span>
<span class="co">#&gt; # ... with 41 more rows</span></code></pre></div>
<p>We now introduce the command <code>left_join</code> that will let us easily add the number of electoral votes for each state from the data set <code>us_electoral_votes_2016</code>. We will describe this function in detail in the Wrangling chapter. Here, we simply say that the function combines the two datasets so that the information from the second argument is added to the information in the first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results &lt;-<span class="st"> </span><span class="kw">left_join</span>(results, results_us_election_<span class="dv">2016</span>, <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>)</code></pre></div>
<p>Notice that some states have no polls because the winner is pretty much known:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span>state <span class="op">%in%</span><span class="st"> </span>results<span class="op">$</span>state)
<span class="co">#&gt;                  state electoral_votes clinton trump others</span>
<span class="co">#&gt; 1         Rhode Island               4    54.4  38.9    6.7</span>
<span class="co">#&gt; 2               Alaska               3    36.6  51.3   12.2</span>
<span class="co">#&gt; 3              Wyoming               3    21.9  68.2   10.0</span>
<span class="co">#&gt; 4 District of Columbia               3    90.9   4.1    5.0</span></code></pre></div>
<p>No polls were conducted in DC, Rhode Island, Alaska, and Wyoming because Democrats are sure to win in the first twoand Republicans in the last two.</p>
<p>Because we can’t estimate the standard deviation for states with just one poll, we will use the median of the standard deviations estimated for states with more than one poll.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results &lt;-<span class="st"> </span>results <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sd =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(sd), <span class="kw">median</span>(results<span class="op">$</span>sd, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), sd))</code></pre></div>
<p>To make probabilistic arguments, we will use a Monte Carlo simulation. For each state, we apply the Bayesian approach to generate an election day <span class="math inline">\(d\)</span>. We could construct the priors for each state based on recent history. However, to keep it simple, we assign a prior to each state that assumes we know nothing about what will happen. Since from election year to election year the results from a specific state don’t change that much, we will assign a standard deviation of 2% or <span class="math inline">\(\tau=0.02\)</span>. The Bayesian calculation looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu &lt;-<span class="st"> </span><span class="dv">0</span>
tau &lt;-<span class="st"> </span><span class="fl">0.02</span>
results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">sigma =</span> sd<span class="op">/</span><span class="kw">sqrt</span>(n), 
                   <span class="dt">B =</span> sigma<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(sd<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>tau<span class="op">^</span><span class="dv">2</span>),
                   <span class="dt">posterior_mean =</span> B <span class="op">*</span><span class="st"> </span>mu <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>B) <span class="op">*</span><span class="st"> </span>avg,
                   <span class="dt">posterior_se =</span> <span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>tau<span class="op">^</span><span class="dv">2</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">abs</span>(posterior_mean))
<span class="co">#&gt; # A tibble: 47 x 12</span>
<span class="co">#&gt;   state      avg     sd     n electoral_votes clinton trump others   sigma</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;           &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Flor…  0.00356 0.0163     7              29    47.8  49      3.2 0.00618</span>
<span class="co">#&gt; 2 Nort… -0.00730 0.0306     9              15    46.2  49.8    4   0.0102 </span>
<span class="co">#&gt; 3 Ohio  -0.0104  0.0252     6              18    43.5  51.7    4.8 0.0103 </span>
<span class="co">#&gt; 4 Iowa  -0.0197  0.0437     3               6    41.7  51.1    7.1 0.0252 </span>
<span class="co">#&gt; 5 Neva…  0.0169  0.0441     7               6    47.9  45.5    6.6 0.0167 </span>
<span class="co">#&gt; 6 Mich…  0.0209  0.0203     6              16    47.3  47.5    5.2 0.00827</span>
<span class="co">#&gt; # ... with 41 more rows, and 3 more variables: B &lt;dbl&gt;,</span>
<span class="co">#&gt; #   posterior_mean &lt;dbl&gt;, posterior_se &lt;dbl&gt;</span></code></pre></div>
<p>The estimates based on posterior do move the estimates towards 0, although the states with many polls are influenced less. This is expected as the more poll data we collect, the more we trust those results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">sigma =</span> sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n), 
                   <span class="dt">B =</span> sigma<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>tau<span class="op">^</span><span class="dv">2</span>),
                   <span class="dt">posterior_mean =</span> B <span class="op">*</span><span class="st"> </span>mu <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>B) <span class="op">*</span><span class="st"> </span>avg,
                   <span class="dt">posterior_se =</span> <span class="kw">sqrt</span>(<span class="dv">1</span><span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>tau<span class="op">^</span><span class="dv">2</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(avg, posterior_mean, <span class="dt">size =</span> n)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>)</code></pre></div>
<p><img src="book_files/figure-html/posterior-versus-original-estimates-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Now we repeat this 10,000 times and generate an outcome from the posterior. In each iteration, we keep track of the total number of electoral votes for Clinton. Remember that Trump gets 270 minus the votes for Clinton. Also note that the reason we add 7 in the code is to account for Rhode Island and D.C.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">B &lt;-<span class="st"> </span><span class="dv">10000</span>
mu &lt;-<span class="st"> </span><span class="dv">0</span>
tau &lt;-<span class="st"> </span><span class="fl">0.02</span>
clinton_EV &lt;-<span class="st"> </span><span class="kw">replicate</span>(B, {
  results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">sigma =</span> sd<span class="op">/</span><span class="kw">sqrt</span>(n), 
                   <span class="dt">B =</span> sigma<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>tau<span class="op">^</span><span class="dv">2</span>),
                   <span class="dt">posterior_mean =</span> B <span class="op">*</span><span class="st"> </span>mu <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>B) <span class="op">*</span><span class="st"> </span>avg,
                   <span class="dt">posterior_se =</span> <span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>tau<span class="op">^</span><span class="dv">2</span>)),
                   <span class="dt">simulated_result =</span> <span class="kw">rnorm</span>(<span class="kw">length</span>(posterior_mean), 
                                            posterior_mean, posterior_se),
                   <span class="dt">clinton =</span> <span class="kw">ifelse</span>(simulated_result<span class="op">&gt;</span><span class="dv">0</span>, electoral_votes, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">clinton =</span> <span class="kw">sum</span>(clinton)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">pull</span>(clinton) <span class="op">+</span><span class="st"> </span><span class="dv">7</span>
})

<span class="kw">mean</span>(clinton_EV <span class="op">&gt;</span><span class="st"> </span><span class="dv">269</span>)
<span class="co">#&gt; [1] 0.998</span></code></pre></div>
<p>This model gives Clinton over 99% chance of winning. Here is a histogram of the Monte Carlo outcomes:</p>
<p><img src="book_files/figure-html/election-forecast-posterior-no-bias-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>A similar prediction was made by the Princeton Election Consortium. We now know it was quite off. What happened?</p>
<p>The model above ignores the general bias. After the election, we realized that the general bias in 2016 was not that big: it was between 1 and 2%. But because the election was close in several big states and these states had a large number of polls, pollsters that ignored the general bias greatly underestimated the standard error. Using the notation we instroduce, they assumed the standard error was <span class="math inline">\(\sqrt{\sigma^2/N}\)</span> which with large N is quite smaller than the more accurate estimate <span class="math inline">\(\sqrt{\sigma^2/N + \sigma_b^2}\)</span>. FiveThirtyEight, which models the general bias in a rather sophisticated way, reported a closer result. We can simulate the results now with a bias term. For the state level, the general bias can be larger so we set it at <span class="math inline">\(\sigma_b = 0.03\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tau &lt;-<span class="st"> </span><span class="fl">0.02</span>
bias_sd &lt;-<span class="st"> </span><span class="fl">0.03</span>
clinton_EV_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">1000</span>, {
  results <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">sigma =</span> <span class="kw">sqrt</span>(sd<span class="op">^</span><span class="dv">2</span><span class="op">/</span>n  <span class="op">+</span><span class="st"> </span>bias_sd<span class="op">^</span><span class="dv">2</span>),  
                   <span class="dt">B =</span> sigma<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>tau<span class="op">^</span><span class="dv">2</span>),
                   <span class="dt">posterior_mean =</span> B<span class="op">*</span>mu <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>B)<span class="op">*</span>avg,
                   <span class="dt">posterior_se =</span> <span class="kw">sqrt</span>( <span class="dv">1</span><span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>tau<span class="op">^</span><span class="dv">2</span>)),
                   <span class="dt">simulated_result =</span> <span class="kw">rnorm</span>(<span class="kw">length</span>(posterior_mean), 
                                            posterior_mean, posterior_se),
                   <span class="dt">clinton =</span> <span class="kw">ifelse</span>(simulated_result<span class="op">&gt;</span><span class="dv">0</span>, electoral_votes, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">clinton =</span> <span class="kw">sum</span>(clinton) <span class="op">+</span><span class="st"> </span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">pull</span>(clinton)
})
<span class="kw">mean</span>(clinton_EV_<span class="dv">2</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">269</span>)
<span class="co">#&gt; [1] 0.848</span></code></pre></div>
<p>This gives us a much more sensible estimate. Looking at the outcomes of the simulation, we see how the bias term adds variability to the final results.</p>
<p><img src="book_files/figure-html/comparison-forecast-with-and-without-bias-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>FiveThirtyEight includes many other features we do not include here. One is that they model variability with distributions that have high probabilities for extreme events compared to the normal. One way we could do this is by changing the distribution used in the simulation from a normal distribution to a t-distribution. FiveThirtyEight predicted a probability of 71%.</p>
</div>
<div id="forecasting" class="section level3">
<h3><span class="header-section-number">25.10.5</span> Forecasting</h3>
<p>Forecasters like to make predictions well before the election. The predictions are adapted as new polls come out. However, an important question forecasters must ask is: how informative are polls taken several weeks before the election about the actual election? Here we study the variability of poll results across time.</p>
<p>To make sure the variability we observe is not due to pollster effects, let’s study data from one pollster:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">one_pollster &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(pollster <span class="op">==</span><span class="st"> &quot;Ipsos&quot;</span> <span class="op">&amp;</span><span class="st"> </span>state <span class="op">==</span><span class="st"> &quot;U.S.&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>)</code></pre></div>
<p>Since there is no pollster effect, then perhaps the theoretical standard error matches the data-derived standard deviation. We compute both here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">se &lt;-<span class="st"> </span>one_pollster <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">empirical =</span> <span class="kw">sd</span>(spread), 
            <span class="dt">theoretical =</span> <span class="dv">2</span><span class="op">*</span><span class="kw">sqrt</span>(<span class="kw">mean</span>(spread)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">mean</span>(spread))<span class="op">/</span><span class="kw">min</span>(samplesize)))
se
<span class="co">#&gt;   empirical theoretical</span>
<span class="co">#&gt; 1    0.0403      0.0326</span></code></pre></div>
<p>But the empirical standard deviation is higher than the highest possible theoretical estimate. Furthermore, the spread data does not look normal as the theory would predict:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qplot</span>(spread, <span class="dt">geom =</span> <span class="st">&quot;histogram&quot;</span>, <span class="dt">binwidth =</span> <span class="fl">0.01</span>, <span class="dt">data =</span> one_pollster, <span class="dt">color =</span> <span class="kw">I</span>(<span class="st">&quot;black&quot;</span>))</code></pre></div>
<p><img src="book_files/figure-html/time-trend-variability-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The models we have described include pollster-to-pollster variability and sampling error. But this plot is for one pollster and the variability we see is certainly not explained by sampling error. Where is the extra variability coming from? The following plots make a strong case that it comes from time fluctuations not accounted for by the theory that assumes <span class="math inline">\(p\)</span> is fixed:</p>
<p><img src="book_files/figure-html/time-trend-estimate-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Some of the peaks and valleys we see coincide with events such as the party conventions, which tend to give the candidate a boost. We can see the peaks and valleys are consistent across several pollsters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;U.S.&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(pollster) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;=</span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(enddate, spread)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">span =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>pollster), <span class="dt">show.legend =</span> <span class="ot">FALSE</span>, <span class="dt">alpha=</span><span class="fl">0.6</span>) </code></pre></div>
<p><img src="book_files/figure-html/time-trend-estimate-several-pollsters-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This implies that, if we are going to forecast, our model must include a term to accounts for the time effect. We need to write a model including a bias term for time:</p>
<p><span class="math display">\[
Y_{i,j,t} = d + b + h_j + b_t + \varepsilon_{i,j,t}
\]</span></p>
<p>The standard deviation of <span class="math inline">\(b_t\)</span> would depend on <span class="math inline">\(t\)</span> since the closer we get to election day, the closer to 0 this bias term should be.</p>
<p>Pollsters also try to estimate trends from these data and incorporate these into their predictions. We can model the time trend with a function <span class="math inline">\(f(t)\)</span> and rewrite the model like this: The blue lines in the plots above:</p>
<p><span class="math display">\[
Y_{i,j,t} = d + b + h_j + b_t + f(t) + \varepsilon_{i,jt,}
\]</span></p>
<p>We usually see the estimated <span class="math inline">\(f(t)\)</span> not for the difference, but for the actual percentages for each candidate like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;U.S.&quot;</span> <span class="op">&amp;</span><span class="st"> </span>enddate<span class="op">&gt;=</span><span class="st">&quot;2016-07-01&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(enddate, pollster, rawpoll_clinton, rawpoll_trump) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">Clinton =</span> rawpoll_clinton, <span class="dt">Trump =</span> rawpoll_trump) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(candidate, percentage, <span class="op">-</span>enddate, <span class="op">-</span>pollster) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">candidate =</span> <span class="kw">factor</span>(candidate, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Trump&quot;</span>,<span class="st">&quot;Clinton&quot;</span>)))<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(pollster) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>()<span class="op">&gt;=</span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(enddate, percentage, <span class="dt">color =</span> candidate)) <span class="op">+</span><span class="st">  </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>, <span class="dt">alpha=</span><span class="fl">0.4</span>)  <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">span =</span> <span class="fl">0.15</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">30</span>,<span class="dv">50</span>))</code></pre></div>
<p><img src="book_files/figure-html/trend-estimate-for-all-pollsters-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Once a model like the one above is selected, we can use historical and present data to estimate all the necessary parameters to make predictions. There are a variety of methods for estimating trends <span class="math inline">\(f(t)\)</span> which we discuss in the Machine Learning part.</p>
</div>
<div id="exercise-1" class="section level3">
<h3><span class="header-section-number">25.10.6</span> Exercise</h3>
<ol style="list-style-type: decimal">
<li><p>Create this table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(dslabs)
<span class="kw">data</span>(<span class="st">&quot;polls_us_election_2016&quot;</span>)
polls &lt;-<span class="st"> </span>polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">!=</span><span class="st"> &quot;U.S.&quot;</span> <span class="op">&amp;</span><span class="st"> </span>enddate <span class="op">&gt;=</span><span class="st"> &quot;2016-10-31&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>)</code></pre></div>
<p>Now for each poll use the CLT to create a 95% confidence interval for the spread reported by each poll. Call the resulting object cis with columns lower and upper for the limits of the confidence intervals. Use the <code>select</code> function to keep the columns <code>state, startdate, end date, pollster, grade, spread, lower, upper</code>.</p></li>
<li><p>You can add the final result to the <code>cis</code> table you just created using the <code>right_join</code> function like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add &lt;-<span class="st"> </span>results_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">actual_spread =</span> clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>trump<span class="op">/</span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(state, actual_spread)
cis &lt;-<span class="st"> </span>cis <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">as.character</span>(state)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(add, <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>)</code></pre></div>
<p>Now determine how often the 95% confidence interval includes the actual result.</p></li>
<li><p>Repeat this, but show the proportion of hits for each pollster. Show only pollsters with more than 5 polls and order them from best to worst. Show the number of polls conducted by each pollster and the FiveThirtyEight grade of each pollster. Hint: use <code>n=n(), grade = grade[1]</code> in the call to summarize.</p></li>
<li><p>Repeat exercise 3, but instead of pollster, stratify by state. Note that here we can’t show grades.</p></li>
<li><p>Make a barplot based on the result of exercise 4. Use <code>coord_flip</code>.</p></li>
<li><p>Add two columns to the <code>cis</code> table by computing, for each poll, the difference between the predicted spread and the actual spread, and define a column <code>hit</code> that is true if the signs are the same. Hint: use the function <code>sign</code>. Call the object <code>resids</code>.</p></li>
<li><p>Create a plot like in exercise 5, but for the proportion of times the sign of the spread agreed.</p></li>
<li><p>In exercise 7, we see that for most states the polls had it right 100% of the time. For only 9 states did the polls miss more than 25% of the time. In particular, notice that in Wisconsin every single poll got it wrong. In Pennsylvania and Michigan more than 90% of the polls had the signs wrong. Make a histogram of the errors. What is the median of these errors?</p></li>
<li><p>We see that at the state level, the median error was 3% in favor of Clinton. The distribution is not centered at 0, but at 0.03. This is the general bias we described in the section above. Create a boxplot to see if the bias was general to all states or it affected some states differently. Use <code>filter(grade %in% c(&quot;A+&quot;,&quot;A&quot;,&quot;A-&quot;,&quot;B+&quot;) | is.na(grade)))</code> to only include pollsters with high grades.</p></li>
<li><p>Some of these states only have a few polls. Repeat exercise 9, but only include states with 5 good polls or more. Hint: use <code>group_by</code>, <code>filter</code> then <code>ungroup</code>. You will see that the West (Washington, New Mexico, California) underestimated Hillary’s performance, while the Midwest (Michigan, Pennsylvania, Wisconsin, Ohio, Missouri) overestimated it. In our simulation, we did not model this behavior since we added general bias, rather than a regional bias. Note that some pollsters may now modeling correlation between similar states and estimating this correlation from historical data. To learn more about this, you can learn about random effects and mixed models.</p></li>
</ol>

</div>
</div>
<div id="t-dist" class="section level2">
<h2><span class="header-section-number">25.11</span> The t-distribution</h2>
<p>Above we made use of the CLT with a sample size of 15. Because we are estimating a second parameters <span class="math inline">\(\sigma\)</span>, further variability is introduced into our confidence interval which result in intervals that are too small. For very large sample sizes this extra variability is negligible, but, in general, for values smaller than 30 we need to be cautions about using the CLT.</p>
<p>However, if the data in the urn is known to follow a normal distribution, then we actually have mathematical theory that tell us how much bigger we need to make the intervals to account for the estimation of <span class="math inline">\(\sigma\)</span>. Using this theory, we can construct confidence intervals for any <span class="math inline">\(N\)</span>. But again only if <strong>the data in the urn is known to follow a normal distribution</strong>. So for the 0, 1 data of our previous urn model, this theory definitely does not apply.</p>
<p>The statistic on which confidence intervals for <span class="math inline">\(d\)</span> are based is</p>
<p><span class="math display">\[
Z = \frac{\bar{X} - d}{\sigma/\sqrt{N}}
\]</span></p>
<p>CLT tells us that Z is approximately normally distributed with expected value 0 and standard error 1. But in practice we don’t know <span class="math inline">\(\sigma\)</span> so we use:</p>
<p><span class="math display">\[
Z = \frac{\bar{X} - d}{s\sqrt{N}}
\]</span></p>
<p>By substituting <span class="math inline">\(\sigma\)</span> with <span class="math inline">\(s\)</span> we introduce some variability. The theory tells us that <span class="math inline">\(Z\)</span> follows a t-distribution with <span class="math inline">\(N-1\)</span> <em>degrees of freedom</em>. The degrees of freedom is a parameter that controls the variability via fatter tails:</p>
<p><img src="book_files/figure-html/unnamed-chunk-908-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>If we are willing to assume the pollster effect data is normally distributed, based on the sample data <span class="math inline">\(X_1, \dots, X_N\)</span>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">one_poll_per_pollster <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">sample=</span>spread)) <span class="op">+</span><span class="st"> </span><span class="kw">stat_qq</span>()</code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-909-1.png" width="70%" style="display: block; margin: auto;" /> then <span class="math inline">\(Z\)</span> follows a t-distribution with <span class="math inline">\(N-1\)</span> degrees of freedom. So perhaps a better confidence interval for <span class="math inline">\(d\)</span> is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>,  <span class="kw">nrow</span>(one_poll_per_pollster)<span class="op">-</span><span class="dv">1</span>)
one_poll_per_pollster <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg =</span> <span class="kw">mean</span>(spread), <span class="dt">moe =</span> z<span class="op">*</span><span class="kw">sd</span>(spread)<span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">length</span>(spread))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">start =</span> avg <span class="op">-</span><span class="st"> </span>moe, <span class="dt">end =</span> avg <span class="op">+</span><span class="st"> </span>moe) 
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;      avg    moe  start    end</span>
<span class="co">#&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 0.0290 0.0134 0.0156 0.0424</span></code></pre></div>
<p>A bit larger than the one using normal is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qt</span>(<span class="fl">0.975</span>, <span class="dv">14</span>)
<span class="co">#&gt; [1] 2.14</span></code></pre></div>
<p>is bigger than</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qnorm</span>(<span class="fl">0.975</span>)
<span class="co">#&gt; [1] 1.96</span></code></pre></div>
<p>The t-distribution can also be used to model errors in bigger deviations are more likely than with the normal distribution, as seen in the densities we previously saw. Fivethirtyeight uses the t-distribution to generate errors that better model the deviations we see in election data. For example, in Wisconsin the average of six polls was 7% in favor of Clinton with a standard deviation of 1%, but Trump won by 0.7%. Even after taking into account the overall bias, this 7.7% residual is more in line with t-distributed data than the normal distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;polls_us_election_2016&quot;</span>)
polls_us_election_<span class="dv">2016</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st">&quot;Wisconsin&quot;</span> <span class="op">&amp;</span>
<span class="st">           </span>enddate <span class="op">&gt;=</span><span class="st">&quot;2016-10-31&quot;</span> <span class="op">&amp;</span><span class="st"> </span>
<span class="st">           </span>(grade <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A+&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;A-&quot;</span>,<span class="st">&quot;B+&quot;</span>) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(grade))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spread =</span> rawpoll_clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>rawpoll_trump<span class="op">/</span><span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">as.character</span>(state)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(results_us_election_<span class="dv">2016</span>, <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">actual =</span> clinton<span class="op">/</span><span class="dv">100</span> <span class="op">-</span><span class="st"> </span>trump<span class="op">/</span><span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">actual =</span> actual[<span class="dv">1</span>], <span class="dt">avg =</span> <span class="kw">mean</span>(spread), <span class="dt">sd =</span> <span class="kw">sd</span>(spread),<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(actual, avg, sd, n)
<span class="co">#&gt;   actual    avg     sd n</span>
<span class="co">#&gt; 1 -0.007 0.0711 0.0104 6</span></code></pre></div>

</div>
<div id="association-tests" class="section level2">
<h2><span class="header-section-number">25.12</span> Association Tests</h2>
<p>The statistical tests we have studied up to now leave out a substantial portion of data types. Specifically, we have not discussed inference for binary, categorical and ordinal data. To give a very specific example, consider the following case study.</p>
<p>A <a href="http://www.pnas.org/content/112/40/12349.abstract">2014 PNAS paper</a> analyzed success rates from funding agencies in the Netherlands and concluded that their:</p>
<blockquote>
<p>results reveal gender bias favoring male applicants over female applicants in the prioritization of their “quality of researcher” (but not “quality of proposal”) evaluations and success rates, as well as in the language use in instructional and evaluation materials.</p>
</blockquote>
<p>The main evidence for this conclusion comes down to a comparison of the percentages. Table S1 in the paper includes the information we need. Here are the three columns showing the overall outcomes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(dslabs)
<span class="kw">data</span>(<span class="st">&quot;research_funding_rates&quot;</span>)
research_funding_rates <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(discipline, <span class="kw">contains</span>(<span class="st">&quot;total&quot;</span>))
<span class="co">#&gt;            discipline applications_total awards_total success_rates_total</span>
<span class="co">#&gt; 1   Chemical sciences                122           32                26.2</span>
<span class="co">#&gt; 2   Physical sciences                174           35                20.1</span>
<span class="co">#&gt; 3             Physics                 76           20                26.3</span>
<span class="co">#&gt; 4          Humanities                396           65                16.4</span>
<span class="co">#&gt; 5  Technical sciences                251           43                17.1</span>
<span class="co">#&gt; 6   Interdisciplinary                183           29                15.8</span>
<span class="co">#&gt; 7 Earth/life sciences                282           56                19.9</span>
<span class="co">#&gt; 8     Social sciences                834          112                13.4</span>
<span class="co">#&gt; 9    Medical sciences                505           75                14.9</span></code></pre></div>
<p>We have these values for each gender:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(research_funding_rates)
<span class="co">#&gt;  [1] &quot;discipline&quot;          &quot;applications_total&quot;  &quot;applications_men&quot;   </span>
<span class="co">#&gt;  [4] &quot;applications_women&quot;  &quot;awards_total&quot;        &quot;awards_men&quot;         </span>
<span class="co">#&gt;  [7] &quot;awards_women&quot;        &quot;success_rates_total&quot; &quot;success_rates_men&quot;  </span>
<span class="co">#&gt; [10] &quot;success_rates_women&quot;</span></code></pre></div>
<p>We can compute the totals that were successful and the totals that were not as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">totals &lt;-<span class="st"> </span>research_funding_rates <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>discipline) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize_all</span>(<span class="kw">funs</span>(sum)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">yes_men =</span> awards_men, 
            <span class="dt">no_men =</span> applications_men <span class="op">-</span><span class="st"> </span>awards_men, 
            <span class="dt">yes_women =</span> awards_women, 
            <span class="dt">no_women =</span> applications_women <span class="op">-</span><span class="st"> </span>awards_women) </code></pre></div>
<p>So we see that a larger percent of men than women received awards:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">totals <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">percent_men =</span> yes_men<span class="op">/</span>(yes_men<span class="op">+</span>no_men),
                     <span class="dt">percent_women =</span> yes_women<span class="op">/</span>(yes_women<span class="op">+</span>no_women))
<span class="co">#&gt;   percent_men percent_women</span>
<span class="co">#&gt; 1       0.177         0.149</span></code></pre></div>
<p>But could this be due just to random variability? Here we learn how to perform inference for this type of data.</p>
<div id="lady-tasting-tea" class="section level3">
<h3><span class="header-section-number">25.12.1</span> Lady Tasting Tea</h3>
<p><a href="https://en.wikipedia.org/wiki/Ronald_Fisher">R.A. Fisher</a> was one of the first to formalize hypothesis testing. The “Lady Testing Tea” is one of the most famous examples.</p>
<p>The story is as follows: an acquaintance of Fisher’s claimed that she could tell if milk was added before or after tea was poured. Fisher was skeptical. He designed an experiment to test this claim. He gave her four pairs of cups of tea: one with milk poured first, the other after. The order was randomized. The null hypothesis here is that she is guessing. Fisher derived the distribution for the number of correct picks on the assumption that the choices were random and independent.</p>
<p>As an example, suppose she picked 3 out of 4 correctly, do we believe she has a special ability? The basic question we ask is: if the tester is actually guessing, what are the chances that she gets 3 or more correct? Just as we have done before, we can compute a probability under the null hypothesis that she is guessing 4 of each. Under this null hypothesis, we can think of this particular example as picking 4 balls out of an urn with 4 blue (correct answer) and 4 red (incorrect answer) balls. Remember, she knows that there are four before tea and four after.</p>
<p>Under the null hypothesis that she is simply guessing, each ball has the same chance of being picked. We can then use combinations to figure out each probability. The probability of picking 3 is <span class="math inline">\({4 \choose 3} {4 \choose 1} / {8 \choose 4} = 16/70\)</span>. The probability of picking all 4 correct is <span class="math inline">\({4 \choose 4} {4 \choose 0}/{8 \choose 4}= 1/70\)</span>. Thus, the chance of observing a 3 or something more extreme, under the null hypothesis, is <span class="math inline">\(\approx 0.24\)</span>. This is the p-value. The procedure that produced this p-value is called <em>Fisher’s exact test</em> and it uses the <em>hypergeometric distribution</em>.</p>
</div>
<div id="two-by-two-tables" class="section level3">
<h3><span class="header-section-number">25.12.2</span> Two-by-two tables</h3>
<p>The data from the experiment is usually summarized by a table like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>),<span class="dv">2</span>,<span class="dv">2</span>)
<span class="kw">rownames</span>(tab)&lt;-<span class="kw">c</span>(<span class="st">&quot;Poured Before&quot;</span>,<span class="st">&quot;Poured After&quot;</span>)
<span class="kw">colnames</span>(tab)&lt;-<span class="kw">c</span>(<span class="st">&quot;Guessed before&quot;</span>,<span class="st">&quot;Guessed after&quot;</span>)
tab
<span class="co">#&gt;               Guessed before Guessed after</span>
<span class="co">#&gt; Poured Before              3             1</span>
<span class="co">#&gt; Poured After               1             3</span></code></pre></div>
<p>These are referred to as a two-by-two table. For each of the four combinations one can get with a pair of binary variables, they show the observed counts for each occurrence.</p>
<p>The function <code>fisher.test</code> performs the inference calculations above and can be obtained like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fisher.test</span>(tab, <span class="dt">alternative=</span><span class="st">&quot;greater&quot;</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  Fisher&#39;s Exact Test for Count Data</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  tab</span>
<span class="co">#&gt; p-value = 0.2</span>
<span class="co">#&gt; alternative hypothesis: true odds ratio is greater than 1</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.314   Inf</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; odds ratio </span>
<span class="co">#&gt;       6.41</span></code></pre></div>
</div>
<div id="chi-square-test" class="section level3">
<h3><span class="header-section-number">25.12.3</span> Chi-square Test</h3>
<p>Notice that, in a way, our funding rates example is similar to the Lady Tasting Tea. However, in the Lady Tasting Tea example, the number of blue and red beads is experimentally fixed and the number of answers given for each category is also fixed. This is because Fisher made sure there were four cups with milk poured before tea and four cups with milk poured after and the lady knew this, so the answers would also have to include four befores and four afters. If this is the case, the sum of the rows and the sum of the columns are fixed. This defines constraints on the possible ways we can fill the two by two table and also permits us to use the hypergeometric distribution. In general, this is not the case. Nonetheless, there is another approach, the Chi-squared test, which is described below.</p>
<p>Imagine we have 2823 applicants, some are men and some are women and some get funded, whereas other don’t. We saw that the success rates for men and woman were:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">totals <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">percent_men =</span> yes_men<span class="op">/</span>(yes_men<span class="op">+</span>no_men),
                     <span class="dt">percent_women =</span> yes_women<span class="op">/</span>(yes_women<span class="op">+</span>no_women))
<span class="co">#&gt;   percent_men percent_women</span>
<span class="co">#&gt; 1       0.177         0.149</span></code></pre></div>
<p>respectively. Would we see this again if we randomly assign funding at the overall rate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">funding_rate &lt;-<span class="st"> </span>totals <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">percent_total =</span> 
              (yes_men <span class="op">+</span><span class="st"> </span>yes_women)<span class="op">/</span>
<span class="st">              </span>(yes_men <span class="op">+</span><span class="st"> </span>no_men <span class="op">+</span>yes_women <span class="op">+</span><span class="st"> </span>no_women)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(percent_total)
funding_rate
<span class="co">#&gt; [1] 0.165</span></code></pre></div>
<p>The Chi-square test answers this question. The first step is to create the two-by-two data table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">two_by_two &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">awarded =</span> <span class="kw">c</span>(<span class="st">&quot;no&quot;</span>, <span class="st">&quot;yes&quot;</span>), 
                     <span class="dt">men =</span> <span class="kw">c</span>(totals<span class="op">$</span>no_men, totals<span class="op">$</span>yes_men),
                     <span class="dt">women =</span> <span class="kw">c</span>(totals<span class="op">$</span>no_women, totals<span class="op">$</span>yes_women))
two_by_two
<span class="co">#&gt;   awarded  men women</span>
<span class="co">#&gt; 1      no 1345  1011</span>
<span class="co">#&gt; 2     yes  290   177</span></code></pre></div>
<p>The general idea of the Chi-square test is to compare this two-by-two table to what you expect to see, which would be:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data.frame</span>(<span class="dt">awarded =</span> <span class="kw">c</span>(<span class="st">&quot;no&quot;</span>, <span class="st">&quot;yes&quot;</span>), 
       <span class="dt">men =</span> (totals<span class="op">$</span>no_men <span class="op">+</span><span class="st"> </span>totals<span class="op">$</span>yes_men) <span class="op">*</span><span class="st"> </span>
<span class="st">         </span><span class="kw">c</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>funding_rate, funding_rate),
       <span class="dt">women =</span> (totals<span class="op">$</span>no_women <span class="op">+</span><span class="st"> </span>totals<span class="op">$</span>yes_women)<span class="op">*</span>
<span class="st">         </span><span class="kw">c</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>funding_rate, funding_rate))
<span class="co">#&gt;   awarded  men women</span>
<span class="co">#&gt; 1      no 1365   991</span>
<span class="co">#&gt; 2     yes  270   197</span></code></pre></div>
<p>We can see that more men than expected and less women than expected received funding. However, under the null hypothesis these observations are random variables. The Chi-square test tells us how likely it is to see a deviation this large or larger. This test uses an asymptotic result, similar to the CLT, related to the sums of independent binary outcomes. The R function <code>chisq.test</code> takes a two by two table and returns the results from the test:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">chisq_test &lt;-<span class="st"> </span>two_by_two <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>awarded) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">chisq.test</span>()
chisq_test
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pearson&#39;s Chi-squared test with Yates&#39; continuity correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  .</span>
<span class="co">#&gt; X-squared = 4, df = 1, p-value = 0.05</span></code></pre></div>
<p>We see that the p-value is 0.0509:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">chisq_test<span class="op">$</span>p.value
<span class="co">#&gt; [1] 0.0509</span></code></pre></div>
</div>
<div id="the-odds-ratio-odds-ratio" class="section level3">
<h3><span class="header-section-number">25.12.4</span> The Odds Ratio {odds-ratio}</h3>
<p>An informative summary statistic associated with two-by-two tables is the odds ratio. Define the two variables as <span class="math inline">\(X = 1\)</span> if you are a male and 0 otherwise, and <span class="math inline">\(Y=1\)</span> if you are funded and 0 otherwise. The odds of getting funded if you are a man is defined:</p>
<p><span class="math display">\[\mbox{Pr}(Y=1 \mid X=1) / \mbox{Pr}(Y=0 \mid X=1)\]</span></p>
<p>and can be computed like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">odds_men &lt;-<span class="st"> </span>(two_by_two<span class="op">$</span>men[<span class="dv">2</span>] <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(two_by_two<span class="op">$</span>men)) <span class="op">/</span><span class="st"> </span>
<span class="st">  </span>(two_by_two<span class="op">$</span>men[<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(two_by_two<span class="op">$</span>men))
odds_men
<span class="co">#&gt; [1] 0.216</span></code></pre></div>
<p>And the odds of being funded if you are a woman is:</p>
<p><span class="math display">\[\mbox{Pr}(Y=1 \mid X=0) / \mbox{Pr}(Y=0 \mid X=0)\]</span></p>
<p>and can be computed like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">odds_women &lt;-<span class="st"> </span>(two_by_two<span class="op">$</span>women[<span class="dv">2</span>] <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(two_by_two<span class="op">$</span>women)) <span class="op">/</span><span class="st"> </span>
<span class="st">  </span>(two_by_two<span class="op">$</span>women[<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(two_by_two<span class="op">$</span>women))
odds_women
<span class="co">#&gt; [1] 0.175</span></code></pre></div>
<p>The odds ratio is the ratio for these two odds: how many times larger are the odds for men than for women?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">odds_men <span class="op">/</span><span class="st"> </span>odds_women
<span class="co">#&gt; [1] 1.23</span></code></pre></div>
<p>We often see two by two tables written out as</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">Men</th>
<th align="left">Women</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Awarded</td>
<td align="left">a</td>
<td align="left">b</td>
</tr>
<tr class="even">
<td>Not Awarded</td>
<td align="left">c</td>
<td align="left">d</td>
</tr>
</tbody>
</table>
<p>In this case, the odds ratio is <span class="math inline">\(\frac{a/c}{b/d}\)</span> which is equivalent to <span class="math inline">\((ad) / (bc)\)</span></p>
</div>
<div id="confidence-intervals-for-the-odds-ratio" class="section level3">
<h3><span class="header-section-number">25.12.5</span> Confidence intervals for the odds ratio</h3>
<p>Computing confidence intervals for the odds ratio is not mathematically straightforward. Unlike other statistics, for which we can derive useful approximations of their distributions, the odds ratio is not only a ratio, but a ratio of ratios. Therefore, there is no simple way of using, for example, the CLT.</p>
<p>However, statistical theory tells us that when all four entries of the two by two table are large enough, then the log of the odds ratio is approximately normal with standard error</p>
<p><span class="math display">\[
\sqrt{1/a + 1/b + 1/c + 1/d} 
\]</span></p>
<p>This implies that a 95% confidence interval for the log odds ratio can be formed by:</p>
<p><span class="math display">\[
\log \{ (ad) / (cd) \} \pm 1.96 \sqrt{1/a + 1/b + 1/c + 1/d} 
\]</span></p>
<p>By exponentiating these two numbers we can construct a confidence interval of the odds ratio.</p>
<p>Using R we can compute this confidence interval as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log_or &lt;-<span class="st"> </span><span class="kw">log</span>( odds_men <span class="op">/</span><span class="st"> </span>odds_women )
se &lt;-<span class="st"> </span>two_by_two <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>awarded) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">se =</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(<span class="dv">1</span><span class="op">/</span>men) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(<span class="dv">1</span><span class="op">/</span>women))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(se)
ci &lt;-<span class="st"> </span>log_or <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span>se
ci
<span class="co">#&gt; [1] 0.0043 0.4123</span></code></pre></div>
<p>If we want to convert it back to the odds ratio scale, we can exponentiate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(ci)
<span class="co">#&gt; [1] 1.00 1.51</span></code></pre></div>
<p>Note that 0 is not included in the confidence interval for the log odds ratio (1 not included for odds ratio) which must mean that the p-value is smaller then 0.05. We can confirm this using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(log_or, <span class="dv">0</span>, se))
<span class="co">#&gt; [1] 0.0454</span></code></pre></div>
<p>This is a slightly different p-value that with the chi-squared test. This is because we are using a different asymptotic approximation to the null distribution. To learn more about inference and asymptotic theory for odds ratio consult the book by <a href="https://books.google.com/books?hl=en&amp;lr=&amp;id=h9kFH2_FfBkC">McCullagh and Nelder, 1989</a>.</p>
</div>
<div id="small-count-correction" class="section level3">
<h3><span class="header-section-number">25.12.6</span> Small count correction</h3>
<p>Note that the log odds ratio is not defined if any of the cells of the two-by-two table is 0. This is because if <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(c\)</span>, of <span class="math inline">\(d\)</span> are 0, the <span class="math inline">\(\log \{ (ad) / (cd) \}\)</span> is either the log of 0 or has a 0 in the denominator. For this situation, it is common practice to avoid 0s by adding 0.5 to each cell. This is referred to as the <em>Haldane–Anscombe correction</em> and has been shown, both in practice and theory, to work well.</p>
</div>
<div id="large-samples-small-p-values" class="section level3">
<h3><span class="header-section-number">25.12.7</span> Large samples, small p-values</h3>
<p>As mentioned earlier, reporting only p-values is not an appropriate way to report the results of data analysis. In scientific journals, for example, some studies seem to overemphasize p-values. Some of these studies have large sample sizes and report impressively small p-values. Yet when one looks closely at the results, we realize odds ratios are quite modest: barely bigger than 1. In this case the difference may not be <em>practically significant</em> or <em>scientifically significant</em>.</p>
<p>Note that the relationship between odds ratio and p-value is not one-to-one. It depends on the sample size. So a very small p-value does not necessarily mean very large odds ratio.</p>
<p>Notice what happens to the p-value if we multiply our two-by-two table by 10:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">two_by_two <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>awarded) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">men =</span> men<span class="op">*</span><span class="dv">10</span>, <span class="dt">women =</span> women<span class="op">*</span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">chisq.test</span>() 
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pearson&#39;s Chi-squared test with Yates&#39; continuity correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  .</span>
<span class="co">#&gt; X-squared = 40, df = 1, p-value = 3e-10</span></code></pre></div>
<p>Yet the odds ratio is unchanged.</p>
</div>
<div id="exercises-35" class="section level3">
<h3><span class="header-section-number">25.12.8</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>A famous athlete has an impressive career, winning 70% of her 500 career matches. However, this athlete gets criticized because in important events, such as the Olympics, she has a losing record of 8 wins and 9 losses. Perform a Chi squared test to determine if this losing record can be simply due to chance as opposed to not performing well under pressure.</p></li>
<li><p>Why did we use the Chi square test instead of Fisher’s exact test in the previous exercise?</p>
<p>A. It actually does not matter, since they give the exact same p-value.</p>
<p>B. Fisher’s exact and the Chi squareare different names for the same test.</p>
<p>C. Because the sum of the rows and columns of the two by two table ere not fixed so the hypergeometric distribution is not an appropriate assumption for the null hypothesis. For this reason, Fisher’s exact test is rarely applicable with observational data.</p>
<p>D. Because the Chi square test runs faster.</p></li>
<li><p>Compute the odds ratio of “losing under pressure” along with a confidence interval.</p></li>
<li><p>Notice that the p-value is larger than 0.05 but the 95% confidence interval does not include 1. What explains this?</p>
<p>A. We made a mistake in our code.</p>
<p>B. These are not t-tests so the connection between p-value and confidence intervals does not apply.</p>
<p>C. Different approximations are used for the p-value and the confidence interval calculation. If we had a larger sample size the match would be better.</p>
<p>D. We should use the Fisher exact test to get confidence intervals.</p></li>
<li><p>Multiply the two by two table by 2 and see if the p-value and confidence retrieval are a better match.</p></li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="probability.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rafalab/dsbook/edit/master/inference/parameters-estimates.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
